---
title: "Baseline Ranked Variables- Low Priority"
author: "Kelsey Dowling"
date: "`r Sys.Date()`"
output: pdf_document
---



This report gives the distribution of all Baseline Survey questions for variables deemed 'lower priority'; this includes derived variables. Among the Module 1 and Module 2 responses, if a participant was somehow able to complete both versions of either survey, only the version 2 data is kept.


```{r library, include=FALSE}
#rm(list = ls())


#update.packages("tinytex")
#require(devtools)
#install_version("ggplot2", version = "0.9.1", repos = "http://cran.us.r-project.org")
#tinytex::install_tinytex(version = "2020.10")
#tinytex::reinstall_tinytex(repository = "illinois")



library(bigrquery)
library(epiDisplay) ##recommended applied here crosstable, tab1
library(arsenal)
library(gtsummary)
library(rio)



library(ggplot2)
library(gridExtra)
library(scales)
library(gt)
library(tinytex)
library(data.table) ###to write or read and data management 
library(tidyverse) ###for data management
library(dplyr) ###data management
library(lubridate) ###date time
library(stringr) ###to work on patterns, characters

options(tinytex.verbose = TRUE)

bq_auth()
```


```{r merge1, include=FALSE, warning=FALSE}


#Data Dictionary for column names
dictionary <- rio::import("https://episphere.github.io/conceptGithubActions/aggregate.json",format = "json")
dd <- dplyr::bind_rows(dictionary,.id="CID")
dd <-rbindlist(dictionary,fill=TRUE,use.names=TRUE,idcol="CID")
dd$`Variable Label`[is.na(dd$`Variable Label`)] <- replace_na(dd$'Variable Name')
dd <- as.data.frame.matrix(do.call("rbind",dictionary)) 
dd$CID <- rownames(dd)
#https://shaivyakodan.medium.com/7-useful-r-packages-for-analysis-7f60d28dca98
devtools::install_github("tidyverse/reprex")





## BQ Pull from the participants table just to use for versioning
project <- "nih-nci-dceg-connect-prod-6d04"
billing <- "nih-nci-dceg-connect-prod-6d04" 
recr_M1 <- bq_project_query(project, query="SELECT token,Connect_ID, d_821247024, d_914594314,  d_827220437,d_512820379,
                            d_949302066 , d_517311251  FROM  `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE  d_821247024='197316935' and d_949302066 ='231311385'")
recr_m1 <- bq_table_download(recr_M1,bigint = "integer64")
cnames <- names(recr_m1)
# Check that it doesn't match any non-number
numbers_only <- function(x) !grepl("\\D", x)
# to check variables in recr_noinact_wl1
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(recr_m1,varname)
  recr_m1[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}




#### Handling participants that somehow completed both Mod1 version 1 and Mod1 version 2

sql_M1_1 <- bq_project_query(project, query = "SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v1_JP` WHERE Connect_ID IS NOT NULL")
sql_M1_2 <- bq_project_query(project, query = "SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module1_v2_JP` WHERE Connect_ID IS NOT NULL")

M1_V1 <- bq_table_download(sql_M1_1, bigint = "integer64")
M1_V2 <- bq_table_download(sql_M1_2, bigint = "integer64")

# Select matching column names
M1_V1_vars <- colnames(M1_V1)
M1_V2_vars <- colnames(M1_V2)
common_vars <- intersect(M1_V1_vars, M1_V2_vars)

# Subset to common columns
M1_V1_common <- M1_V1[, common_vars]
M1_V2_common <- M1_V2[, common_vars]

# Add version indicator
M1_V1_common$version <- 1
M1_V2_common$version <- 2

# Identify columns with mismatched types
mismatched_cols <- names(M1_V1_common)[sapply(names(M1_V1_common), function(col) {
  class(M1_V1_common[[col]]) != class(M1_V2_common[[col]])
})]

# Convert mismatched columns to character for consistency
M1_V1_common <- M1_V1_common %>%
  mutate(across(all_of(mismatched_cols), as.character))
M1_V2_common <- M1_V2_common %>%
  mutate(across(all_of(mismatched_cols), as.character))

# Combine both versions for participants who completed both
M1_common <- bind_rows(M1_V1_common, M1_V2_common) %>%
  arrange(Connect_ID, desc(version))

# For columns unique to each version
V1_only_vars <- setdiff(M1_V1_vars, common_vars)
V2_only_vars <- setdiff(M1_V2_vars, common_vars)

# Subset each version for unique columns and add version indicator
m1_v1_only <- M1_V1[, c("Connect_ID", V1_only_vars)] %>%
  mutate(version = 1)
m1_v2_only <- M1_V2[, c("Connect_ID", V2_only_vars)] %>%
  mutate(version = 2)

# Combine the unique and common data
m1_common_v1 <- left_join(M1_common, m1_v1_only, by = c("Connect_ID", "version"))
m1_combined_v1v2 <- left_join(m1_common_v1, m1_v2_only, by = c("Connect_ID", "version"))

# Filter for complete cases where specific completion criteria are met
m1_complete <- m1_combined_v1v2 %>%
  filter(Connect_ID %in% recr_m1$Connect_ID[recr_m1$d_949302066 == 231311385]) %>%
  arrange(desc(version))

# Remove duplicates, keeping only the most recent version for each Connect_ID
m1_complete_nodup <- m1_complete[!duplicated(m1_complete$Connect_ID),]

m1_complete_nodup$Connect_ID <- as.numeric(m1_complete_nodup$Connect_ID)


## Define requirements of the data: active or passive,  user profile done, consented, mod1 done, verified
parts <- "SELECT Connect_ID, token, state_d_934298480, d_536735468, d_663265240,d_976570371, d_949302066,
FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` 
where Connect_ID IS NOT NULL and (d_512820379='486306141' OR d_512820379='854703046') and d_919254129='353358909' and d_699625233='353358909' and 
d_949302066='231311385'  and d_821247024='197316935'" 

parts_table <- bq_project_query(project, parts)
parts_data <- bq_table_download(parts_table, bigint = "integer64",n_max = Inf, page_size = 10000)

parts_data$Connect_ID <- as.numeric(parts_data$Connect_ID)


merged= left_join(parts_data,m1_complete_nodup, by="Connect_ID") #%>% 
dim(merged)


data_tib_base <- as_tibble(merged)

knitr::opts_chunk$set(comment = NA)

```

```{r intro, warning=FALSE, echo=FALSE,  message=FALSE}

base_vars1 <- merged %>% filter(d_949302066==231311385)
base_vars2 <- merged %>% filter(d_536735468==231311385)
base_vars3 <- merged %>% filter(d_976570371==231311385)
base_vars4 <- merged %>% filter(d_663265240==231311385)

cat("Particpants with Module 1 completion: ",dim(base_vars1)[[1]])
cat("Particpants with Module 2 completion: ", dim(base_vars2)[[1]])
cat("Particpants with Module 3 completion: ", dim(base_vars3)[[1]])
cat("Particpants with Module 4 completion: ", dim(base_vars4)[[1]])


```

```{r functions, warning=FALSE, include=FALSE}

#Histogram 
hist_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  data_tib_base %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
     xlab(Xlab) + ylab(Ylab) + geom_histogram()+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="#3C989E" , linetype="solid")
  
}



#Boxplot
boxp_funct <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  data_tib_base %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title) +
    theme(axis.text.y=element_blank(),  #remove y axis labels
        axis.ticks.y=element_blank()  #remove y axis ticks
        )
}



##GT TABLE: Questions that all participants asked, update dictionary as new answer options come up
dict <- list("104430631"="No", "353358909"="Yes", "589959753"="A little shorter", "623310018"="A lot shorter", "978204320"= "Grade School(Grades 1-8)", "935502060"="Some High School, No Diploma", "404564707"= "High School Graduate or GED", "432193665"="Some College, No Degree", "890756124"="Technical or Trade School After High School", "766964355"="Associate's Degree", "875342283"="Bachelor's Degree", "598242454"="Advanced Degree", "709650750"="Biological Child", "810290359"="Adopted Child", "509607548"="Step Child","784922042"="Related to me in some other way", "288105839"="Yes, fraternal twins", "626558982"="Yes, triplets or higher multiple birth", "178420302"="Do not Know", "536341288"="Female", "576796184"="Intersex or Other", "654207589"="Male","555374628"="Full Sibling", "871673221"="Half Sibling, Same Mother",  "198654048"="Half Sibling, Same Father", "807835037"="Other", "274062548"="More than 3 months ago", "958538953"="In the past 3 months", "317567178"="In the past month", "484055234"="In the past year",  "802197176"="More than 1 year ago", "[]"="Answered with number", "[178420302]"="Answered Don't Know", "274062548"="More than 3 months ago","958538953"="In the past 3 months",  "490796638"="Not Flexible","719954633"="Extremely Flexible","929148006"="A Little Flexible","988873962"="Somewhat Flexible", "764708931"="Very flexible","0"="No", "1"="Yes", "536341288"="Female", "218837028"="Woman (New Response)", "983318667"="Man (New Response)"  , "654207589"="Male","746038746"="Prefer Not to Answer", "805712793"="Genderqueer","486192236"="Non-Binary", "807835037"="Other","873138103"="Transgender Woman","405267600"="Transgender Man", "220083334"="Very Feminine","541300533"="Mostly Feminine","878286618"="Somewhat Feminine","910745276"="Equally feminine and masculine","915528806"="Very masculine","265452386"="Mostly Masculine","510148951"="Somewhat Masculine","271882746"="Straight or heterosexual", "903084185"="Lesbian, gay, or homosexual", "999994434"="Bisexual", "410008111" = "Two-Spirit", "831942158" = "Questioning", "584368278"="Retired", "475665841"="Homemaker", "656816477"="Unemployed", "756948639"="Unble to Work (Disabled)", "181769837"="Other Employment Status","551525967"="Yes, Full-Time Student", "738284740"="Yes, Part Time Student", "275706407"="Someone on behalf of Participant", "589702540"="Completed by Participant", "288321056"="Married", "514080822"="Never Married","522680498"="Never Married but living with Partner","649436542"="Divorced","522680498"="Partner", "741094625"="Separated","733527132"="Widow", "988858078" = "1","156095877" = "2","162668459" = "3", "278139969" = "4", "676824724" = "5", "512144428" = "6","125674414" = "7", "406650257" = "8",  "700080862" = "9", "616621065" = "10", "927925620" = "(0)No hair loss", "552278254"= "(1) Mild Loss on Sides", "267104669"= "(2) Mild Loss on Top", "619337179"= "(3) Mild to Moderate","601381820"= "(4) Moderate Loss on Top", "151394571"= "(5) Severe Loss on Top", "917379905"= "(6) Severe Loss and Thinning",  "746328729"= "(7) Severe Loss Top and Forehead", "452963767"= "(8) All over Loss" , "629452816" = "(1) Mild Loss on Sides", "915557297" = "(2) Moderate Loss on Side","103565678" = "(3) Mild Loss and Thinning","381878591" = "(4) Moderate w/Crown Balding","446794016" = "(5) Thin Hair Strip Left Only","526238862" = "(6) Moderate to Severe", '173625583' = "(7) Thin Hair Strip Around the Head","782282163" = "(8) Mild Loss at Forehead","693010445" = "(9) Moderate Loss at Forehead","732008197" = "(10) Severe Loss at Forehead","734998477" = "(11) Mild Loss at Forehead, Beyond Ears", "111520945"="Not At All", "548628123"="A Little Bit", "597477164"="A Lot")

simple_funct1 <- function(CID, Title){
  CID_SYM <- rlang::ensym(CID)
  dt_select <- data_tib_base %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)

  gt_yn %>%  gt::gt()  %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md(Title)) %>%
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}
# 
# 
# #GT table with one filter/skip logic
one_logic_funct1 <- function(CID, CID_prev, Prev_Answer, Title){
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_base %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)

  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md(Title)) %>%
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}



# 
#GT table for siblings
sib_logic_funct <- function(CID, Sib_Num, Title){
  CID_SYM <- rlang::ensym(CID)
  data_tib_base$D_694265648 <- as.numeric(data_tib_base$D_694265648)
  dt_select <- data_tib_base %>%  filter(D_694265648 >= Sib_Num) %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)

  gt_yn %>%  gt::gt()  %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md(Title)) %>%
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  )
}
# 
# 
#GT table for children
child_logic_funct <- function(CID, Child_Num, Title){
  CID_SYM <- rlang::ensym(CID)
  data_tib_base$D_446999144 <- as.numeric(data_tib_base$D_446999144)
  dt_select <- data_tib_base %>%  filter(D_446999144 >= Child_Num) %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)

  gt_yn %>%  gt::gt()  %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md(Title)) %>%
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  )
}



```





\newpage
## Priority Three Variables

# AGECOR
```{r agecor, warning=FALSE, echo=FALSE, message=FALSE}

simple_funct1(D_479353866,"AGECOR: Age Reported Correct")


```


```{r sexorient, warning=FALSE, echo=FALSE, message=FALSE}
# # SEXORIENT- 'Other' Selected
# 
# #Need table that looks at responses by race
# race_columns <- c("D_384191091_D_384191091_D_583826374", 
#                   "D_384191091_D_384191091_D_636411467",
#                   "D_384191091_D_384191091_D_458435048",
#                   "D_384191091_D_384191091_D_706998638",
#                   "D_384191091_D_384191091_D_973565052",
#                   "D_384191091_D_384191091_D_586825330",
#                   "D_384191091_D_384191091_D_412790539",
#                   "D_384191091_D_384191091_D_807835037")
# 
# # All data is currently string values, need to convert "1" and "0" to 1 and 0 to be summarized
# data_tib_base[race_columns] <- lapply(data_tib_base[race_columns], as.numeric)
# data_tib_base$multi_racial <- ifelse(rowSums(data_tib_base[race_columns], na.rm = TRUE) > 1, 1, 0)
# 
# 
# data_tib_base= data_tib_base %>%  mutate(race= case_when(multi_racial==1 ~ "Multi-Racial",
#                                                      D_384191091_D_384191091_D_583826374==1 ~ "American Indian or Native American",
#                                                      D_384191091_D_384191091_D_636411467==1 ~ "Asian/Asian American",
#                                                      D_384191091_D_384191091_D_458435048==1 ~ "Black, African American, or African",
#                                                      D_384191091_D_384191091_D_706998638==1 ~ "Hispanic, Latino, or Spanish",
#                                                      D_384191091_D_384191091_D_973565052==1 ~ "Middle Eastern or North African",
#                                                      D_384191091_D_384191091_D_586825330==1 ~ "Hawaiian or Pacific Islander",
#                                                      D_384191091_D_384191091_D_412790539==1 ~ "White",
#                                                      (D_384191091_D_384191091_D_807835037==1 | !is.na(D_384191091_D_747350323)) ~ "Other",
#                                                      D_384191091_D_384191091_D_746038746==1 ~ "Prefer Not to Answer",
#                                                     D_384191091_D_384191091_D_178420302==1 ~ "Unknown",
#                                                      TRUE  ~ "Skipped this question "))
# 
# 
# #Also need table to look at age ranges (934298480 recruitment ranges )
# data_tib_base= data_tib_base %>%  mutate(age=case_when(state_d_934298480==124276120 ~ "40-45",
#                                          state_d_934298480==450985724 ~ "46-50",
#                                          state_d_934298480==363147933 ~ "51-55",
#                                          state_d_934298480==636706443 ~ "56-50",
#                                          state_d_934298480==771230670 ~ "61-65",
#                                                      TRUE  ~ "Skipped this Question"))
# 
# 
# 
# sexorient_raceage_table <- data_tib_base %>% filter(!is.na(D_555481393_D_979809707) & age!="Skipped this Question" & race!="Skipped this Question") %>% dplyr::group_by(age, race) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup()  %>%  dplyr::select(age, race, n, percentage)
# 
# sexorient_raceage_table_gt <- sexorient_raceage_table %>%  gt::gt(rowname_col = "row_lab") %>%  
#   cols_label(n= md("**N**"), age="Age", race="Race", percentage = md("**%**")) %>% 
#   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#       stub.font.weight = "bold"
#     ) 
# 
# 
# 
# 
# sexorient <- data_tib_base %>%  filter(!is.na(D_555481393_D_979809707))
# sexorient$sexuality=tolower(sexorient$D_555481393_D_979809707)
# sexorient$sexuality_no_spaces = gsub(" ", "", sexorient$D_555481393_D_979809707)
# 
# 
# 
# sexorient= sexorient  %>%  mutate(sexuality= case_when(tolower(D_555481393_D_979809707)=="asexual" | tolower(D_555481393_D_979809707)=="a sexual" ~ "Asexual",
#                                                            tolower(D_555481393_D_979809707)=="pansexual" | tolower(D_555481393_D_979809707)=="pan sexual" | tolower(D_555481393_D_979809707)=="pan"~ "Pansexual",
#                                                            tolower(D_555481393_D_979809707)=="queer"~ "Queer",
#                                                            tolower(D_555481393_D_979809707)=="straight" | D_555481393_D_979809707=="hetero" ~ "Straight",
#                                                           is.na(D_555481393_D_979809707)~ "Skipped this Question",
#                                                       TRUE ~ "Other"))
# 
# 
# sexorient_table1 <- sexorient %>% filter(!is.na(D_555481393_D_979809707) & age!="Skipped this Question" & race!="Skipped this Question") %>% dplyr::group_by(age, race, sexuality) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup()  %>%  dplyr::select(age, race, sexuality, n, percentage)
# 
# sexorient_age_race_gt <-  sexorient_table1 %>%  gt::gt(rowname_col = "row_lab") %>%  
#   cols_label(n= md("**N**"), age="Age", race="Race", sexuality="'Other Sexuality' Response", percentage = md("**%**")) %>% 
#   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
#   tab_options(
#       stub.font.weight = "bold"
#     ) 
# 
# 


```

# MARTIAL 
```{r marital, warning=FALSE, echo=FALSE, message=FALSE}


simple_funct1(D_783167257, "MARITAL: Marital Status")



```
# BLDTRANS
```{r bloodtrans, warning=FALSE, echo=FALSE, message=FALSE}

simple_funct1(D_453252072, "BLDTRANS: Ever have a Blood Transfusion")



```

# PAIN1-3
```{r pain, warning=FALSE, echo=FALSE, message=FALSE}
##Pain
#Last 3 Months
simple_funct1(D_323512813, "PAIN: Felt Physial Pain Most Days of Last 3 Months")

#Scale
data_tib_base$D_338924834 <- factor(data_tib_base$D_338924834, levels=c(988858078,156095877,162668459,278139969, 676824724, 512144428, 125674414, 406650257, 700080862, 616621065, "Skipped this Question"))
one_logic_funct1(D_338924834, D_323512813, "353358909", "PAIN2: Rank of Pain")


#Affected Work?
data_tib_base$D_952682839 <- factor(data_tib_base$D_952682839, levels=c(111520945, 548628123, 597477164, "Skipped this Question"))
one_logic_funct1(D_952682839, D_323512813, "353358909", "PAIN3: Pain Get in the Way of Work")


```

# HEIGHTFEET & ADUHEIGHT
```{r HeightSetUp, include=FALSE}

#height- current
data_tib_base$D_114314839_D_340854069=as.numeric(data_tib_base$D_114314839_D_340854069)
ifelse(is.na(data_tib_base$D_114314839_D_340854069), 0,(data_tib_base$D_114314839_D_340854069))
data_tib_base$D_114314839_D_600462977=as.numeric(data_tib_base$D_114314839_D_600462977)
ifelse(is.na(data_tib_base$D_114314839_D_600462977), 0, (data_tib_base$D_114314839_D_600462977))


in_D_inches= (as.numeric(data_tib_base$D_114314839_D_340854069)*12)+ as.numeric(data_tib_base$D_114314839_D_600462977)
```

```{r Ht, warning=FALSE, echo=FALSE, message=FALSE}
hist_funct(in_D_inches, "Current Height Distribution (converted to inches)", "Inches", "Frequency")

#ADUHEIGHT
boxp_funct(D_677262300, "ADUHEIGHT: Age Adult Height Reached", "Age")


#ADUWEIGHT (removed?)

```



# WEIGHT3Y & WEIGHTHIS
```{r weight3y, warning=FALSE, echo=FALSE, message=FALSE}

#Weight over the years 
weight3=boxp_funct(D_724181652,"Weight 3 years ago","Weight")
weight18=boxp_funct(D_912857732_D_821387277,"Weight at 18","Weight")
weight25=boxp_funct(D_912857732_D_121646540,"Weight at 25","Weight")
weight35=boxp_funct(D_912857732_D_950080618,"Weight at 35","Weight")
weight45=boxp_funct(D_912857732_D_407167089,"Weight at 45","Weight")
weight55=boxp_funct(D_912857732_D_503154158,"Weight at 55","Weight")
grid.arrange(weight3, weight18, weight25, nrow=3)
grid.arrange(weight35,weight45, weight55, nrow=3)

```

# WTLOSS1 
```{r weightloss, warning=FALSE, echo=FALSE, message=FALSE}


data_tib_base$D_912857732_D_821387277 <- as.numeric(data_tib_base$D_912857732_D_821387277, na.rm=T)
data_tib_base$D_912857732_D_121646540 <- as.numeric(data_tib_base$D_912857732_D_121646540, na.rm=T)
data_tib_base$D_912857732_D_950080618 <- as.numeric(data_tib_base$D_912857732_D_950080618, na.rm=T)
data_tib_base$D_912857732_D_407167089 <- as.numeric(data_tib_base$D_912857732_D_407167089, na.rm=T)
data_tib_base$D_912857732_D_503154158 <- as.numeric(data_tib_base$D_912857732_D_503154158, na.rm=T)


diff25 <- (data_tib_base$D_912857732_D_121646540-data_tib_base$D_912857732_D_821387277)/data_tib_base$D_912857732_D_821387277
diff35 <- (data_tib_base$D_912857732_D_950080618-data_tib_base$D_912857732_D_121646540)/data_tib_base$D_912857732_D_121646540
diff45 <- (data_tib_base$D_912857732_D_407167089-data_tib_base$D_912857732_D_950080618)/data_tib_base$D_912857732_D_950080618
diff55 <- (data_tib_base$D_912857732_D_503154158-data_tib_base$D_912857732_D_407167089)/data_tib_base$D_912857732_D_407167089






WGT1825= data_tib_base %>%  filter(diff25<(-0.05)) %>%  mutate(meds= case_when(D_808806810==353358909 ~ "Yes",
                                                   D_808806810==104430631 ~ "No",
                                                   TRUE ~ "Skipped this Question"))


WGT1825_summary <- WGT1825 %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


WGT1825_summary %>%  gt::gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Weight Loss Between 18-25 Years Old Purposeful")) %>% 
  cols_label(n= md("**N**"), meds = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 


# #weight loss (25-35) on purpose?

WGT2535= data_tib_base %>%  filter(diff35<(-0.05)) %>%  mutate(meds= case_when(D_803129396==353358909 ~ "Yes",
                                                   D_803129396==104430631 ~ "No",
                                                   TRUE ~ "Skipped this Question"))


WGT2535_summary <- WGT2535 %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


WGT2535_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Weight Loss Between 25-35 Years Old Purposeful")) %>% 
  cols_label(n= md("**N**"), meds = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 


# #weight loss (35-45) on purpose?
# simple_funct1(D_183572295, "Weight Loss Between 18-25 Years Old Purposeful")

WGT3545= data_tib_base %>%  filter(diff45<(-0.05)) %>%  mutate(meds= case_when(D_183572295==353358909 ~ "Yes",
                                                   D_183572295==104430631 ~ "No",
                                                   TRUE ~ "Skipped this Question"))


WGT3545_summary <- WGT3545 %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


WGT3545_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Weight Loss Between 35-45 Years Old Purposeful")) %>% 
  cols_label(n= md("**N**"), meds = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 


# #weight loss (45-55) on purpose?
# simple_funct1(D_837402132, "Weight Loss Between 18-25 Years Old Purposeful")

WGT4555= data_tib_base %>%  filter(diff55<(-0.05)) %>%  mutate(meds= case_when(D_837402132==353358909 ~ "Yes",
                                                   D_837402132==104430631 ~ "No",
                                                   TRUE ~ "Skipped this Question"))


WGT4555_summary <- WGT4555 %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


WGT4555_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("Weight Loss Between 45-55 Years Old Purposeful")) %>% 
  cols_label(n= md("**N**"), meds = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 


```


# WTLOSS2
```{r weight loss how, warning=FALSE, echo=FALSE, message=FALSE}

dt_wt1825= data_tib_base  %>%  filter(diff25<(-0.05)) # & D_514996698=="353358909"

dt_wt1825= dt_wt1825  %>%  mutate(multc1 = ifelse(D_207025341_D_207025341_D_934037640==1, 1, 0) + ifelse(D_207025341_D_207025341_D_990501908==1, 1, 0) + ifelse(D_207025341_D_207025341_D_691423127==1, 1, 0) + ifelse(D_207025341_D_207025341_D_203773667==1, 1, 0) + ifelse(D_207025341_D_207025341_D_862170896==1, 1, 0) + ifelse(D_207025341_D_207025341_D_448594163==1, 1, 0) + ifelse(D_207025341_D_207025341_D_807835037==1, 1, 0))

method= dt_wt1825  %>%  mutate(weight= case_when(as.numeric(multc1)>1  ~ "Multiple Methods",
                                                 D_207025341_D_207025341_D_934037640==1 ~ "Changed Diet",
                                                 D_207025341_D_207025341_D_990501908==1 ~ "Exercised",
                                                 D_207025341_D_207025341_D_691423127==1 ~ "Skipped Meals",
                                                 D_207025341_D_207025341_D_203773667==1 ~ "Surgery",
                                                 D_207025341_D_207025341_D_862170896==1 ~ "Diet Pills",
                                                 D_207025341_D_207025341_D_448594163==1 ~ "Smoking", 
                                                 (D_207025341_D_207025341_D_807835037==1 | !is.na(D_207025341_D_155535868)) ~ "Other Method",
                                                 TRUE ~ "Skipped this Question"))
method$weight <- factor(method$weight,levels=c("Multiple Methods","Changed Diet", "Exercised","Skipped Meals","Surgery","Diet Pills","Smoking", 
                                               "Other Method","Skipped this Question"))


dt_wt1825_summary <- method %>% dplyr::group_by(weight) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(weight, n, percentage) 

dt_wt1825_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WTLOSS2_1825: Method of Weight Loss Ages 18-25")) %>% 
  cols_label(n= md("**N**"), weight = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = weight,
    )
  ) 



#how did you lose the weight 25-35? 
dt_wt2535= data_tib_base %>%  filter(diff35<(-0.05)) #& D_194396716=="353358909"

dt_wt2535= dt_wt2535  %>%  mutate(multc1 = ifelse(D_827393644_D_827393644_D_934037640==1, 1, 0) + ifelse(D_827393644_D_827393644_D_990501908==1, 1, 0) + ifelse(D_827393644_D_827393644_D_691423127==1, 1, 0) + ifelse(D_827393644_D_827393644_D_203773667==1, 1, 0) + ifelse(D_827393644_D_827393644_D_862170896==1, 1, 0) + ifelse(D_827393644_D_827393644_D_448594163==1, 1, 0) + ifelse(D_827393644_D_827393644_D_807835037==1, 1, 0)) 

method= dt_wt2535  %>%  mutate(weight= case_when(as.numeric(multc1)>1  ~ "Multiple Methods",
                                                 D_827393644_D_827393644_D_934037640==1 ~ "Changed Diet",
                                                 D_827393644_D_827393644_D_990501908==1 ~ "Exercised",
                                                 D_827393644_D_827393644_D_691423127==1 ~ "Skipped Meals",
                                                 D_827393644_D_827393644_D_203773667==1 ~ "Surgery",
                                                 D_827393644_D_827393644_D_862170896==1 ~ "Diet Pills",
                                                 D_827393644_D_827393644_D_448594163==1 ~ "Smoking", 
                                                 (D_827393644_D_827393644_D_807835037==1 | !is.na(D_827393644_D_899840609)) ~ "Other Method",
                                                 TRUE ~ "Skipped this Question"))
method$weight <- factor(method$weight,levels=c("Multiple Methods","Changed Diet", "Exercised","Skipped Meals","Surgery","Diet Pills","Smoking", "Other Method","Skipped this Question"))

dt_wt2535_summary <- method %>% dplyr::group_by(weight) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(weight, n, percentage) 

dt_wt2535_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WTLOSS2_2535: Method of Weight Loss Ages 25-35")) %>% 
  cols_label(n= md("**N**"), weight = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = weight,
    )
  ) 



#how did you lose the weight 35-45?
dt_wt3545= data_tib_base   %>%  filter(diff45<(-0.05)) #& D_649776532=="353358909"

dt_wt3545= dt_wt3545  %>%  mutate(multc1 = ifelse(D_630675760_D_630675760_D_934037640==1, 1, 0) + ifelse(D_630675760_D_630675760_D_990501908==1, 1, 0) + ifelse(D_630675760_D_630675760_D_691423127==1, 1, 0) + ifelse(D_630675760_D_630675760_D_203773667==1, 1, 0) + ifelse(D_630675760_D_630675760_D_862170896==1, 1, 0) + ifelse(D_630675760_D_630675760_D_448594163==1, 1, 0) + ifelse(D_630675760_D_630675760_D_807835037==1, 1, 0))

method= dt_wt3545  %>%  mutate(weight= case_when(as.numeric(multc1)>1  ~ "Multiple Methods",
                                                 D_630675760_D_630675760_D_934037640==1 ~ "Changed Diet",
                                                 D_630675760_D_630675760_D_990501908==1 ~ "Exercised",
                                                 D_630675760_D_630675760_D_691423127==1 ~ "Skipped Meals",
                                                 D_630675760_D_630675760_D_203773667==1 ~ "Surgery",
                                                 D_630675760_D_630675760_D_862170896==1 ~ "Diet Pills",
                                                 D_630675760_D_630675760_D_448594163==1 ~ "Smoking", 
                                                 (D_630675760_D_630675760_D_807835037==1 | !is.na(D_630675760_D_660541817)) ~ "Other Method",
                                                 TRUE ~ "Skipped this Question"))
method$weight <- factor(method$weight,levels=c("Multiple Methods","Changed Diet", "Exercised","Skipped Meals","Surgery","Diet Pills","Smoking", "Other Method","Skipped this Question"))

dt_wt3545_summary <- method %>% dplyr::group_by(weight) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(weight, n, percentage) 

dt_wt3545_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WTLOSS2_3545: Method of Weight Loss Ages 35-45")) %>% 
  cols_label(n= md("**N**"), weight = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = weight,
    )
  ) 




#how did you lose the weight 45-55?
dt_wt4555= data_tib_base  %>%  filter(diff55<(-0.05)) #& D_221338826=="353358909"

dt_wt4555= dt_wt4555  %>%  mutate(multc1 = ifelse(D_827393644_D_827393644_D_934037640==1, 1, 0) + ifelse(D_827393644_D_827393644_D_990501908==1, 1, 0) + ifelse(D_827393644_D_827393644_D_691423127==1, 1, 0) + ifelse(D_827393644_D_827393644_D_203773667==1, 1, 0) + ifelse(D_827393644_D_827393644_D_862170896==1, 1, 0) + ifelse(D_827393644_D_827393644_D_448594163==1, 1, 0) + ifelse(D_827393644_D_827393644_D_807835037==1, 1, 0))

method= dt_wt4555  %>%  mutate(weight= case_when(as.numeric(multc1)>1  ~ "Multiple Methods",
                                                 D_431628922_D_431628922_D_934037640==1 ~ "Changed Diet",
                                                 D_431628922_D_431628922_D_990501908==1 ~ "Exercised",
                                                 D_431628922_D_431628922_D_691423127==1 ~ "Skipped Meals",
                                                 D_431628922_D_431628922_D_203773667==1 ~ "Surgery",
                                                 D_431628922_D_431628922_D_862170896==1 ~ "Diet Pills",
                                                 D_431628922_D_431628922_D_448594163==1 ~ "Smoking", 
                                                 (D_431628922_D_431628922_D_807835037==1 | !is.na(D_431628922_D_963867920)) ~ "Other Method",
                                                 TRUE ~ "Skipped this Question"))
method$weight <- factor(method$weight,levels=c("Multiple Methods","Changed Diet", "Exercised","Skipped Meals","Surgery","Diet Pills","Smoking", "Other Method","Skipped this Question"))

dt_wt4555_summary <- method %>%  dplyr::group_by(weight) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(weight, n, percentage) 

dt_wt4555_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WTLOSS2_4555: Method of Weight Loss Ages 45-55")) %>% 
  cols_label(n= md("**N**"), weight = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = weight,
    )
  ) 


```

# SHORTER1 & SHORTER2
```{r shorter, warning=FALSE, echo=FALSE, message=FALSE}

#shorter now than 20s/30s?
simple_funct1(D_848580651, "SHORTER: Shorter now than 20's and 30's")



#how much shorter?
merged %>% mutate(D_207494582=as.numeric(as.character(D_207494582))) %>%
  filter(!is.na(D_207494582)) %>%
  ggplot(aes(x=D_207494582))+
  xlab("Inches") + ylab("Frequency") + geom_histogram()+  ggtitle("How much shorter than 20s/30s")+
  geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
  geom_vline(aes(xintercept=mean(D_207494582, na.rm=T)), colour="#3C989E", linetype="solid")

```

# CARWEIGHT
```{r carweight, warning=FALSE, echo=FALSE, message=FALSE}

#where do you carry your body weight 
 
location= data_tib_base  %>%  mutate(weight= case_when(D_936904328_D_245893583==1 & D_936904328_D_506790433==1 & D_936904328_D_601057066==1 ~ "In All Locations",
                                                     D_936904328_D_245893583==1 & D_936904328_D_506790433==1 ~ "Chest & Waist",
                                                     D_936904328_D_245893583==1 & D_936904328_D_601057066==1 ~ "Chest & Hips",
                                                     D_936904328_D_506790433==1 & D_936904328_D_601057066==1 ~ "Waist & Hips",
                                                     D_936904328_D_245893583==1 ~ "Chest/Shoulders",
                                                     D_936904328_D_506790433==1 ~ "Waist/Stomach",
                                                     D_936904328_D_601057066==1 ~ "Hips/Thigh",
                                                     TRUE ~ "Skipped this Question"))
location$weight <- factor(location$weight,levels=c( "Chest/Shoulders","Waist/Stomach", "Hips/Thigh",  "Chest & Waist", "Chest & Hips","Waist & Hips","In All Locations", "Skipped this Question"))

dt_wt_carry_summary <- location %>% dplyr::group_by(weight) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(weight, n, percentage) 

dt_wt_carry_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("CARWEIGHT: Location of Carrying Body Weight")) %>% 
  cols_label(n= md("**N**"), weight = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = weight,
    )
  ) 
```

# HAIRFEM & HAIRMALE
```{r height, warning=FALSE, echo=FALSE, message=FALSE}

#Female

data_tib_base$D_365851428 <- factor(data_tib_base$D_365851428, levels=c(927925620,552278254,267104669,619337179,601381820,151394571,917379905,746328729,452963767, "Skipped this Question"))
one_logic_funct1(D_365851428, D_407056417, "536341288" ,"Level of Hair Loss (Female)")



#Male
data_tib_base$D_206319592 <- factor(data_tib_base$D_206319592, levels=c(927925620,629452816,915557297,103565678,381878591,446794016,526238862,173625583,782282163,693010445,732008197,734998477, "Skipped this Question"))
one_logic_funct1(D_206319592, D_407056417, "654207589" ,"Level of Hair Loss (Male)")


```

# HRMED1-4
```{r hairmed, warning=FALSE, echo=FALSE, message=FALSE}

#Taken meds for hair thinning?
simple_funct1(D_769668224, "HRMED: Ever Taken Hair Thinning Medication")

```

```{r hairmedtype, include=FALSE}

#What type?

dt_hrmed_typ= data_tib_base   %>%  filter(D_769668224==353358909)    %>%  
                          mutate(med= case_when(D_814664694_D_814664694_D_903825143==1 ~ "Rogaine, Minoxidil, or Ioniten",
                                                D_814664694_D_814664694_D_567365088==1 ~ "Finasteride",
                                                (D_814664694_D_814664694_D_807835037==1 | !is.na(D_814664694_D_787193493)) ~ "Other",
                                                TRUE ~ "Skipped this Question"))



tmp_hrm2 <- data_tib_base %>%  filter(data_tib_base$D_769668224==353358909)
tmp_hr2<- tmp_hrm2[, grepl("814664694", colnames(tmp_hrm2))]

tmpM2 <- tmp_hr2 %>%  select(-"D_814664694_D_787193493")
#tmpM2 <- tmp_hr2[, c(5, 2, 4)]
hrm2_dx <- NULL
for (i in 1:3){
  dt <- as.data.frame(tab1(tmpM2[,i])$output.table)
  dt$hrm2_dx <- colnames(tmpM2)[i]
  hrm2_dx <- rbind(hrm2_dx,dt[2,])

}


hrm2_dx$hrm2_dx <- c("Rogaine, Minoxidil, or Ioniten","Finasteride","Other")
```

```{r  hairmedtypetable, warning=FALSE, echo=FALSE, message=FALSE}
colnames(hrm2_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
hrm2 <- hrm2_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_hrmed_typ$med=="Skipped this Question")[2])
hrm2[as.numeric(dim(hrm2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(data_tib_base)[[1]])*100,2))

dt_hrm2 <- hrm2 %>%  gt::gt(rowname_col = "row_lab") %>%
  tab_header(title = md("HRMED2: Type of Hair Thinning Medication")) %>%
  cols_label(Frequency= md("**N**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_hrm2,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

#Hair thinning med time
hairthin1=boxp_funct(D_109544008,"Age Hair Thinning Medication First Used","Age")
hairthin0=boxp_funct(D_186831207,"Age Hair Thinning Medication Last Used","Age")
grid.arrange(hairthin1, hairthin0, nrow=2)

```

# ACNE1, ACNE2
```{r acne, warning=FALSE, echo=FALSE, message=FALSE}

##Acne
#See doctor for severe/ongoing acne?
simple_funct1(D_283634623, "ACNE: Ever Seen a Doctor for Sever Acne")



#How old at first visit?
boxp_funct(D_164752169,"Age Doctor Visited for Acne","Age")

```

# ACNEMED 1-3
```{r acnemed, warning=FALSE, echo=FALSE, message=FALSE}

#Used prescription meds?
one_logic_funct1(D_512167179, D_283634623, 353358909, "ACNEMED: Ever Taken Medication for Severe Acne")



#Acne meds timeframe
acne1=boxp_funct(D_509933065,"Age Meds First Used to Treat Acne","Age")
acne0=boxp_funct(D_967093163,"Age Meds Last Used to Treat Acne","Age")
grid.arrange(acne1, acne0, nrow=2)

```


# ADOPFOST, MULTBIRTH 
```{r adoptmult, warning=FALSE, echo=FALSE, message=FALSE}
#Foster/Adopted
simple_funct1(D_535621923, "ADOPTFOST: Adopted or Foster Child")



#Twin/multiple
simple_funct1(D_992987417, "MULTBIRTH: A Twin or Multiple")



```



# MOM1
```{r mom1, warning=FALSE, echo=FALSE, message=FALSE}

##Mom
#living
simple_funct1(D_170440011, "MOM1: Mother Living")




```

# MOMAGE & MOMDEATH
```{r momagedeath, warning=FALSE, echo=FALSE, message=FALSE}

#age now
boxp_funct(D_354326265_D_378988419,"Mother's Current Age","Age")


#age at deaths
boxp_funct(D_422714611_D_807765962,"Mother's Age at Death","Age")

```

# DAD1
```{r dad1, warning=FALSE, echo=FALSE, message=FALSE}

##Dad
#living?
simple_funct1(D_367374606, "DAD: Father Living")



```

# DADAGE & DADDEATH
```{r dadagedeath, warning=FALSE, echo=FALSE, message=FALSE}


#age now)
boxp_funct(D_178774803_D_334956961,"Father's Current Age","Age")

#age at death?
boxp_funct(D_628078826_D_517670352,"Father's Age at Death","Age") 


```

# SIB, SIB2, SIB3
```{r sib, warning=FALSE, echo=FALSE, message=FALSE}

#how many siblings do you have
hist_funct(D_694265648, "SIB1: Number of Siblings", "Siblings", "Frequency")


levels=c("Female", "Male", "Intersex", "Unknown", "Skipped this Question")
sib_logic_funct(D_579563781_1_1, 1, "SIB2_1: Sibling 1 Sex")


# Full or half
#factor(data_tib_base$D_589588769_1_1, levels=c("Full Sibling", "Half sibling, same mother", "Half sibling, same father", "Skipped this Question"))
levels=c("Full Sibling", "Half sibling, same mother", "Half sibling, same father", "Skipped this Question")
sib_logic_funct(D_589588769_1_1, 1, "SIB3_1: Sibling 1 a Full or Half Sibling")


```

# MULT2 
```{r sibmult, warning=FALSE, echo=FALSE, message=FALSE}



MULT2_1= data_tib_base %>% filter(as.numeric(D_694265648 ) >=1 & (D_992987417==353358909 | D_992987417==288105839 | D_992987417==626558982))
MULT2_1= MULT2_1 %>%  mutate(meds= case_when(D_807431780_1_1==353358909 ~ "Yes",
                                             D_807431780_1_1==104430631 ~ "No",
                                             TRUE ~ "Skipped this Question"))


MULT2_1_summary <- MULT2_1 %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


MULT2_1_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("MULT2_1: Sibling 1 Your Twin or Multiple")) %>% 
  cols_label(n= md("**N**"), meds = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 

```

# SIB4
```{r sib4, warning=FALSE, echo=FALSE, message=FALSE}

levels=c("Yes", "No", "Unknown", "Skipped this Question")
sib_logic_funct(D_890637099_1_1, 1, "SIB4_1: Sibling 1 Still Living")


```

# SIBAGE/SIBDEATH
```{r sibagedeath, warning=FALSE, echo=FALSE, message=FALSE}

sib1_age=boxp_funct(D_869387390_1_1_D_478706011_1,"SIBAGE1: Age of Sibling 1 Today", "Age")
sib2_age=boxp_funct(D_869387390_2_2_D_478706011_2,"SIBAGE2: Age of Sibling 2 Today", "Age")
sib3_age=boxp_funct(D_869387390_3_3_D_478706011_3,"SIBAGE3: Age of Sibling 3 Today", "Age")
sib4_age=boxp_funct(D_869387390_4_4_D_478706011_4,"SIBAGE4: Age of Sibling 4 Today", "Age")

grid.arrange(sib1_age,sib2_age,sib3_age,sib4_age, nrow=2)






sib1_death=boxp_funct(D_537137982_1_1_D_338020179_1,"SIBDEATH1: Age of Sibling 1 At Death", "Age")
data_tib_base$D_537137982_2_2_D_338020179_2=as.numeric(data_tib_base$D_537137982_2_2_D_338020179_2)
data_tib_base$D_537137982_2_2_D_338020179_2=round(data_tib_base$D_537137982_2_2_D_338020179_2, digits=0)#correcting for ages given in decimal places
sib2_death=boxp_funct(D_537137982_2_2_D_338020179_2,"SIBDEATH2: Age of Sibling 2 At Death", "Age")
data_tib_base$D_537137982_3_3_D_338020179_3=as.numeric(data_tib_base$D_537137982_3_3_D_338020179_3)
data_tib_base$D_537137982_3_3_D_338020179_3=round(data_tib_base$D_537137982_3_3_D_338020179_3, digits=0) #correcting for ages given in decimal places
sib3_death=boxp_funct(D_537137982_3_3_D_338020179_3,"SIBDEATH3: Age of Sibling 3 At Death", "Age")
sib4_death=boxp_funct(D_537137982_4_4_D_338020179_4,"SIBDEATH4: Age of Sibling 4 At Death", "Age")

grid.arrange(sib1_death,sib2_death,sib3_death,sib4_death, nrow=2)



```

# CHILD, CHILD2, CHILD3
```{r child13, warning=FALSE, echo=FALSE, message=FALSE}

#how many children do you have?
#hist_funct(D_446999144, "Number of Children", "Children", "Frequency")
CHILD= data_tib_base %>%  mutate(meds= case_when(as.numeric(D_446999144)==0 ~ "0",
                                         as.numeric(D_446999144)==1 ~ "1",
                                         as.numeric(D_446999144)==2 ~ "2",
                                         as.numeric(D_446999144)==3 ~ "3",
                                         as.numeric(D_446999144)==4 ~ "4",
                                         as.numeric(D_446999144)<10 ~ "5-9",
                                         as.numeric(D_446999144)>=10 ~ "10 or more",
                                               TRUE ~ "Skipped this Question"))
CHILD$meds <- factor(CHILD$meds,levels=c("0","1","2","3","4","5-9", "10 or more","Skipped this Question"))

CHILD_summary <- CHILD %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)

CHILD_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("CHILD: Number of Children")) %>% 
  cols_label(n= md("**N**"), meds = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 


levels=c("Female", "Male", "Intersex", "Unknown", "Skipped this Question")
child_logic_funct(D_887697329_1_1, 1, "CHILD2_1: Child 1 Sex")



#full/half
levels=c("Your biological child","Adopted","A Step Child","Related to me in some other way","Skipped this Question")
child_logic_funct(D_873968217_1_1, 1, "CHILD3_1: Child 1 Family Relation")


```


# CHILDMULT
```{r childmult, warning=FALSE, echo=FALSE, message=FALSE}

levels=c("Yes", "No", "Skipped this Question")
child_logic_funct(D_473529484_1_1, 1, "CHILDMULT_1: Child 1 a Twin or Multiple")


```


# CHILD4
```{r child4, warning=FALSE, echo=FALSE, message=FALSE}

levels=c("Yes", "No", "Unknown", "Skipped this Question")
child_logic_funct(D_418392907_1_1, 1, "CHILD4_1: Child 1 Still Living")



```


# CHILDAGE & CHILDDEATH
```{r childagedeath, warning=FALSE, echo=FALSE, message=FALSE}

ch1_age=boxp_funct(D_640010727_1_1_D_299300933_1,"Age of Child 1 Today", "Age")
ch2_age=boxp_funct(D_640010727_2_2_D_299300933_2,"Age of Child 2 Today", "Age")
ch3_age=boxp_funct(D_640010727_3_3_D_299300933_3,"Age of Child 3 Today", "Age")
ch4_age=boxp_funct(D_640010727_4_4_D_299300933_4,"Age of Child 4 Today", "Age")

grid.arrange(ch1_age,ch2_age,ch3_age,ch4_age, nrow=2)



ch1_age_d=boxp_funct(D_236590500_1_1_D_182786508_1,"Age of Child 1 at Death", "Age")
ch2_age_d=boxp_funct(D_236590500_2_2_D_182786508_2,"Age of Child 2 at Death", "Age")
ch3_age_d=boxp_funct(D_236590500_3_3_D_182786508_3,"Age of Child 3 at Death", "Age")
ch4_age_d=boxp_funct(D_236590500_4_4_D_182786508_4,"Age of Child 4 at Death", "Age")

grid.arrange(ch1_age_d,ch2_age_d,ch3_age_d, ch4_age_d, nrow=2) 



```


# STUDENT
```{r student, warning=FALSE, echo=FALSE, message=FALSE}
simple_funct1(D_784967158, "STUDENT: Currently Enrolled in School")


```

# WORK, WORK2, WORK3
```{r work13, warning=FALSE, echo=FALSE, message=FALSE}

# WORK

simple_funct1(D_613744428, "WORK: Currently Work for Pay")




#work status
one_logic_funct1(D_114529380, D_613744428, 104430631, "WORK2: Employment Status")


#current job title  
work3 <- data_tib_base %>% select(D_627122657) %>%  filter(data_tib_base$D_613744428==353358909)
work3= work3 %>%  mutate(Address1= case_when(is.na(D_627122657)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_work3_summary <- work3 %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_work3_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WORK3: Title of Current Job")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 




```

# OCCUPTN1
```{r occup1, warning=FALSE, echo=FALSE, message=FALSE}

#current ocupational category

home1skip <- data_tib_base %>% select(D_761310265) %>%  filter(data_tib_base$D_613744428==353358909)
home1skip= home1skip %>%  mutate(Address1= case_when(is.na(D_761310265)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_home1skip_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("OCCUPTN1: Occupation Category of Current Job")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 

```

# EMPLYR1, EMPLYRSRVCE1
```{r emplyr, warning=FALSE, echo=FALSE, message=FALSE}

#name of current employer
##table(merged$D_434316600) #-- potentially identifying? And Very long with individual reponses


home1skip <- data_tib_base %>% select(D_434316600) %>%  filter(data_tib_base$D_613744428==353358909)
home1skip= home1skip %>%  mutate(Address1= case_when(is.na(D_434316600)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_home1skip_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("EMPLYR1:Name of Current Employer")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 


#products made/services provided from current employer


home1skip <- data_tib_base %>% select(D_868232409)  %>%  filter(data_tib_base$D_613744428==353358909)
home1skip= home1skip %>%  mutate(Address1= case_when(is.na(D_868232409)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_home1skip_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("EMPLYRSRVCE1: Products or Services of Current Employer")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 

```

# WORK4-7
```{r work47, warning=FALSE, echo=FALSE, message=FALSE}


#data_tib_base$D_739294356=as.numeric(as.character(data_tib_base$D_739294356))
WORK4= data_tib_base %>%  filter(data_tib_base$D_613744428==353358909 & !is.na(D_868232409)) %>% 
                mutate(answer= case_when(as.numeric(D_739294356)==0 ~ "0",
                                         as.numeric(D_739294356)<11 & as.numeric(D_739294356)>0 ~ "1-10",
                                         as.numeric(D_739294356)<21 & as.numeric(D_739294356)>10 ~ "11-20",
                                         as.numeric(D_739294356)<30 & as.numeric(D_739294356)>20 ~ "21-30",
                                         as.numeric(D_739294356)<40 & as.numeric(D_739294356)>30 ~ "31-40",
                                         as.numeric(D_739294356)<51 & as.numeric(D_739294356)>40 ~ "41-50",
                                         as.numeric(D_739294356)<50 ~ "Over 50 Years",
                                               TRUE ~ "Skipped this Question"))
WORK4$answer <- factor(WORK4$answer,levels=c("0","1-10","11-20","21-30","31-40","41-50", "Over 50 Years","Skipped this Question"))

WORK4_summary <- WORK4 %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

WORK4_summary %>%  gt::gt(rowname_col = "row_lab") %>% 
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("WORK4: Years at Current Job")) %>%
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 




#this current position your longest held position?

work5 <- data_tib_base  %>%  filter(!is.na(D_868232409))


work5_ans= work5 %>%  mutate(answer= case_when(D_847533056==353358909 ~ "Yes",
                                             D_847533056==104430631 ~ "No",
                                             TRUE ~ "Skipped this Question"))

dtwork5_summary <- work5_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

dtwork5_summary %>%  gt::gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WORK5: Current Job the Longest Held Job")) %>% 
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 



#ever worked for pay?
one_logic_funct1(D_403258164, D_613744428,104430631,"WORK6: Ever Work")


#longest held job title work7
##table(merged$D_118061122) #- potentially identifiable and a very long list with individual responses 
home1skip <- data_tib_base %>% filter(D_403258164==353358909 | D_847533056!=353358909) %>% select(D_118061122)
home1skip= home1skip %>%  mutate(Address1= case_when(is.na(D_118061122)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_home1skip_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("WORK7: Job Title (Longest Held Position")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 


```

# OCCUPTN2
```{r occup2, warning=FALSE, echo=FALSE, message=FALSE}

#Occupational category for longest held job--OCCUPTN2

home1skip <- data_tib_base%>% filter(D_403258164==353358909 | D_847533056!=353358909) %>% select(D_279637054)
home1skip= home1skip %>%  mutate(Address1= case_when(is.na(D_279637054)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_home1skip_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("OCCUPTN2: Occupation Category of Longest Held Job")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 

```

# EMPLYR2 & EMPLYRSRVCE2
```{r emplyr2, warning=FALSE, echo=FALSE, message=FALSE}

#employers name for longest held job--EMPLYR2
home1skip <- data_tib_base%>% filter(D_403258164==353358909 | D_847533056!=353358909) %>% select(D_988878019)
home1skip= home1skip %>%  mutate(Address1= case_when(is.na(D_988878019)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_home1skip_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("EMPLYR1:Name of Longest Employer")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 


#Products made/services provided for longest held job--EMPLYRSRVCE2
home1skip <- data_tib_base%>% filter(D_403258164==353358909 | D_847533056!=353358909) %>% select(D_233198706)
home1skip= home1skip %>%  mutate(Address1= case_when(is.na(D_233198706)~"Skipped this Question",
                                                     TRUE ~ "Provided a Response"))
  
dt_home1skip_summary <- home1skip %>% dplyr::group_by(Address1) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(Address1, n, percentage)
  
  
dt_home1skip_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("EMPLYRSRVCE2: Products or Services of Longest Employer")) %>% 
  cols_label(n= md("**N**"),Address1 = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Address1,
    )
  ) 


```

# WORK8
```{r work8, warning=FALSE, echo=FALSE, message=FALSE}

#yrs at longest held position 
merged %>% mutate(D_686172464=as.numeric(as.character(D_686172464))) %>%
  filter((D_403258164==353358909 | D_847533056!=353358909) & !is.na(D_686172464)) %>% 
  ggplot(aes(x=D_686172464, fill=D_407056417))+
  xlab("Years") + ylab("Frequency") + geom_histogram()+  ggtitle("WORK8: Years at Longest Held Position")+
  geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
  scale_fill_discrete(name = "Sex", labels=c("Female", "Male"))+
  geom_vline(aes(xintercept=mean(D_686172464, na.rm=T)), colour="#3C989E", linetype="solid")

```

# PPLHOUSE
```{r ppl, warning=FALSE, echo=FALSE, message=FALSE}

#Number of people in the house
hist_funct(D_641651634_D_173508724, "Number of People in Household", "People", "Frequency")
cat("Don't know number of people in household:", sum(table(merged$D_641651634_D_641651634_D_746038746==1)))

```


# QXAUTHOR1
```{r author, warning=FALSE, echo=FALSE, message=FALSE}

#merged survey 
##dict <- c(dict, "275706407"="Completed by someone else on behalf of the participant", "589702540"="Completed by Participant")
simple_funct1(D_431721131, "QXAUTHOR1: Who Completed this Survey")



```



















```{r M1merge_shrunk, include=FALSE, warning=FALSE}



## Update Module 1 pull with only the Module 1 variables that merge into Module 2 for the Module 2 section of the report
m1_complete_nodup_condensed <- m1_complete_nodup %>%  select (Connect_ID, D_407056417, D_750420077_D_846483618, D_750420077_D_505282171, D_750420077_D_578416151, D_750420077_D_434651539, D_750420077_D_108025529, D_289664241_D_289664241, D_613744428, D_784967158, D_750420077_D_582784267, D_750420077_D_751402477, D_750420077_D_700100953)

parts2 <- parts_data %>%  filter(d_536735468=='231311385')

merged= left_join(parts2, m1_complete_nodup_condensed, by="Connect_ID")
dim(merged)



data_tib_base <- as_tibble(merged)
#dim(base_vars)

knitr::opts_chunk$set(comment = NA)

```


```{r merge2, include=FALSE}

recr_m2 <- bq_project_query(project, query="SELECT token,Connect_ID, d_821247024, d_914594314,  d_827220437,d_512820379, 
                            d_536735468 , d_517311251  FROM  `nih-nci-dceg-connect-prod-6d04.FlatConnect.participants_JP` WHERE  d_821247024='197316935'")
recr_m2 <- bq_table_download(recr_m2,bigint = "integer64",n_max = Inf, page_size = 10000)
cnames <- names(recr_m2)
# Check that it doesn't match any non-number
numbers_only <- function(x) !grepl("\\D", x)
# to check variables in recr_noinact_wl1
for (i in 1: length(cnames)){
  varname <- cnames[i]
  var<-pull(recr_m2,varname)
  recr_m2[,cnames[i]] <- ifelse(numbers_only(var), as.numeric(as.character(var)), var)
}



### Deal with Mod2 duplicates (took both version 1 and vesion 2, and only select version 2 data)
sql_M2_1 <- bq_project_query(project, query = "SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module2_v1_JP` WHERE Connect_ID IS NOT NULL")
sql_M2_2 <- bq_project_query(project, query = "SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module2_v2_JP` WHERE Connect_ID IS NOT NULL")

M2_V1 <- bq_table_download(sql_M2_1, bigint = "integer64")
M2_V2 <- bq_table_download(sql_M2_2, bigint = "integer64")

# Select matching column names
M2_V1_vars <- colnames(M2_V1)
M2_V2_vars <- colnames(M2_V2)
common_vars <- intersect(M2_V1_vars, M2_V2_vars)

# Subset to common columns
M2_V1_common <- M2_V1[, common_vars]
M2_V2_common <- M2_V2[, common_vars]

# Add version indicator
M2_V1_common$version <- 1
M2_V2_common$version <- 2

# Identify columns with mismatched types
mismatched_cols <- names(M2_V1_common)[sapply(names(M2_V1_common), function(col) {
  class(M2_V1_common[[col]]) != class(M2_V2_common[[col]])
})]

# Convert mismatched columns to character for consistency
M2_V1_common <- M2_V1_common %>%
  mutate(across(all_of(mismatched_cols), as.character))
M2_V2_common <- M2_V2_common %>%
  mutate(across(all_of(mismatched_cols), as.character))

# Combine both versions for participants who completed both
M2_common <- bind_rows(M2_V1_common, M2_V2_common) %>%
  arrange(Connect_ID, desc(version))

# For columns unique to each version
V1_only_vars <- setdiff(M2_V1_vars, common_vars)
V2_only_vars <- setdiff(M2_V2_vars, common_vars)

# Subset each version for unique columns and add version indicator
m2_v1_only <- M2_V1[, c("Connect_ID", V1_only_vars)] %>%
  mutate(version = 1)
m2_v2_only <- M2_V2[, c("Connect_ID", V2_only_vars)] %>%
  mutate(version = 2)

# Combine the unique and common data
M2_common_v1 <- left_join(M2_common, m2_v1_only, by = c("Connect_ID", "version"))
M2_combined_v1v2 <- left_join(M2_common_v1, m2_v2_only, by = c("Connect_ID", "version"))

# Filter for complete cases where specific completion criteria are met
M2_complete <- M2_combined_v1v2 %>%
  filter(Connect_ID %in% recr_m2$Connect_ID[recr_m2$d_536735468 == 231311385]) %>%
  arrange(desc(version))

# Remove duplicates, keeping only the most recent version for each Connect_ID
M2_complete_nodup <- M2_complete[!duplicated(M2_complete$Connect_ID),]
table(M2_complete_nodup$version)


M2_complete_nodup$Connect_ID <- as.numeric(M2_complete_nodup$Connect_ID)

M2_complete_nodup$Connect_ID <- as.numeric(M2_complete_nodup$Connect_ID)


merge_m2= left_join(merged, M2_complete_nodup, by="Connect_ID")


data_tib_all2 <- as_tibble(merge_m2)

```


```{r functions 2, warning=FALSE, echo=FALSE,  message=FALSE, include=FALSE}

hist_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  merge_m2 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>% 
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + ylab(Ylab) + geom_histogram()+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) + 
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="#3C989E", linetype="solid")
  
}



#Histogram for female at birth only questions
hist_funct_F <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  merge_m2 %>% mutate(!!CID_SYM:=as.numeric(as.character(!!CID_SYM))) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + ylab(Ylab) + geom_histogram()+   ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="#3C989E", linetype="solid")
  
}

hist_funct_D <- function(CID,Title, Xlab, Ylab) {
  #CID_SYM <- rlang::ensym(CID)
  merge_m2 %>% ggplot(aes(x=CID))+ #, fill=as.factor(D_407056417)
    xlab(Xlab) + ylab(Ylab) + geom_histogram(binwidth = 0.5)+  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    #scale_fill_discrete(name = "Sex", labels=c("Female", "Male"))+
    geom_vline(aes(xintercept=mean(CID, na.rm=T)), colour="#3C989E", linetype="solid")
  
}



dict <- list("353358909"="Yes", "104430631"="No",  "178420302"="Do not Know", "536341288"="Female", "654207589"="Male","555374628"="Full Sibling", 
             "871673221"="Half Sibling, Same Mother",  "198654048"="Half Sibling, Same Father", "807835037"="Other", 
             "274062548"="More than 3 months ago", "958538953"="In the past 3 months",  "317567178"="In the past month", "484055234"="In the past year", 
             "802197176"="More than 1 year ago", "[]"="Answered with number", "[178420302]"="Answered Don't Know", "274062548"="More than 3 months ago",
             "958538953"="In the past 3 months", "490796638"="Not Flexible","719954633"="Extremely Flexible","929148006"="A Little Flexible","988873962"="Somewhat Flexible",
             "764708931"="Very flexible", "211590917"="Often", "132099255"="Sometimes", "746038746"="Declined", "239152340"="Once a month or Less", "582006876"="2-3 days/month",
             "645894551"= "1-2 days/week","647504893"="Every day", "671267928"="5-6 days/week","996315715"= "3-4 days/week", "206020811"="31-44 min.", "248303092"="16-30 min.",
             "264163865"= "45-59 min.","428999623"= "0-15 min.","628177728"="2 hrs", "638092100"="1 hr","805918496"= "3+ hrs", "223216393"="Single Live Infant", "628445697"="Multiple Live Infants",
             "419220239"="Still birth","306890578"="Live Birth and Still Birth","858244199"="Miscariage","434041171"="Termination", "550615107"="Ectopic or tubal pregnancy", "201002865"="9+ hours",
             "258023209"="45 min.","464753847"="0-29 min.","503218834"="None","729681071"= "30 min.","755558825"= "5-6 hrs","919739344"= "3-4 hrs","949555271"= "7-8 hrs", "349122068"="1 Day per Week",
             "156095877"="2 Days per Week", "162668459"="3 Days per Week", "278139969"="4 Days per Week", "676824724"="5 Days per Week", "512144428"="6 Days per Week", "125674414"="7 Days per Week",
             "270994579"="Yes, 5 or more times per week", "284343405"="Yes, 3 or 4 times per week","525779785"= "Yes, less than once per week","565036180"= "Yes, 1 or 2 times per week", "514068832"="No Chance","747099514"="Moderate chance",
             "774439579"= "Slight Chance","977681388"= "High Chance", "303095574"="Sound and Restful", "462478011"="Very Sound and Restful", "522143286"= "Restless","621370621"= "Very Restless",
             "838403733"= "Average Quality", "137254299"="As Loud as Talking","178420302"="Unknown","624808470"="Slightly Louder than Breathing","954318357"="Louder than Talking",
             "198347104"="1-2 times per week","471294296"="3-4 times per week","520089841"="0-1 times per month","632512449"="1-2 times per month","648960871"="Never","718687985"="Almost Every Day",
             "200323667"="In the past yes","249673703"="Currently yes", "310201523"="100 Units per ml", "290716491"="500 unit per ml", 
             "582602017" = "Twins", "105727261" = "Triplets", "720288326" = "Four or More", "660308254" = "Cesarean", "936573532" = "Vaginal",
             "582425113"="Menopause", "330745988"="Female hormones", "909774794"="Hysterectomy or bilateral oophorectomy", "868504994"="Endometrial ablation", "655309065"="Using a hormonal medication or device", "757609794"="Pregnant or breastfeeding", "585076356"="Ratiation or chemotherapy","351584248"="Unknown", "647504893"="Everyday", "862918284"="0-9 per month", "275059825"="10-14 per month", "481217808"="15-19 per month","565450397"="20-25 per month")




#GT table for questions asked to all (no skip logic)
simple_funct2 <- function(CID, Title){  
  CID_SYM <- rlang::ensym(CID)
  dt_select <- data_tib_all2 %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
 
  gt_yn %>%  gt::gt()  %>%  
    fmt_number(columns = "percentage", decimals = 2) %>% 
    tab_header(title = md(Title)) %>% 
    cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%  
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
    tab_options(
      stub.font.weight = "bold"
    ) %>%
    tab_style(
      style = list(
        cell_text(weight = "bold")
      ),
      locations = cells_body(
        columns = answer,
      )
    ) #
}


#Error in `dplyr::mutate()`:
# ! Problem while computing `answer = recode(...)`.
# Caused by error in `FUN()`:
# ! 'recode': all recodings should be formula but: "(Whatever is the first entry into the dict)"
# Run `rlang::last_error()` to see where the error occurred.




#GT table with one filter/skip logic
one_logic_funct2 <- function(CID, CID_prev, Prev_Answer, Title){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_all2 %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  

  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}



#GT table with two filter/skip logics
two_skip_funct2 <- function(CID, Title, CID_prev, Prev_Answer1, Prev_Answer2){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_all2 %>%  filter(!!CID_SYM_P == Prev_Answer1 | !!CID_SYM_P == Prev_Answer2) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}


#GT table with two filter/skip logics
three_skip_funct2 <- function(CID, Title, CID_prev, Prev_Answer1, Prev_Answer2, Prev_Answer3){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_all2 %>%  filter(!!CID_SYM_P == Prev_Answer1 | !!CID_SYM_P == Prev_Answer2| !!CID_SYM_P == Prev_Answer3) %>%  
    select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}




#GT table with four filter/skip logics
four_skip_funct2 <- function(CID, Title, CID_prev, Prev_Answer1, Prev_Answer2, Prev_Answer3, Prev_Answer4){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_tib_all2 %>%  filter(!!CID_SYM_P == Prev_Answer1 | !!CID_SYM_P == Prev_Answer2| 
                                           !!CID_SYM_P == Prev_Answer3 | !!CID_SYM_P == Prev_Answer4) %>%  
    select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)
  
  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>% 
  # summary_rows( groups=F,
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}



# Pregnancy questions
preg_funct <- function(CID, Preg_Num, Title){
  CID_SYM <- rlang::ensym(CID)
  data_tib_all2$D_405571048 <- as.numeric(data_tib_all2$D_405571048)
  dt_select <- data_tib_all2 %>%  filter(D_405571048 >= Preg_Num) %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% dplyr::group_by(!!CID_SYM) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.)) %>% dplyr::ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% replace_na(list(answer="Skipped this Question")) %>%  dplyr::select(answer, n, percentage)

  gt_yn %>%  gt::gt()  %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md(Title)) %>%
  cols_label(n= md("**N**"),  answer = md("**Answer**"), percentage = md("**%**")) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  )
}



#Bar-- attemting to replace failing histograms
bar_rplc_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  merge_m2 %>% filter(!is.na(!!CID_SYM)) %>% mutate(as.numeric(as.character(!!CID_SYM))) %>%
    ggplot(aes(x=!!CID_SYM))+ ylab(Ylab) + xlab(Xlab) +
    geom_bar()+  ggtitle(Title)
}


bar_rplc_funct_F <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  merge_m2 %>% filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+ ylab(Ylab) + xlab(Xlab) +
    geom_bar()+  ggtitle(Title)
}


#Boxplot for female at birth only questions
boxp_funct_F <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  merge_m2 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title)+
    scale_y_continuous(labels = scales::number_format(accuracy = 0.01))
}

``` 


\newpage
# PAINREL1
```{r painrel, include=FALSE}

mds= data_tib_all2 %>%  mutate(medications= case_when( D_399982309_D_469512398==1 ~ "Baby Aspirin",
                                                          D_399982309_D_194424439==1 ~ "Regular Aspirin",
                                                          D_399982309_D_422188606==1 ~ "Ibuprofen",
                                                          D_399982309_D_555555502==1 ~ "Acetaminophen",
                                                          D_399982309_D_800410166==1 ~ "Naproxen",
                                                          D_399982309_D_221645137==1 ~ "Celebrex",
                                                          D_399982309_D_974248369==1 ~ "Prescription pain relievers",
                                                          D_399982309_D_535003378==1 ~ "None",
                                                          TRUE  ~ "Skipped this Question"))


pain_medications_summary <- mds %>% group_by(medications) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(medications, n, percentage)



 
painmeds<- data_tib_all2[, grepl("399982309", colnames(data_tib_all2))]
painmds <- painmeds[, c(4, 1, 3, 6, 7, 2, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Baby Aspirin","Regular Aspirin","Ibuprofen","Acetaminophen", "Naproxen", "Celebrex","Prescription pain relievers","None")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
mgr1 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(mds$medications=="Skipped this Question")[2])
mgr1[as.numeric(dim(mgr1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(data_tib_all2)[[1]])*100,2))


dt_mgr1 <- mgr1 %>%  gt::gt() %>%  
  tab_header(title = md("PAINREL1: Pain Relievers Used 4x a Month for 6+ Months")) %>% 
  cols_label(Frequency= md("**N**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_mgr1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```




# PAINREL2-7
## Baby Aspirin
```{r painrel1, warning=FALSE, echo=FALSE, message=FALSE}

#How often
#hist_funct(D_861838892_D_765748316, "PAINREL2: Days per Week Baby aspirin Taken", "Days", "Frequency") 
bar_rplc_funct(D_861838892_D_765748316, "PAINREL2_1: Days per Week Baby aspirin Taken", "Days", "Frequency")

hist_funct(D_861838892_D_785412329, "PAINREL2_1: Days per Month Baby aspirin Taken", "Days", "Frequency")


#Pills per day baby aspirin
hist_funct(D_596961796_D_101310722, "PAINREL3_1: Pills per Day of Baby aspirin", "Pills", "Frequency")
  #later to be filtered by age range as well 

  #Pills per day: Don't know
#one_logic_funct2(D_596961796_D_596961796, D_399982309_D_469512398, 1, "PAINREL3_1: Baby Aspirin Pills Per Day")




#Yrs taken regular aspirin
hist_funct(D_113681507, "PAINREL4_1: Years of taking Regular aspirin", "Years", "Frequency")


#Last time taken baby aspirin
data_tib_all2$D_177526169 <- factor(data_tib_all2$D_177526169, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_177526169, D_399982309_D_469512398, 1, "PAINREL5_1: Last time baby aspirin was taken")




#Yrs ago last taken   
hist_funct(D_564374538, "PAINREL6_1: Years Ago Baby aspirin Last Taken", "Years", "Frequency")
```


```{r  painrel1reason, include=FALSE}


dt_reasons_P1= data_tib_all2  %>%   filter(D_399982309_D_469512398==1) %>%  
                          mutate(reasons= case_when(D_643807999_D_323106499==1 ~ "Arthritis",
                                             D_643807999_D_769901710==1 ~ "Back Pain",
                                             D_643807999_D_727773491==1 ~ "Menstrual Pain",
                                             D_643807999_D_283652434==1 ~ "Disease Prevention",
                                             D_643807999_D_243596698==1 ~ "Headaches",
                                             D_643807999_D_191656389==1 ~ "Illness or Fever",
                                             D_643807999_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_643807999_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this Question"))


 
painmeds<- dt_reasons_P1[, grepl("643807999", colnames(dt_reasons_P1))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r Painrel1Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_1 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_reasons_P1$reasons=="Skipped this Question")[2])
pain7_1[as.numeric(dim(pain7_1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P1)[[1]])*100,2))


dt_pain7_1 <- pain7_1 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_1: Reasons for taking baby aspirin regularly")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  dt_pain7_1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```




## Regular aspirin 
```{r painrel2, warning=FALSE, echo=FALSE, message=FALSE}
#How often taken
bar_rplc_funct(D_837412550_D_765748316, "PAINREL2_2: Days per Week of Regular aspirin", "Days", "Frequency") 

hist_funct(D_837412550_D_785412329, "PAINREL2_2: Days per Month of Regular aspirin", "Days", "Frequency")

#Pills per day regular aspirin
hist_funct(D_825189914_D_101310722, "PAINREL3_2: Pills per Day of Regular Aspirin", "Pills", "Frequency")

  #Pills per day: Don't know 
#one_logic_funct2(D_825189914_D_825189914, D_399982309_D_194424439, 1, "PAINREL3_2: Regular Aspirin Pills Per Day")


#Yrs taken regular aspirin
hist_funct(D_615979584, "PAINREL4_2: Years of taking Regular aspirin", "Years", "Frequency")


#Last time taken regular aspirin
data_tib_all2$D_814141708 <- factor(data_tib_all2$D_814141708, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_814141708, D_399982309_D_194424439, 1, "PAINREL5_2: Last Time Regular aspirin Taken")


#Yrs ago last taken
hist_funct(D_265428345, "PAINREL6_2: Years Ago Regular aspirin Last Taken", "Years", "Frequency")


```

```{r painrel2reason, include=FALSE}

#Reasons taken
dt_reasons_P2= data_tib_all2 %>%  filter(D_399982309_D_194424439==1)  %>%  filter(D_399982309_D_194424439==1) %>%  
                  mutate(reasons= case_when(D_275143071_D_323106499==1 ~ "Arthritis",
                                             D_275143071_D_769901710==1 ~ "Back Pain",
                                             D_275143071_D_727773491==1 ~ "Menstrual Pain",
                                             D_275143071_D_283652434==1 ~ "Disease Prevention",
                                             D_275143071_D_243596698==1 ~ "Headaches",
                                             D_275143071_D_191656389==1 ~ "Illness or Fever",
                                             D_275143071_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_275143071_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this Question"))


 
painmeds<- dt_reasons_P2[, grepl("275143071", colnames(dt_reasons_P2))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_2 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_reasons_P2$reasons=="Skipped this Question")[2])
pain7_2[as.numeric(dim(pain7_2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P2)[[1]])*100,2))


dt_pain7_2 <- pain7_2 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_2: Reasons for taking regular aspirin regularly")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  dt_pain7_2,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```



## Ibuprofen
```{r painrel3, warning=FALSE, echo=FALSE, message=FALSE}

#How often taken
bar_rplc_funct(D_388804810_D_765748316, "PAINREL2_3: Days per Week Ibuprofen Taken", "Days", "Frequency")

hist_funct(D_388804810_D_785412329, "PAINREL2_3: Days per Month Ibuprofen Taken", "Days", "Frequency")


#Pills per day ibuprofen 
merge_m2$D_753416375_D_101310722 <- round(as.numeric(merge_m2$D_753416375_D_101310722), digits=0)
hist_funct(D_753416375_D_101310722, "PAINREL3_3: Pills per Day of Ibuprofen", "Pills", "Frequency")

  #Pills per day: Don't know
#one_logic_funct2(D_753416375_D_753416375, D_399982309_D_422188606, 1, "PAINREL3_3: Ibuprofen Pills Per Day")


#Yrs taken ibuprofen 
hist_funct(D_771526486 , "PAINREL4_3: Years of taking Ibuprofen", "Years", "Frequency")

#Last time taken ibuprofen
data_tib_all2$D_292658699 <- factor(data_tib_all2$D_292658699, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_292658699, D_399982309_D_422188606, 1, "PAINREL5_3: Last Time Ibuprofen Taken")


#Yrs ago last taken
hist_funct(D_491549803 , "PAINREL6_3: Years Ago Ibuprofen Last Taken", "Years", "Frequency")




```
```{r painrel3reason, include=FALSE}

#Reasons taken
dt_reasons_P3= data_tib_all2  %>%  filter(D_399982309_D_422188606==1)  %>%  
                    mutate(reasons= case_when(D_152138929_D_323106499==1 ~ "Arthritis",
                                             D_152138929_D_769901710==1 ~ "Back Pain",
                                             D_152138929_D_727773491==1 ~ "Menstrual Pain",
                                             D_152138929_D_283652434==1 ~ "Disease Prevention",
                                             D_152138929_D_243596698==1 ~ "Headaches",
                                             D_152138929_D_191656389==1 ~ "Illness or Fever",
                                             D_152138929_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_152138929_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this Question"))


 
painmeds<- dt_reasons_P3[, grepl("152138929", colnames(dt_reasons_P3))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r PainRel3Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_3 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_reasons_P3$reasons=="Skipped this Question")[2])
pain7_3[as.numeric(dim(pain7_3)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P3)[[1]])*100,2))


dt_pain7_3 <- pain7_3 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_3: Reasons for taking ibuprofen regularly")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  dt_pain7_3,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```



## Acetaminophen 
```{r painrel4, warning=FALSE, echo=FALSE, message=FALSE}



#How often taken
bar_rplc_funct(D_614446276_D_765748316 , "PAINREL2_4: Days per Week Tylenol Taken", "Days", "Frequency")

hist_funct(D_614446276_D_785412329 , "PAINREL2_4: Days per Month Tylenol Taken", "Days", "Frequency")

#Pills per day Tylenol
hist_funct(D_646042915_D_101310722, "PAINREL3_4: Pills per Day of Tylenol", "Pills", "Frequency")
  
  #Pills per day: Don't know
#one_logic_funct2(D_646042915_D_646042915, D_399982309_D_555555502, 1, "PAINREL3_4: Acetaminophen Pills Per Day")

#Yrs taken Tylenol 
merge_m2$D_270254670 <- round(as.numeric(merge_m2$D_270254670), digits=0)
hist_funct(D_270254670, "PAINREL4_4: Years of taking Tylenol", "Years", "Frequency")

#Last time taken Tylenol 
data_tib_all2$D_861824298 <- factor(data_tib_all2$D_861824298, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_861824298, D_399982309_D_555555502, 1, "PAINREL5_4: Last Time Tylenol Taken")


#Yrs ago last taken
hist_funct(D_846227588, "PAINREL6_4: Years Ago Tylenol Taken", "Years", "Frequency")




```
```{r Painrel4Reason, include=FALSE}

#Reasons taken
dt_reasons_P4= data_tib_all2 %>%   filter(D_399982309_D_555555502==1) %>%  
                    mutate(reasons= case_when(D_630231395_D_323106499==1 ~ "Arthritis",
                                             D_630231395_D_769901710==1 ~ "Back Pain",
                                             D_630231395_D_727773491==1 ~ "Menstrual Pain",
                                             D_630231395_D_283652434==1 ~ "Disease Prevention",
                                             D_630231395_D_243596698==1 ~ "Headaches",
                                             D_630231395_D_191656389==1 ~ "Illness or Fever",
                                             D_630231395_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_630231395_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this Question"))


 
painmeds<- dt_reasons_P4[, grepl("630231395", colnames(dt_reasons_P4))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r Painrel4Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_4 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_reasons_P4$reasons=="Skipped this Question")[2])
pain7_4[as.numeric(dim(pain7_4)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P4)[[1]])*100,2))


dt_pain7_4 <- pain7_4 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_4: Reasons for taking Acetaminophen regularly")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  dt_pain7_4,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```

## Naproxen 
```{r painrel5, warning=FALSE, echo=FALSE, message=FALSE}



#How often taken
bar_rplc_funct(D_234177873_D_765748316, "PAINREL2_5: Days per Week Aleve Taken", "Days", "Frequency")
     
hist_funct(D_234177873_D_785412329, "PAINREL2_5: Days per Month Aleve Taken", "Days", "Frequency")

#Pills per day Aleve 
hist_funct(D_799338907_D_101310722, "PAINREL3_5: Pills per Day of Aleve", "Pills", "Frequency")

  #Pills per day: Don't know
#one_logic_funct2(D_799338907_D_799338907, D_399982309_D_800410166, 1, "PAINREL3_5: Naproxen Pills Per Day")


#Yrs taken Aleve
hist_funct(D_376720409, "PAINREL4_5: Years of taking Aleve", "Years", "Frequency")

#Last time taken Aleve
data_tib_all2$D_575646308 <- factor(data_tib_all2$D_575646308, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_575646308, D_399982309_D_800410166, 1, "PAINREL5_5: Last Time Aleve Taken")




#Yrs ago last taken 
merge_m2$D_798182168 <- round(as.numeric(merge_m2$D_798182168), digits=0)
hist_funct(D_798182168, "PAINREL6_5: Years Ago Aleve Last Taken", "Years", "Frequency")





```
```{r Painrel5Reason, include=FALSE}

#Reasons taken
dt_reasons_P5= data_tib_all2 %>%   filter(D_399982309_D_800410166==1) %>%  
                  mutate(reasons= case_when(D_655266993_D_323106499==1 ~ "Arthritis",
                                             D_655266993_D_769901710==1 ~ "Back Pain",
                                             D_655266993_D_727773491==1 ~ "Menstrual Pain",
                                             D_655266993_D_283652434==1 ~ "Disease Prevention",
                                             D_655266993_D_243596698==1 ~ "Headaches",
                                             D_655266993_D_191656389==1 ~ "Illness or Fever",
                                             D_655266993_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_655266993_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this Question"))


 
painmeds<- dt_reasons_P5[, grepl("655266993", colnames(dt_reasons_P5))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r Painrel5Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_5 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_reasons_P5$reasons=="Skipped this Question")[2])
pain7_5[as.numeric(dim(pain7_5)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P5)[[1]])*100,2))


dt_pain7_5 <- pain7_5 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_5: Reasons for taking Naproxen regularly")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  dt_pain7_5,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```

## Celebrex 
```{r painrel6, warning=FALSE, echo=FALSE, message=FALSE}



#How often taken 
bar_rplc_funct(D_248599913_D_765748316, "PAINREL2_6: Days per Week Celebrex Taken", "Days", "Frequency")

hist_funct(D_248599913_D_785412329, "PAINREL2_6: Days per Month Celebrex Taken", "Days", "Frequency") 


#Pills per day celebrex 
hist_funct(D_893965588_D_101310722, "PAINREL3_6: Pills per Day of Aleve", "Pills", "Frequency")

 #Pills per day: don't know 
#one_logic_funct2(D_893965588_D_893965588, D_399982309_D_221645137, 1, "PAINREL3_6: Celebrex Pills Per Day")


#Yrs taken celebrex
hist_funct(D_439072744, "PAINREL4_6: Years Celebrex Taken", "Years", "Frequency")

#Last time taken celebrex
data_tib_all2$D_733861762 <- factor(data_tib_all2$D_733861762, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_733861762, D_399982309_D_221645137, 1, "PAINREL5_6: Last Time Celebrex Taken")



#Yrs ago last taken
hist_funct(D_322479862, "PAINREL6_6: Years Ago Celebrex Last Taken", "Years", "Frequency")



```
```{r Painrel6Reason, include=FALSE}

#Reasons taken
dt_reasons_P6= data_tib_all2 %>%   filter(D_399982309_D_221645137==1) %>%  
                  mutate(reasons= case_when(D_509383583_D_323106499==1 ~ "Arthritis",
                                             D_509383583_D_769901710==1 ~ "Back Pain",
                                             D_509383583_D_727773491==1 ~ "Menstrual Pain",
                                             D_509383583_D_283652434==1 ~ "Disease Prevention",
                                             D_509383583_D_243596698==1 ~ "Headaches",
                                             D_509383583_D_191656389==1 ~ "Illness or Fever",
                                             D_509383583_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_509383583_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this Question"))


 
painmeds<- dt_reasons_P6[, grepl("509383583", colnames(dt_reasons_P6))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r Painrel6Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_6 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_reasons_P6$reasons=="Skipped this Question")[2])
pain7_6[as.numeric(dim(pain7_6)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P6)[[1]])*100,2))


dt_pain7_6 <- pain7_6 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_6: Reasons for taking Celebrex regularly")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  dt_pain7_6,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


# PAINREL7 
```{r painrel7, warning=FALSE, echo=FALSE, message=FALSE}


#How often taken 
#hist_funct(D_697661603_D_765748316, "PAINREL2_7: How often Presc. Opiods Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_697661603_D_765748316, "PAINREL2_7: How often Presc. Opiods Taken (per week)", "Days", "Frequency")

hist_funct(D_697661603_D_785412329, "PAINREL2_7: How often Presc. Opiods Taken (per month)", "Days", "Frequency")

#Pills per day prescription opiods
hist_funct(D_438682764_D_101310722, "PAINREL3_7: Pills per Day of Presc. Opiods", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct2(D_438682764_D_438682764, D_399982309_D_974248369, 1, "PAINREL3_7: Prescription Opiod Pills Per Day")


#Yrs taken prescription opiods 
hist_funct(D_445571225, "PAINREL4_7: Years Taking Prescription Opiods", "Years", "Frequency")


#Last time taken prescription opiods
data_tib_all2$D_733861762 <- factor(data_tib_all2$D_733861762, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_733861762, D_399982309_D_974248369, 1, "PAINREL5_7: Last Time Prescription Opiods Taken")



#Yrs ago last taken
data_tib_all2$D_737490587 <- round(as.numeric(data_tib_all2$D_737490587), digits=0)
hist_funct(D_737490587, "PAINREL6_7: Years Ago Prescription Opiods Last Taken", "Years", "Frequency")




```
```{r painrel7reason, include=FALSE}

#Reasons taken


dt_reasons_P7= data_tib_all2 %>%  filter(D_399982309_D_974248369==1) %>%  
                  mutate(reasons= case_when(D_887435355_D_323106499==1 ~ "Arthritis",
                                             D_887435355_D_769901710==1 ~ "Back Pain",
                                             D_887435355_D_727773491==1 ~ "Menstrual Pain",
                                             D_887435355_D_283652434==1 ~ "Disease Prevention",
                                             D_887435355_D_243596698==1 ~ "Headaches",
                                             D_887435355_D_191656389==1 ~ "Illness or Fever",
                                             D_887435355_D_853261835==1 ~ "Muscle Joint Pain",
                                             D_887435355_D_558504672==1 ~ "Toothache",
                                             TRUE~ "Skipped this Question"))

 
painmeds<- dt_reasons_P7[, grepl("887435355", colnames(dt_reasons_P7))]
painmds <- painmeds[, c(4, 7, 6, 3, 2, 1, 8, 5)]

medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Arthritis","Back Pain","Menstrual Pain","Disease Prevention","Headaches","Illness or Fever","Muscle Joint Pain","Toothache")
```
```{r painrel7table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
pain7_7 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dt_reasons_P7$reasons=="Skipped this Question")[2])
pain7_7[as.numeric(dim(pain7_7)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dt_reasons_P7)[[1]])*100,2))


pain7_7 <- pain7_7 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("PAINREL7_7: Reasons for taking Opiods regularly")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  pain7_7,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```


# PAINREL8
```{r painrel8, warning=FALSE, echo=FALSE, message=FALSE}
#Ever taken not prescr.  

simple_funct2(D_414005872, "PAINREL8: Taken Opioids Not Prescribed")


```


# CHOLHTN1-6
```{r CHOLHTN, warning=FALSE, echo=FALSE, message=FALSE}
chlot= data_tib_all2 %>%  mutate(answer= case_when(D_614123836_D_480724806==1 & D_614123836_D_819373917==1~ "Both",
                                                     D_614123836_D_480724806==1 ~ "Statins",
                                                     D_614123836_D_819373917==1 ~ "Anti-hypertensive medication",
                                                     D_614123836_D_535003378==1 ~ "None",
                                                   TRUE ~ "Skipped this Question"))
chlot$answer <- factor(chlot$answer,levels=c("Statins", "Anti-hypertensive medication", "Both","None", "Skipped this Question"))

chlot_summary <- chlot %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage)

chlot_summary %>%  gt::gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("CHOLHTN: Ever Used Any Cholesterol or Blood Pressure (Hypertension) \n Medications 4x/month for 6+ Months")) %>% 
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
```
## Statins
```{r Statins, warning=FALSE, echo=FALSE, message=FALSE}



#How Often
  #sum(table(merge_m2$D_731790154_D_765748316)) #most answered
#hist_funct(D_731790154_D_765748316, "CHOLHTN2_1: How often Statins Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_731790154_D_765748316, "CHOLHTN2_1: How often Statins Taken (per week)", "Days", "Frequency")


hist_funct(D_731790154_D_785412329, "CHOLHTN2_1: How often Statins Taken (per month)", "Days", "Frequency")

#Pills per day
hist_funct(D_550092533_D_101310722, "CHOLHTN3_1: Pills per Day of Statins", "Pills", "Frequency")

  #Pills per day: don't know
one_logic_funct2(D_550092533_D_550092533, D_614123836_D_480724806, 1, "CHOLHTN3_1: Statin Pills Per Day")


#Yrs taken
merge_m2$D_163057677 <- round(as.numeric(merge_m2$D_163057677), digits=0)
hist_funct(D_163057677, "CHOLHTN4_1: Years Taking Statins", "Years", "Frequency")

#Last time taken
data_tib_all2$D_225047594 <- factor(data_tib_all2$D_225047594, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_225047594, D_614123836_D_480724806, 1, "CHOLHTN5_1: Last Time Taking Statins")



#Yrs ago last taken
hist_funct(D_297084062, "CHOLHTN6_1: Years Ago Statins Last Taken", "Years", "Frequency")

```




## Anti-Hyertension 
```{r AntiHyertension, warning=FALSE, echo=FALSE, message=FALSE}
#How often
#hist_funct(D_305292465_D_765748316, "CHOLHTN2_2: How often Anti-Hypertensive Meds Taken (per week)", "Years", "Frequency")
bar_rplc_funct(D_305292465_D_765748316, "CHOLHTN2_2: How often Anti-Hypertensive Meds Taken (per week)", "Days", "Frequency")


hist_funct(D_305292465_D_785412329, "CHOLHTN2_2: How often Anti-Hypertensive Meds Taken (per month)", "Years", "Frequency")

#Pills per day
merge_m2$D_901498441_D_101310722 <- round(as.numeric(merge_m2$D_901498441_D_101310722), digits=0)
hist_funct(D_901498441_D_101310722, "CHOLHTN3_2: Pills per Day of Anti-Hypertensive Meds", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct2(D_901498441_D_901498441, D_614123836_D_819373917, 1, "CHOLHTN3_2: Anti-Hyertension Pills Per Day")


#Yrs taken
merge_m2$D_147792229 <- round(as.numeric(merge_m2$D_147792229), digits=0)
hist_funct(D_147792229, "CHOLHTN4_2: Years Anti-Hypertensive Meds Taken", "Years", "Frequency")

#Last time taken
data_tib_all2$D_976052812 <- factor(data_tib_all2$D_976052812, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_976052812, D_614123836_D_819373917, 1, "CHOLHTN5_2: Last Time Anti-Hypertensive Meds Taken")




#Yrs ago last taken
hist_funct(D_991427384, "CHOLHTN6_2: Years Ago Anti-Hypertensive Meds Last Taken", "Years", "Frequency")

```





# METFOR1-6
```{r METFOR, warning=FALSE, echo=FALSE, message=FALSE}

##Metformin
simple_funct2(D_112024853, "METFOR: Ever Used Anti-Hypertensive Meds 4x/month for 6+ Months")


#Days per day/week/month
#hist_funct(D_694817520_D_765748316, "METFOR2: How often Metformin Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_694817520_D_765748316, "METFOR2: How often Metformin Taken (per week)", "Days", "Frequency")

hist_funct(D_694817520_D_785412329, "METFOR2: How often Metformin Taken (per week)", "Days", "Frequency")

#Milligrams per day
hist_funct(D_991622246_D_101310722, "METFOR3: Milligrams per Day", "Pills", "Frequency")

  #Pills per day: don't know
one_logic_funct2(D_991622246_D_991622246, D_112024853, 353358909, "METFOR3: Metformin Pills Per Day")


#Yrs taken Metformin
merge_m2$D_450131058 <- round(as.numeric(merge_m2$D_450131058), digits=0)
hist_funct(D_450131058, "METFOR4: Years Metformin Taken", "Years", "Frequency")


  #Last time Metformin taken
one_logic_funct2(D_991873978, D_112024853, 353358909, "METFOR5: Last Time Metformin Taken")



  #Yrs ago last taken Metformin
hist_funct(D_371176229, "METFOR6: Years Ago Metformin Taken", "Years", "Frequency")



```

# INSULIN1-7
```{r INSULIN, warning=FALSE, echo=FALSE, message=FALSE}

##Insulin
simple_funct2(D_982448213, "INSULIN1: Ever Used Insulin 4x/month for 6+ Months")


#Days per day/week/month
#hist_funct(D_745223146_D_765748316,"INSULIN2A: How often Insulin Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_745223146_D_765748316, "INSULIN2A: How often Insulin Taken (per week)", "Days", "Frequency")

hist_funct(D_745223146_D_785412329,"INSULIN2B: How often Insulin Taken (per month)", "Days", "Frequency")


#Units per day
merge_m2$D_273218182_D_101310722 <- round(as.numeric(merge_m2$D_273218182_D_101310722), digits=0)
hist_funct(D_273218182_D_101310722,"INSULIN3: Units of Insulin per Day", "Units", "Frequency")

  #Units per day: don't remember
#one_logic_funct2(D_273218182_D_273218182, D_982448213, 353358909, "INSULIN3: Metformin Pills Per Day")


#Concentration
one_logic_funct2(D_850202336_D_850202336, D_982448213, 353358909, "INSULIN4: Concetration of Insulin")


# cat("Other Concentration of Insulin Not Listed")
# table(merge_m2$D_850202336_D_526448646) #other

#Yrs taken
merge_m2$D_799903478 <- round(as.numeric(merge_m2$D_799903478), digits=0)
hist_funct(D_799903478,"INSULIN5: Years Insulin Taken", "Years", "Frequency")


#Last time taken
data_tib_all2$D_465635548 <- factor(data_tib_all2$D_465635548, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_465635548, D_982448213, 353358909, "INSULIN6: Last Time Insulin Taken")



  #Yrs ago last taken 
hist_funct(D_556235252,"INSULIN7: Years Ago Insulin Last Taken", "Years", "Frequency")

```

# ACIDSUP1-6
## Prescription Proton Pump Inhibitors
```{r ACIDSUP, warning=FALSE, echo=FALSE, message=FALSE}

brand= data_tib_all2  %>%  mutate(med= case_when(D_643361372_D_933374659==1 ~ "Prescription Proton Pump Inhibitors",
                                            D_643361372_D_920460744==1 ~ "Over the Counter Proton Pump Inhibitors",
                                            D_643361372_D_449861632==1 ~ "Over the Counter H2 reception Blockers",
                                            D_643361372_D_535003378==1 ~ "None of the Above",
                                             TRUE ~ "Skipped this Question"))

acid_sup_summary <- brand %>% group_by(med) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(med, n, percentage)

acid_sup_summary %>%  gt::gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("ACIDSUP: Used Acid Suppressive Drugs 4x/month for 6+ Months")) %>% 
  cols_label(n= md("**N**"), med = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = med,
    )
  ) 

#How Often
#hist_funct(D_172234651_D_765748316,"ACIDSUP2_1: How often Prescription Proton Pump Inhibitors Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_172234651_D_765748316, "ACIDSUP2_1: How often Prescription Proton Pump Inhibitors Taken (per week)", "Days", "Frequency")

hist_funct(D_172234651_D_785412329,"ACIDSUP2_1: How often Prescription Proton Pump Inhibitors Taken (per month)", "Days", "Frequency")


#Pills per day
hist_funct(D_753610471_D_101310722,"ACIDSUP3_1: Pills of Prescription Proton Pump Inhibitors per Day", "Pills", "Frequency")

  #Pills per day: don't know
#one_logic_funct2(D_753610471_D_753610471, D_643361372_D_933374659, 1, "ACIDSUP3_1: Prescription Pump Proton Inhibitors Pills Per Day")


#Yrs taken
merge_m2$D_424183977 <- round(as.numeric(merge_m2$D_424183977), digits=0)
hist_funct(D_424183977,"ACIDSUP4_1: Years Prescription Proton Pump Inhibitors Taken", "Years", "Frequency")


#Last time taken
data_tib_all2$D_824287808 <- factor(data_tib_all2$D_824287808, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_824287808, D_643361372_D_933374659, 1, "ACIDSUP5_1: Last Time Prescription Pump Proton Inhibitors Taken")



#Yrs ago last taken
merge_m2$D_889053435 <- round(as.numeric(merge_m2$D_889053435), digits=0)
hist_funct(D_889053435, "ACIDSUP6_1: Years Ago Prescription Proton Pump Inhibitors Last Taken", "Years", "Frequency")

```




## Over the Counter Proton Pump Inhibitors
```{r OTCPump, warning=FALSE, echo=FALSE, message=FALSE}
#How Often
#hist_funct(D_416865817_D_765748316,"ACIDSUP2_2: How Often Over the Counter Proton Pump Inhibitors Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_416865817_D_765748316, "ACIDSUP2_2: How Often Over the Counter Proton Pump Inhibitors \n Taken (per week)", "Days", "Frequency")

hist_funct(D_416865817_D_785412329,"ACIDSUP2_2: How Often Over the Counter Proton Pump Inhibitors \n Taken (per month)", "Days", "Frequency")

#Pills per day
hist_funct(D_803968511_D_101310722, "ACIDSUP3_2: Pills of Over the Counter Proton Pump Inhibitors per Day", "Pills", "Frequency")
  
  #Pills per day: don't know
#one_logic_funct2(D_803968511_D_803968511, D_643361372_D_920460744, 1, "ACIDSUP3_2: Over the counter Proton Pump Inhibitors Pills Per Day")


#Yrs taken
merge_m2$D_378572291 <- round(as.numeric(merge_m2$D_378572291), digits=0)
hist_funct(D_378572291,"ACIDSUP4_2: Years Over-the-counter proton pump inhibitors Taken", "Years", "Frequency")


#Last time taken
data_tib_all2$D_846978339 <- factor(data_tib_all2$D_846978339, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_846978339, D_643361372_D_920460744, 1, "ACIDSUP5_2: Last Time Over-the-counter Proton Pump Inhibitors Taken")




#Yrs ago last taken
merge_m2$D_497904005 <- round(as.numeric(merge_m2$D_497904005), digits=0)
hist_funct(D_497904005,"ACIDSUP6_2: Years Ago over-the-counter proton pump inhibitors Last Taken", "Years", "Frequency")

```




## Over the Counter H2 Receptor Blockers
```{r RecpBlockers, warning=FALSE, echo=FALSE, message=FALSE}
#How often 
#hist_funct(D_266752903_D_765748316,"ACIDSUP2_3: How often over-the-counter H2 receptor blockers Taken (per week)", "Days", "Frequency")
bar_rplc_funct(D_266752903_D_765748316, "ACIDSUP2_3: How often over-the-counter H2 receptor blockers \n Taken (per week)", "Days", "Frequency")

hist_funct(D_266752903_D_785412329,"ACIDSUP2_3: How often over-the-counter H2 receptor blockers \n Taken (per month)", "Days", "Frequency")


#Pills per day
hist_funct(D_618427836_D_101310722,"ACIDSUP3_3: Number of over-the-counter H2 receptor blockers Pills per Day", "Pills", "Frequency")

  #Pills per day:don't know
#one_logic_funct2(D_618427836_D_618427836, D_643361372_D_449861632, 1, "ACIDSUP3_3: Over the counter H2 Receptor Blockers Pills Per Day")


#Yrs taken
hist_funct(D_774514900,"ACIDSUP4_3: Years over-the-counter H2 receptor blockers Taken", "Years", "Frequency")

#Last time taken
data_tib_all2$D_368595692 <- factor(data_tib_all2$D_368595692, levels=c(317567178, 484055234, 802197176, "Skipped this Question"))
one_logic_funct2(D_368595692, D_643361372_D_449861632, 1, "ACIDSUP5_3: Last Time Over the counter H2 Receptor Blockers Taken")


#Yrs ago last taken 
hist_funct(D_889053435,"ACIDSUP6_3: Years Ago over-the-counter H2 Receptor Blockers \n Last Taken", "Years", "Frequency")

```







# MENSHIS 1-9
```{r MENSHIS19, warning=FALSE, echo=FALSE, message=FALSE}

data_tib_all2$D_496539718_D_969451837 <- round(as.numeric(data_tib_all2$D_496539718_D_969451837), digits=0)
hist_funct_F(D_496539718_D_969451837,"MENSHIS: Age at First Menstrual Period", "Age", "Frequency")

fem_birth <- data_tib_all2 %>%  filter(D_407056417==536341288  | (D_750420077_D_578416151==1 | D_750420077_D_434651539==1))
fb <- as_tibble(fem_birth)

#How long until regular
regt <- fb %>%  filter(!is.na(D_496539718_D_969451837)) #D_496539718_D_496539718_D_648960871!=1 &  
regt <- regt %>%  mutate(howlong= case_when(D_167997205=="178420302"~"Unknown", 
                                            D_167997205=="410083265"~"More than 2 years to 3 years",
                                            D_167997205=="648960871"~"Never",
                                            D_167997205=="718537646"~"More than 3 years to 4 years",
                                            D_167997205=="801142243"~"More than 4 years", 
                                            D_167997205=="868025301"~"Within 1 year",
                                            D_167997205=="939110313"~"1 to 2 years",
                                            TRUE~"Skipped this Question"))
regt$howlong <- factor(regt$howlong,levels=c("Never", "Within 1 year","1 to 2 years","More than 2 years to 3 years","More than 3 years to 4 years","More than 4 years","Unknown","Skipped this Question"))

dt_regt_summary <- regt %>% group_by(howlong) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(howlong, n, percentage)


dt_regt_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS2: Length of Time Unitl Menstrual Cycle Regular")) %>% 
  cols_label(n= md("**N**"), howlong = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = howlong,
    )
  ) 




#Length of Menstrual Cycle once regular

reg <- fb %>%  filter(D_167997205!=648960871 & !is.na(D_167997205))

mens_lgth= reg %>%  mutate(length= case_when(D_972593606=="471375042"~"21+ days",
                                             D_972593606=="549031911"~"Too iregular/HIUD used",
                                             D_972593606=="858427002"~"Less than 21 days",
                                             TRUE~ "Skipped this Question"))
mens_lgth$length <- factor(mens_lgth$length,levels=c("Too iregular/HIUD used", "Less than 21 days","21+ days","Skipped this Question"))


dt_mens_lgth_summary <- mens_lgth %>% group_by(length) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(length, n, percentage)


dt_mens_lgth_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS3: Length of Menstrual Cycle Once Regular")) %>% 
  cols_label(n= md("**N**"), length = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = length,
    )
  ) 



#Length of cycle (days long)
hist_funct_F(D_791830593,"MENSHIS4: Days of menstrual Cycle", "Days", "Frequency")


#Length of cycle last 12 months

cycle12 <- fb %>%  filter(!is.na(D_496539718_D_969451837)) #D_496539718_D_496539718_D_648960871!=1 &  

mens_lgth= cycle12 %>%  mutate(length= case_when(D_164595895=="113064256"~"Frequency's changed",
                                                 D_164595895=="388370628"~"Too irregular to guess/IUD",
                                                 D_164595895=="471375042"~"21+ days",
                                                 D_164595895=="650420270"~"Haven't had one",
                                                 D_164595895=="859025516"~"Less than 21 days",
                                                 TRUE~ "Skipped this Question"))
mens_lgth$length <- factor(mens_lgth$length,levels=c("Haven't had one","Frequency's changed","Too irregular to guess/IUD","Less than 21 days","21+ days","Skipped this Question"))


dt_mens_lgt_summary <- mens_lgth %>% group_by(length) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(length, n, percentage)


dt_mens_lgt_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>%
  fmt_number(columns = "n", decimals = 0) %>%
  tab_header(title = md("MENSHIS5: Usual Length of Menstrual Cycle in the last 12 months")) %>% 
  cols_label(n= md("**N**"), length = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = length,
    )
  ) 



#How many days for the last 12 months
hist_funct_F(D_263114971,"MENSHIS6: Days of menstrual Cycle in the last 12 months", "Days", "Frequency")


#Why haven't had one

one_logic_funct2(D_614145455_D_614145455, D_164595895,"650420270", "MENSHIS7: Reason You Haven't Had Period")



#Age at last period
hist_funct_F(D_534920374,"MENSHIS8: Age at Last Period", "Age", "Frequency")




```
```{r MENSHIS9Answ, include=FALSE}

expr= fb %>%  mutate(symptoms= case_when(D_547633480_D_801183888==1 ~ "Spotting between Periods",
                                         D_547633480_D_825584471==1 ~ "Spotting after sex",
                                         D_547633480_D_503760666==1 ~ "Heavy bleeding during period",
                                         D_547633480_D_120016082==1 ~ "Irregular period",
                                         D_547633480_D_386152189==1 ~ "Bleeding after menopause",
                                         D_547633480_D_535003378==1 ~ "None of the Above",
                                         TRUE~ "Skipped this Question"))




 
mens9<- expr[, grepl("547633480", colnames(expr))]

tmp1Lang <- mens9[, c(5,6,3,1,2,4)]

mens9_dx <- NULL
for (i in 1:6){
  dt <- as.data.frame(tab1(tmp1Lang[,i])$output.table)
  dt$mens9_dx <- colnames(tmp1Lang)[i]
  mens9_dx <- rbind(mens9_dx,dt[2,])
  
}
mens9_dx$mens9_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

mens9_dx$mens9_dx <- c("Spotting between Periods","Spotting after sex","Heavy bleeding during period", "Irregular period","Bleeding after menopause","None of the Above")

```
```{r MENSHISTable, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(mens9_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- mens9_dx[, c(4,1,2)]
# 
# colnames(mens9_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- mens9_dx[, c(4,1,2)]

colnames(mens9_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
lang1 <- mens9_dx[, c(4,1,2)]

skipped_lang1 <- sum(table(expr$symptoms=="Skipped this Question")[2])
lang1[as.numeric(dim(lang1)[[1]])+1,] <- c("Skipped this Question", skipped_lang1, round((skipped_lang1/dim(expr)[[1]])*100,2))


dt_lang1 <- lang1 %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("MENSHIS9: Experienced the following")) %>% 
  cols_label(Frequency= md("**N**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_lang1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



```




# PREG 2-11
```{r PREG211, warning=FALSE, echo=FALSE, message=FALSE}




#Ever been pregnant 
one_logic_funct2(D_996243083, D_849945160, 104430631, "PREG2: Ever Pregnant")




#How many times
hist_funct_F(D_405571048,"PREG3: Times You've been Pregnant", "Times", "Frequency")



#Age at each pregnancy    #histogram vs ascending box plot?   #will need to add more eventually
preg1=boxp_funct_F(D_968816827_1_1,"PREG4_1: Age at First Pregnancy", "Age")
preg2=boxp_funct_F(D_968816827_2_2,"PREG4_2: Age at Second Pregnancy", "Age")
preg3=boxp_funct_F(D_968816827_3_3,"PREG4_3: Age at Third Pregnancy", "Age")
preg4=boxp_funct_F(D_968816827_4_4,"PREG4_4: Age at Fourth Pregnancy", "Age")
grid.arrange(preg1, preg2, preg3, preg4, nrow=2)

#Outcome of each pregnancy #remove NA column

##1

preg_funct(D_391951010_1_1, 1, "PREG5_1: Outcome of First Pregnancy")



##2
preg_funct(D_391951010_2_2, 2, "PREG5_2: Outcome of Second Pregnancy")



##3
preg_funct(D_391951010_3_3, 3, "PREG5_3: Outcome of Third Pregnancy")


##4
preg_funct(D_391951010_4_4, 4, "PREG5_4: Outcome of Fourth Pregnancy")





##Infants delivered

    #fb %>%  mutate(date_finished= case_when(D_832139544 > as.Date("")))-- skip logic change in preg section, will affect skipping percentage

#First pregnancy
data_tib_all2$D_281494550_1_1 <- factor(data_tib_all2$D_281494550_1_1, levels=c(582602017, 105727261, 720288326, "Skipped this Question"))
two_skip_funct2(D_281494550_1_1, "PREG6_1: Infants delivered during first pregnancy", D_391951010_1_1, "628445697", "419220239")



#Second pregnancy
data_tib_all2$D_281494550_2_2 <- factor(data_tib_all2$D_281494550_2_2, levels=c(582602017, 105727261, 720288326, "Skipped this Question"))
two_skip_funct2(D_281494550_2_2, "PREG6_2: Infants delivered during second pregnancy", D_391951010_2_2, "628445697", "419220239")



#Third Pregnancy
data_tib_all2$D_281494550_3_3 <- factor(data_tib_all2$D_281494550_3_3, levels=c(582602017, 105727261, 720288326, "Skipped this Question"))
two_skip_funct2(D_281494550_3_3, "PREG6_3: Infants delivered during third pregnancy", D_391951010_3_3, "628445697", "419220239")

#Fourth Pregnancy
data_tib_all2$D_281494550_4_4 <- factor(data_tib_all2$D_281494550_4_4, levels=c(582602017, 105727261, 720288326, "Skipped this Question"))
two_skip_funct2(D_281494550_4_4, "PREG6_4: Infants delivered during fourth pregnancy", D_391951010_4_4, "628445697", "419220239")








##Method 

#First Pregnancy 
three_skip_funct2(D_771528780_1_1, "PREG7_1: Method of delivery during first pregnancy", D_391951010_1_1, "628445697", "419220239", "223216393")

#Second Pregnancy 
three_skip_funct2(D_771528780_2_2, "PREG7_2: Method of delivery during second pregnancy", D_391951010_2_2, "628445697", "419220239", "223216393")

#Third Pregnancy 
three_skip_funct2(D_771528780_3_3, "PREG7_3: Method of delivery during third pregnancy", D_391951010_3_3, "628445697", "419220239", "223216393")

#Fourth Pregnancy 
three_skip_funct2(D_771528780_4_4, "PREG7_4: Method of delivery during fourth pregnancy", D_391951010_4_4, "628445697", "419220239", "223216393")





##Did you/are you breast feeding 

#First Pregnancy 
three_skip_funct2(D_486574018_1_1, "Preg8_1: Breast fed during first pregnancy", D_391951010_1_1, "628445697", "419220239", "223216393")


#Second Pregnancy 
three_skip_funct2(D_486574018_2_2, "PREG8_2: Breast fed during second pregnancy", D_391951010_2_2, "628445697", "419220239", "223216393")


#Third Pregnancy 
three_skip_funct2(D_486574018_3_3, "PREG8_3: Breast fed during third pregnancy", D_391951010_3_3, "628445697", "419220239", "223216393")

#Fourth Pregnancy 
three_skip_funct2(D_486574018_4_4, "PREG8_4: Breast fed during fourth pregnancy", D_391951010_4_4, "628445697", "419220239", "223216393")





#For how many months
merge_m2$D_278277373_1_1 <- round(as.numeric(merge_m2$D_278277373_1_1), digits=0)
merge_m2$D_278277373_2_2 <- round(as.numeric(merge_m2$D_278277373_2_2), digits=0)
merge_m2$D_278277373_3_3 <- round(as.numeric(merge_m2$D_278277373_3_3), digits=0)
merge_m2$D_278277373_4_4 <- round(as.numeric(merge_m2$D_278277373_4_4), digits=0)


breastfed1=hist_funct_F(D_278277373_1_1,"PREG9_1: Months of Breast Feeding First Child", "Months", "Frequency")
breastfed2=hist_funct_F(D_278277373_2_2,"PREG9_2: Months of Breast Feeding Second Child", "Months", "Frequency")
breastfed3=hist_funct_F(D_278277373_3_3,"PREG9_3: Months of Breast Feeding Third Child", "Months", "Frequency")
breastfed4=hist_funct_F(D_278277373_4_4,"PREG9_4: Months of Breast Feeding Fourth Child", "Months", "Frequency")
grid.arrange(breastfed1, breastfed2, breastfed3, breastfed4, nrow=2)






#Diagnosed with gestational diabetes during preg 


#First Pregnancy 
four_skip_funct2(D_779052408_1_1, "Preg10_1: Diagnosed with gestational diabetes during first pregnancy", D_391951010_1_1, "628445697", "419220239", "223216393", "858244199")

#Second Pregnancy 
four_skip_funct2(D_779052408_2_2, "PREG10_2: Diagnosed with gestational diabetes during second pregnancy", D_391951010_2_2, "628445697", "419220239", "223216393", "858244199")

#Third Pregnancy 
four_skip_funct2(D_779052408_3_3, "PREG10_3: Diagnosed with gestational diabetes during third pregnancy", D_391951010_3_3, "628445697", "419220239", "223216393", "858244199")

#Fourth Pregnancy 
four_skip_funct2(D_779052408_4_4, "PREG10_4: Diagnosed with gestational diabetes during fourth pregnancy", D_391951010_4_4, "628445697", "419220239", "223216393", "858244199")





##Diagnosed with eclampsia during preg
#First Pregnancy 
four_skip_funct2(D_133297530_1_1, "Preg11_1: Diagnosed with eclampsia or pre-eclampsia during first pregnancy", D_391951010_1_1, "628445697", "419220239", "223216393", "858244199")

#Second Pregnancy 
four_skip_funct2(D_133297530_2_2, "PREG11_2: Diagnosed with eclampsia or pre-eclampsia during second pregnancy", D_391951010_2_2, "628445697", "419220239", "223216393", "858244199")

#Third Pregnancy 
four_skip_funct2(D_133297530_3_3, "PREG11_3: Diagnosed with eclampsia or pre-eclampsia during third pregnancy", D_391951010_3_3, "628445697", "419220239", "223216393", "858244199")

#Fourth Pregnancy 
four_skip_funct2(D_133297530_4_4, "PREG11_4: Diagnosed with eclampsia or pre-eclampsia during fourth pregnancy", D_391951010_4_4, "628445697", "419220239", "223216393", "858244199")




```

# FERT 1-9
```{r Fert, warning=FALSE, echo=FALSE, message=FALSE}

#Ever tried to get pregnant for over a year but did not
one_logic_funct2(D_939897560, D_407056417, 536341288, "FERT1: Tried to get pregant for over a year but did not")



#How old when first tried
boxp_funct_F(D_760801131,"FERT2: Age you First Tried to get Pregnant for Over 1 Year", "Age")


#Sought medical advise
one_logic_funct2(D_424047361, D_939897560, 353358909, "FERT3: Sought medical advise for pregnancy")




```

```{r Fert4, include=FALSE}

preg_iss= fb %>% filter(D_424047361==353358909) %>%  
                      mutate(issue= case_when(D_548355426_D_548355426_D_342735868==1 ~ "Tubal blockage",
                                             D_548355426_D_548355426_D_990599372==1 ~ "Ovary or hormone problem",
                                             D_548355426_D_548355426_D_863286658==1 ~ "Endometriosis",
                                             D_548355426_D_548355426_D_202355614==1 ~ "Cervical mucus",
                                             D_548355426_D_548355426_D_201434907==1 ~ "Partner's infertility",
                                             D_548355426_D_548355426_D_570171052==1 ~ "Not looked into",
                                             D_548355426_D_548355426_D_498799217==1 ~ "No cause found",
                                             D_548355426_D_548355426_D_807835037==1 ~ "Other",
                                             TRUE~ "Skipped this Question"))

 
preg_issues<- preg_iss[, grepl("548355426", colnames(preg_iss))]
painmds <- preg_issues[, c(3,8,7,2,1,5,4,6 )]


medsp_dx <- NULL
for (i in 1:8){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Tubal blockage","Ovary or hormone problem","Endometriosis","Cervical mucus","Partner's infertility","Not looked into","No cause found","Other")
```
```{r Fert4Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
fert4 <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(preg_iss$issue=="Skipped this Question")[2])
fert4[as.numeric(dim(fert4)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(preg_iss)[[1]])*100,2))


fert4 <- fert4 %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("FERT4: Issue preventing pregnancy")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  fert4,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



#Used fertility meds
one_logic_funct2(D_224681201, D_407056417, 536341288, "FERT5: Ever used fertility medication")


```



```{r fert6, include=FALSE}

fert_med=  fb %>% filter(D_224681201==353358909) %>%  
                      mutate(meds= case_when(D_881200765_D_881200765_D_619799524==1 ~ "Chlomid",
                                             D_881200765_D_881200765_D_663814928==1 ~ "Injectables",
                                             D_881200765_D_881200765_D_642004888==1 ~ "Danazol", 
                                             D_881200765_D_881200765_D_454641975==1 ~ "Danocrine",
                                             D_881200765_D_881200765_D_256131117==1 ~ "Hcg",
                                             D_881200765_D_881200765_D_532607252==1 ~ "Milophene",
                                             D_881200765_D_881200765_D_459188493==1 ~ "Lupron depot",
                                             D_881200765_D_881200765_D_304927036==1 ~ "Nolyadex",
                                             D_881200765_D_881200765_D_100181644==1 ~ "Pergonal",
                                             D_881200765_D_881200765_D_372219003==1 ~ "Serophene",
                                             D_881200765_D_881200765_D_743731422==1 ~ "Synarel",
                                             D_881200765_D_881200765_D_807835037==1 ~ "Other",#
                                             D_881200765_D_881200765_D_535003378==1 ~ "None of the above",
                                             TRUE  ~ "Skipped this Question"))


#tmpFERT6 <- data_tib_all2 %>%  filter(data_tib_all2$D_224681201==353358909 & data_tib_all2$D_407056417==536341288)
tmpF6<- fert_med[, grepl("881200765", colnames(fert_med))]
tmpF6

tmp2_1 <- tmpF6[, c(10, 12, 11, 6, 3, 8, 7, 4, 2, 5, 13, 14, 9)]
fert6_dx <- NULL
for (i in 1:13){
  dt <- as.data.frame(tab1(tmp2_1[,i])$output.table)
  dt$fert6_dx <- colnames(tmp2_1)[i]
  fert6_dx <- rbind(fert6_dx,dt[2,])

}



#fert6_dx$fert6_dx 

#fert6_dx$fert6_dx <- c("Other specified", "Pergonal", "hCG", "Nolvadex", "Seophene", "Danocrine", "Lupron depot", "Milophene", "None of the above", "Clomid", "Danazol", "Gonadotropins", "Synarel nasal solution", "Other specified-double nested", "Other Medication")
fert6_dx$fert6_dx <- c("Clomid","Injectables","Danazol","Danocrine","hCG","Milophene","Lupron depot","Nolvadex","Pergonal","Seophene","Synarel nasal solution", "Other Medication", "None of the above")
```

```{r Fert6Table, warning=FALSE, echo=FALSE, message=FALSE}
colnames(fert6_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
mgr1 <- fert6_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(fert_med$meds=="Skipped this Question")[2])
mgr1[as.numeric(dim(mgr1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(data_tib_base)[[1]])*100,2))

dt_mgr1 <- mgr1 %>%  gt::gt(rowname_col = "row_lab") %>%
  tab_header(title = md("FERT6: Used these fertility medications")) %>%
  cols_label(Frequency= md("**N**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>%
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_mgr1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)



```




```{r fert17, warning=FALSE, echo=FALSE, message=FALSE}
#how many months/cycles taken     
hist_funct_F(D_139673389,"FERT17_1: Months/Cycles taking Chlomid", "Months", "Frequency")

hist_funct_F(D_943996164,"FERT17_2: Months/Cycles taking Injectables", "Months", "Frequency")

hist_funct_F(D_994899398,"FERT17_3: Months/Cycles taking Danazol", "Months", "Frequency")

hist_funct_F(D_198719822,"FERT17_4: Months/Cycles taking Danocrine", "Months", "Frequency") #not enough answers?

hist_funct_F(D_628137243,"FERT17_5: Months/Cycles taking HCG", "Months", "Frequency")

hist_funct_F(D_399078599,"FERT17_6: Months/Cycles taking Milophene", "Months", "Frequency") #don't know why this wont run

hist_funct_F(D_560711355,"FERT17_7: Months/Cycles taking Lupron Depot", "Months", "Frequency")

hist_funct_F(D_309710463,"FERT17_8: Months/Cycles taking Nolvadex", "Months", "Frequency") #don't know why this wont run

hist_funct_F(D_167207966,"FERT17_9: Months/Cycles taking Pergonal", "Months", "Frequency")

hist_funct_F(D_538349354,"FERT17_10: Months/Cycles taking Serophene", "Months", "Frequency")

hist_funct_F(D_767785846,"FERT17_11: Months/Cycles taking Synarel", "Months", "Frequency")

hist_funct_F(D_466346054,"FERT17_12: Months/Cycles taking Other Medications", "Months", "Frequency")




#Tried IVF
one_logic_funct2(D_111082535, D_407056417, 536341288, "FERT8: Ever had IVF")



#How many cycles of IVF   
hist_funct_F(D_875135634,"FERT9: Cycles of IVF", "Cycles", "Frequency")

```

# HORMED1-5
```{r hormed, warning=FALSE, echo=FALSE, message=FALSE}



dtHORMED= fb %>%  mutate(multb2 = ifelse((D_543780863_D_441493408==1 | D_543780863_D_543780863_D_441493408==1), 1, 0) + ifelse((D_543780863_D_612012325==1 | D_543780863_D_543780863_D_612012325==1), 1, 0) + ifelse((D_543780863_D_100752105==1 | D_543780863_D_543780863_D_100752105==1), 1, 0) + ifelse((D_543780863_D_207913198==1 | D_543780863_D_543780863_D_207913198==1), 1, 0) + ifelse((D_543780863_D_207913198==1 | D_543780863_D_543780863_D_207913198==1), 1, 0) + ifelse((D_543780863_D_863920008==1 | D_543780863_D_543780863_D_863920008==1), 1, 0) + ifelse((D_543780863_D_787142499==1 | D_543780863_D_543780863_D_787142499==1), 1, 0) + ifelse((D_543780863_D_205223932==1 | D_543780863_D_543780863_D_205223932==1), 1, 0) + ifelse((D_543780863_D_817131019==1 | D_543780863_D_543780863_D_817131019==1), 1, 0) + ifelse((D_543780863_D_807835037==1 | D_543780863_D_543780863_D_807835037==1), 1, 0) + ifelse((D_543780863_D_535003378==1 | D_543780863_D_543780863_D_535003378==1), 1, 0))


HORMED_med= dtHORMED %>%  mutate(meds= case_when( (as.numeric(multb2)>1) ~ "Multiple Medications",
                                                  (D_543780863_D_441493408==1 | D_543780863_D_543780863_D_441493408==1) ~ "Oral contraceptives (the pill)",
                                                  (D_543780863_D_612012325==1 | D_543780863_D_543780863_D_612012325==1) ~ "Progesterone pills (mini-pill)",
                                                  (D_543780863_D_100752105==1 | D_543780863_D_543780863_D_100752105==1) ~ "Norplant",
                                                  (D_543780863_D_207913198==1 | D_543780863_D_543780863_D_207913198==1) ~ "Depo-provera (shot)",
                                                  (D_543780863_D_863920008==1 | D_543780863_D_543780863_D_863920008==1) ~ "Vaginal ring",
                                                  (D_543780863_D_787142499==1 | D_543780863_D_543780863_D_787142499==1) ~ "Birth Control Patch",
                                                  (D_543780863_D_205223932==1 | D_543780863_D_543780863_D_205223932==1) ~ "Copper IUD",
                                                  (D_543780863_D_817131019==1 | D_543780863_D_543780863_D_817131019==1) ~ "Hormonal IUD",
                                                  (D_543780863_D_807835037==1 | D_543780863_D_543780863_D_807835037==1 | D_543780863_D_181769837==1) ~ "Other", #new response for other added D_543780863_D_181769837
                                                  (D_543780863_D_535003378==1 | D_543780863_D_543780863_D_535003378==1) ~ "None of the above",
                                                  TRUE~ "Skipped this Question"))


dtHORMED_summary <- HORMED_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtHORMED_summary %>%  gt::gt(rowname_col = "row_lab") %>%
  fmt_number(columns = "percentage", decimals = 2) %>%
  tab_header(title = md("HORMED: Ever used these hormone medications")) %>%
  cols_label(n= md("**N**"), meds = md("**Medications**"), percentage = md("**%**")) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 

#How old when first used
HORMED2_1 <- boxp_funct_F(D_880331901,"HORMED2_1: Age when 'The Pill' First Used", "Age")

HORMED2_2 <- boxp_funct_F(D_809735528,"HORMED2_2: Age when 'The Mini-Pill' First Used", "Age")

HORMED2_3 <- boxp_funct_F(D_220105997,"HORMED2_3: Age when Norplant First Used", "Age")

HORMED2_4 <- boxp_funct_F(D_938969985,"HORMED2_4: Age when 'The Shot' First Used", "Age")

HORMED2_5 <- boxp_funct_F(D_902999015,"HORMED2_5: Age when 'The Ring' First Used", "Age")
grid.arrange(HORMED2_1, HORMED2_2, HORMED2_3, HORMED2_4, HORMED2_5, nrow=3)


HORMED2_6 <- boxp_funct_F(D_807214881,"HORMED2_6: Age when 'The Patch' First Used", "Age")

HORMED2_7 <- boxp_funct_F(D_901154649,"HORMED2_7: Age when a CIUD First Used", "Age")

HORMED2_8 <- boxp_funct_F(D_404596261,"HORMED2_8: Age when an HIUD First Used", "Age")

HORMED2_9 <- boxp_funct_F(D_583012139,"HORMED2_9: Age when Other Hormonal Meds First Used", "Age")
grid.arrange(HORMED2_6, HORMED2_7, HORMED2_8, HORMED2_9, nrow=2)






#Combine V1 and V2 variables
data_tib_all2= data_tib_all2  %>%  mutate(D_543780863_D_441493408_only = ifelse(!is.na(D_543780863_D_441493408), D_543780863_D_441493408, D_543780863_D_543780863_D_441493408),
                                      D_543780863_D_100752105_only = ifelse(!is.na(D_543780863_D_100752105), D_543780863_D_100752105, D_543780863_D_543780863_D_100752105),
                                      D_543780863_D_207913198_only = ifelse(!is.na(D_543780863_D_207913198), D_543780863_D_207913198, D_543780863_D_543780863_D_207913198),
                                      D_543780863_D_863920008_only = ifelse(!is.na(D_543780863_D_863920008), D_543780863_D_863920008, D_543780863_D_543780863_D_863920008),
                                      D_543780863_D_787142499_only = ifelse(!is.na(D_543780863_D_787142499), D_543780863_D_787142499, D_543780863_D_543780863_D_787142499),
                                      D_543780863_D_205223932_only = ifelse(!is.na(D_543780863_D_205223932), D_543780863_D_205223932, D_543780863_D_543780863_D_205223932),
                                      D_543780863_D_817131019_only = ifelse(!is.na(D_543780863_D_817131019), D_543780863_D_817131019, D_543780863_D_543780863_D_817131019),
                                      D_543780863_D_181769837_only = ifelse(!is.na(D_543780863_D_181769837), D_543780863_D_181769837, D_543780863_D_543780863_D_807835037))



#Currently using
#Oral Contraceptive Pill
one_logic_funct2(D_301052397, D_543780863_D_441493408_only, 1, "HORMED3_1: Currently Taking Oral Contraceptive Pill")



#Progestin only Contraceptive Pill
one_logic_funct2(D_958009220, D_543780863_D_441493408_only, 1, "HORMED3_2: Currently Taking Progestin only Contraceptive Pill")


#Norplant
one_logic_funct2(D_806253825, D_543780863_D_100752105_only, 1, "HORMED3_3: Currently Taking Norplant")


#Depo-Provera
one_logic_funct2(D_876683805, D_543780863_D_207913198_only, 1, "HORMED3_4: Currently Taking Depo-Provera")

#Vaginal Ring
one_logic_funct2(D_484006644, D_543780863_D_863920008_only, 1, "HORMED3_5: Currently Using a Vaginal Ring")


#Birth Control Patch
one_logic_funct2(D_344573484, D_543780863_D_787142499_only, 1, "HORMED3_6: Currently Using a Birth Control Patch")


#CIUD
one_logic_funct2(D_100937200, D_543780863_D_205223932_only, 1, "HORMED3_7: Currently Using a CIUD")


#HIUD
one_logic_funct2(D_465017353, D_543780863_D_817131019_only, 1, "HORMED3_8: Currently Using an HIUD")


#Other
one_logic_funct2(D_991330361, D_543780863_D_181769837_only, 1, "HORMED3_9: Currently Taking Other Hormone Medications")



#Age last used
HORMED4_1 <- boxp_funct_F(D_734836192,"HORMED4_1: Age when 'The Pill' Last Used", "Age")

HORMED4_2 <- boxp_funct_F(D_946211808,"HORMED4_2: Age when 'The Mini-Pill' Last Used", "Age") 

HORMED4_3 <- boxp_funct_F(D_819957363,"HORMED4_3: Age when Norplant Last Used", "Age") 

HORMED4_4 <- boxp_funct_F(D_118237712,"HORMED4_4: Age when 'The Shot' Last Used", "Age") 

HORMED4_5 <- boxp_funct_F(D_190721176,"HORMED4_5: Age when 'The Ring' Last Used", "Age")
grid.arrange(HORMED4_1, HORMED4_2, HORMED4_3, HORMED4_4, HORMED4_5, nrow=3)

HORMED4_6 <- boxp_funct_F(D_708921303,"HORMED4_6: Age when 'The Patch' Last Used", "Age") 

HORMED4_7 <- boxp_funct_F(D_452984435,"HORMED4_7: Age when a CIUD Last Used", "Age") 

HORMED4_8 <- boxp_funct_F(D_370798456,"HORMED4_8: Age when an HIUD Last Used", "Age")

HORMED4_9 <- boxp_funct_F(D_184692605,"HORMED4_9: Age when Other Hormonal Med Last Used", "Age")
grid.arrange(HORMED4_6, HORMED4_7, HORMED4_8, HORMED4_9, nrow=3)






#Months/Years of total use
hist_funct_F(D_215455305_D_434243220,"HORMED5_1: Months The Pill was Used", "Months", "Frequency")
hist_funct_F(D_215455305_D_970604592,"HORMED5_1: Years The Pill was Used", "Years", "Frequency")

hist_funct_F(D_654271781_D_434243220,"HORMED5_2: Months The Mini-Pill was Used", "Months", "Frequency")
hist_funct_F(D_654271781_D_970604592,"HORMED5_2: Years The Mini-Pill was Used", "Years", "Frequency")


hist_funct_F(D_604086099_D_434243220,"HORMED5_3: Months The Norplant was Used", "Months", "Frequency")
merge_m2$D_604086099_D_970604592 <- round(as.numeric(merge_m2$D_604086099_D_970604592), digits=0)
hist_funct_F(D_604086099_D_970604592,"HORMED5_3: Years The Norplant was Used", "Years", "Frequency")

hist_funct_F(D_899455852_D_434243220,"HORMED5_4: Months The Shot was Used", "Months", "Frequency")
hist_funct_F(D_899455852_D_970604592,"HORMED5_4: Years The Shot was Used", "Years", "Frequency")

hist_funct_F(D_358011592_D_434243220,"HORMED5_5: Months The Ring was Used", "Months", "Frequency")
hist_funct_F(D_358011592_D_970604592,"HORMED5_5: Years The Ring was Used", "Years", "Frequency")


hist_funct_F(D_535533643_D_434243220,"HORMED5_6: Months The Patch was Used", "Months", "Frequency")
hist_funct_F(D_535533643_D_970604592,"HORMED5_6: Years The Patch was Used", "Years", "Frequency")


hist_funct_F(D_129924389_D_434243220,"HORMED5_7: Months a CIUD was Used", "Months", "Frequency")
hist_funct_F(D_129924389_D_970604592,"HORMED5_7: Years a CIUD was Used", "Years", "Frequency")


hist_funct_F(D_101144925_D_434243220,"HORMED5_8: Months an HIUD was Used", "Months", "Frequency")
merge_m2$D_101144925_D_970604592 <- round(as.numeric(merge_m2$D_101144925_D_970604592), digits=0)
hist_funct_F(D_101144925_D_970604592,"HORMED5_8: Years an HIUD was Used", "Years", "Frequency")

hist_funct_F(D_139348254_D_434243220,"HORMED5_9: Months an Other Medication was Used", "Months", "Frequency")
hist_funct_F(D_139348254_D_970604592,"HORMED5_9: Years an Other Medication was Used", "Years", "Frequency")

```


# MENOHOR

```{r MENOHOR, warning=FALSE, echo=FALSE, message=FALSE }
#Used prescribed hormones
one_logic_funct2(D_621744463, D_407056417, 536341288, "MENOHOR: Used Prescribed Hormones")




```

# ESTROHOR1-5
```{r ESTROHOR, include=FALSE}



est_med=  fb  %>% filter(D_621744463==353358909) %>%  
                      mutate(meds= case_when(D_668834883_D_668834883_D_246843973==1 ~ "Oral Estrogen",
                                             D_668834883_D_668834883_D_854184254==1 ~ "Patch Estrgen",
                                             D_668834883_D_668834883_D_515434780==1 ~ "Vaginal Ring/Vaginal Cream/Tablet Estrogen",
                                             D_668834883_D_668834883_D_674148137==1 ~ "Estrogen only Skin Gel/Cream/Spray-on",
                                             D_668834883_D_668834883_D_807835037==1 ~ "Other",
                                             D_668834883_D_668834883_D_535003378==1 ~ "None of the above",
                                             TRUE ~ "Skipped this Question"))

 
painmeds<- est_med[, grepl("668834883", colnames(est_med))]
painmds <- painmeds[, c(2,8, 3,6, 7,4)]

medsp_dx <- NULL
for (i in 1:6){
  dt <- as.data.frame(tab1(painmds[,i])$output.table)
  dt$medsp_dx <- colnames(painmds)[i]
  medsp_dx <- rbind(medsp_dx,dt[2,])
  
}
#medsp_dx$medsp_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

medsp_dx$medsp_dx <- c("Oral Estrogen","Patch Estrgen", "Vaginal Ring/Vaginal Cream/Tablet Estrogen","Estrogen only Skin Gel/Cream/Spray-on","Other","None of the above")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# mgr1_1 <- medsp_dx[, c(4,1,2)]
# 
# colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# mgr1_2 <- medsp_dx[, c(4,1,2)]

colnames(medsp_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
estro <- medsp_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(est_med$meds=="Skipped this Question")[2])
estro[as.numeric(dim(estro)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(est_med)[[1]])*100,2))


estro <- estro %>%  gt::gt() %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("ESTROHOR: Ever used these hormone medications")) %>% 
  cols_label(Frequency= md("**N**"), Condition = md("**Answer**"), Percentage = md("**%**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )# 

tab_footnote(
  estro,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)

```
```{r, warning=FALSE, echo=FALSE, message=FALSE}

#How old when first used
ESTROHOR2_1 <- boxp_funct_F(D_856627601,"ESTROHOR2_1: Age When Oral Hormone Therapy First Used", "Age")


ESTROHOR2_2 <- boxp_funct_F(D_564185028,"ESTROHOR2_2: Age When Patch Hormone Therapy First Used", "Age")


ESTROHOR2_3 <- boxp_funct_F(D_648678282,"ESTROHOR2_3: Age When Ring Hormone Therapy First Used", "Age")


ESTROHOR2_4 <- boxp_funct_F(D_291707744,"ESTROHOR2_4: Age When Gel/Cream Hormone Therapy First Used", "Age")


ESTROHOR2_5 <- boxp_funct_F(D_872509317,"ESTROHOR2_5: Age When Other Hormone Therapy First Used", "Age")
grid.arrange(ESTROHOR2_1, ESTROHOR2_2, ESTROHOR2_3, ESTROHOR2_4, ESTROHOR2_5, nrow=3)





##Currently using

#Oral Estrogen --gt table not runner well for these either
one_logic_funct2(D_801749224, D_668834883_D_668834883_D_246843973, 1, "ESTROHOR3_1: Currently Using Oral Estrogen")



#Patch Estrogen  
one_logic_funct2(D_560845692, D_668834883_D_668834883_D_854184254, 1, "ESTROHOR3_2: Currently Using Patch Estrogen")




#Vaginal Ring/Cream/Tablet Estrogen 
one_logic_funct2(D_850536692, D_668834883_D_668834883_D_515434780, 1, "ESTROHOR3_3: Currently Using Vaginal Ring/Cream/Tablet Estrogen")




#Skin Gel/Cream/Spray-on Estrogen 
one_logic_funct2(D_792792066, D_668834883_D_668834883_D_674148137, 1, "ESTROHOR3_4: Currently Using Skin Gel/Cream/Spray-on Estrogen")




#Other Estrogen 
one_logic_funct2(D_378921620, D_668834883_D_668834883_D_807835037, 1, "ESTROHOR3_5: Currently Using Vaginal Other Estrogen")





#Age last used 
ESTROHOR4_1 <- boxp_funct_F(D_799382711,"ESTROHOR4_1: Age Oral Homrone Therapy Last Used", "Age")


ESTROHOR4_2 <- boxp_funct_F(D_779165920,"ESTROHOR4_2: Age Patch Homrone Therapy Last Used", "Age")


ESTROHOR4_3 <- boxp_funct_F(D_774992239,"ESTROHOR4_3: Age Ring Homrone Therapy Last Used", "Age")


ESTROHOR4_4 <- boxp_funct_F(D_894363067,"ESTROHOR4_4: Age Gel/Cream Homrone Therapy Last Used", "Age")


ESTROHOR4_5 <- boxp_funct_F(D_854078473,"ESTROHOR4_5: Age Other Homrone Therapy Last Used", "Age")
grid.arrange(ESTROHOR4_1, ESTROHOR4_2, ESTROHOR4_3, ESTROHOR4_4, ESTROHOR4_5, nrow=3)


```

# PROGHOR 1-6_2
## Progestin
```{r PROGHOR, warning=FALSE, echo=FALSE, message=FALSE}
#Ever taken
prog_med= data_tib_all2  %>% filter(D_621744463==353358909 & D_407056417==536341288) %>%  
                      mutate(meds= case_when(D_800943768_D_800943768_D_687050279==1 & D_800943768_D_800943768_D_807835037==1 ~ "Both",
                                             D_800943768_D_800943768_D_687050279==1 ~ "Oral Progestin",
                                             D_800943768_D_800943768_D_807835037==1 ~ "Other Progestin",
                                             D_800943768_D_800943768_D_535003378==1 ~ "None of the Above",
                                             TRUE ~ "Skipped this Question"))
prog_med$meds <- factor(prog_med$meds,levels=c("Oral Progestin", "Other Progestin", "Both","None of the Above", "Skipped this Question"))


dtPROGHOR_summary <- prog_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtPROGHOR_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("PROGHOR: Ever used these hormone medications")) %>% 
  cols_label(n= md("**N**"), meds = md("**Hormones**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 

#Age first used
boxp_funct_F(D_590329439,"PROGHOR2_1: Age Oral Progestin First Used", "Age")

boxp_funct_F(D_356969766,"PROGHOR2_2: Age Other Progestin First Used", "Age")

##Currently using
#Oral
one_logic_funct2(D_906459952, D_800943768_D_800943768_D_687050279, 1, "PROGHOR3_1: Currently Using Oral Progestin")
# fb_PROGHOR3_1 <- data_tib_all2 %>%  filter(D_800943768_D_800943768_D_687050279==1)



#Other
one_logic_funct2(D_453820991, D_800943768_D_800943768_D_807835037, 1, "PROGHOR3_2: Currently Using Other Progestin")



#Age last used
boxp_funct_F(D_747629521,"PROGHOR4_1: Age Oral Progestin Last Used", "Age")

boxp_funct_F(D_111271067,"PROGHOR4_2: Age Other Progestin Last Used", "Age")

#Months/years of total use
hist_funct_F(D_556129044_D_434243220,"PROGHOR5_1: Months Oral Progestin was Used", "Years", "Frequency")
hist_funct_F(D_556129044_D_970604592,"PROGHOR5_1: Years Oral Progestin was Used", "Years", "Frequency")


hist_funct_F(D_597869478_D_434243220,"PROGHOR5_2: Months Other Progestin was Used", "Years", "Frequency")
hist_funct_F(D_597869478_D_970604592,"PROGHOR5_2: Years Other Progestin was Used", "Years", "Frequency")

#Days per cycle used (oral)

one_logic_funct2(D_563663099, D_800943768_D_800943768_D_687050279, 1, "PROGHOR6_1: Days per Cycle Oral Progestin Used")

#Days per cycle used (prescription)

one_logic_funct2(D_949663397, D_800943768_D_800943768_D_807835037, 1, "PROGHOR6_2: Days per Cycle Other Progestin Used")


```


# COMBHOR1-6
```{r COMBHOR, warning=FALSE, echo=FALSE, message=FALSE}

#Ever taken


est_med= fb  %>%   filter(D_621744463==353358909) %>%  
                      mutate(meds= case_when(D_263785082_D_263785082_D_837393880==1 ~ "Combined oral estrogen plus progestin pill",
                                             D_263785082_D_263785082_D_944874693==1 ~ "Two separate pills",
                                             D_263785082_D_263785082_D_837393880==1 & D_263785082_D_263785082_D_944874693==1 ~ "Both",
                                             D_263785082_D_263785082_D_807835037==1 ~ "Other combined hormones",
                                             D_263785082_D_263785082_D_535003378==1 ~ "None of the above",
                                             TRUE  ~ "Skipped this Question"))
est_med$meds <- factor(est_med$meds,levels=c("Combined oral estrogen plus progestin pill", "Two separate pills", "Both","Other combined hormones","None of the above","Skipped this Question"))


dtCOMBHOR_summary <- est_med %>% group_by(meds) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtCOMBHOR_summary %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("COMBHOR: Ever Use Combined Estrogen and Progestin Medications")) %>% 
  cols_label(n= md("**N**"), meds = md("**Hormones**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
    stub.font.weight = "bold"
  ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) 

#Age first used
boxp_funct_F(D_824165133,"COMBHOR2_1: Age Combined Estrogen & Progestin First Used", "Age")

boxp_funct_F(D_922903688,"COMBHOR2_2: Age Separate Pill Estrogen & Progestin First Used", "Age")

boxp_funct_F(D_219538082,"COMBHOR2_3: Age Other Estrogen & Progestin First Used", "Age")


##Currently using
#Combined
one_logic_funct2(D_295472931, D_263785082_D_263785082_D_837393880, 1, "COMBHOR3_1: Currently Using Combined Estrogen and Progestin")




#2 Separate Pills
one_logic_funct2(D_963284259, D_263785082_D_263785082_D_944874693, 1, "COMBHOR3_2: Currently Using Separated Estrogen and Progestin Pills")




#Other
one_logic_funct2(D_583111732, D_263785082_D_263785082_D_807835037, 1, "COMBHOR3_3: Currently Using Other Estrogen and Progestin Medication")




##Age last used
boxp_funct_F(D_728437398,"COMBHOR4_1: Age Combined Estrogen & Progestin Last Used", "Age")

boxp_funct_F(D_615905904,"COMBHOR4_2: Age Separate Pill Estrogen & Progestin Last Used", "Age")

boxp_funct_F(D_603209609,"COMBHOR4_3: Age Other Estrogen & Progestin Last Used", "Age")

#Months/years of total use
hist_funct_F(D_578176688_D_434243220,"COMBHOR5_1: Total Months Combined Estrogen & Progestin Used", "Months", "Frequency")
hist_funct_F(D_578176688_D_970604592,"COMBHOR5_1: Total Years Combined Estrogen & Progestin Used", "Years", "Frequency")

hist_funct_F(D_946710366_D_434243220,"COMBHOR5_2: Total Months Separate Pill Estrogen & Progestin Used", "Months", "Frequency")
hist_funct_F(D_946710366_D_970604592,"COMBHOR5_2: Total Years Separate Pill Estrogen & Progestin Used", "Years", "Frequency")

#Other
hist_funct_F(D_824251330_D_434243220,"COMBHOR5_3: Total Months Other Estrogen & Progestin Used", "Months", "Frequency")
hist_funct_F(D_824251330_D_970604592,"COMBHOR5_3: Total Years Other Estrogen & Progestin Used", "Years", "Frequency")


#Days per cycle used (combined pill)
one_logic_funct2(D_912818075, D_263785082_D_263785082_D_837393880, 1, "COMBHOR6_1: Days per Cycle Separate Pill Estrogen & Progestin Used")


```



# SEPHOR, 2
```{r SEPHOR, warning=FALSE, echo=FALSE, message=FALSE}

#Days per cycle used (separate pills)
one_logic_funct2(D_138836502, D_263785082_D_263785082_D_944874693, 1, "SEPHOR: Days per Cycle Separate Pill Estrogen & Progestin Used")


#Days per cycle used (other)
one_logic_funct2(D_290126991, D_263785082_D_263785082_D_807835037, 1, "SEPHOR2: Days per Cycle Other Estrogen & Progestin Used")


```

# TESTHER1-5
```{r TESTHER, warning=FALSE, echo=FALSE, message=FALSE}
#Ever used
one_logic_funct2(D_111235606, D_621744463, 353358909, "TESTTHER1: Used Testosterone Therapy")


```
```{r TESTHER2, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}



dtTESTTHER2= data_tib_all2  %>% filter(D_111235606==353358909) %>%  
                      mutate(meds= case_when(D_946849196_D_729863969==1 ~ "Gel/Cream Testosterone",
                                             D_946849196_D_108104748==1 ~ "Testosterone Injection",
                                             D_946849196_D_717308596==1 ~ "Testosterone Skin Patch",
                                             D_946849196_D_746788766==1 ~ "Testosterone Pills",
                                             D_946849196_D_158214723==1 ~ "Gum or Inner-cheek Patch Testosterone",
                                             D_946849196_D_658810736==1 ~ "Slow Release Implant Testosterone",
                                             TRUE ~ "Skipped this Question"))

 
tmp_1<- dtTESTTHER2[, grepl("946849196", colnames(dtTESTTHER2))]
tmp1 <- tmp_1[, c(5,1,4,6,2,3)]
testtr2_dx <- NULL
for (i in 1:6){
  dt <- as.data.frame(tab1(tmp1[,i])$output.table)
  dt$testtr2_dx <- colnames(tmp1)[i]
  testtr2_dx <- rbind(testtr2_dx,dt[2,])
  
}
testtr2_dx$testtr2_dx ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

testtr2_dx$testtr2_dx <- c("Gel/Cream Testosterone","Testosterone Injection","Testosterone Skin Patch","Testosterone Pills","Gum or Inner-cheek Patch Testosterone","Slow Release Implant Testosterone")
```
```{r TESTHER2Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(testtr2_dx) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# testt2_1 <- testtr2_dx[, c(4,1,2)]
# 
# colnames(testtr2_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# testt2_2 <- testtr2_dx[, c(4,1,2)]

colnames(testtr2_dx) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
testt2 <- testtr2_dx[, c(4,1,2)]

skipped_mhg1 <- sum(table(dtTESTTHER2$meds=="Skipped this Question")[2])
testt2[as.numeric(dim(testt2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dtTESTTHER2)[[1]])*100,2))


dt_testt2 <- testt2 %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("TESTTHER2: Testosterone Medication Forms")) %>% 
  cols_label(Frequency= md("**N**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_testt2,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```
```{r TESTHER35, warning=FALSE, echo=FALSE, message=FALSE}





#Age first used 
merge_m2$D_797076693 <- as.numeric(merge_m2$D_797076693)
boxp_funct_F(D_797076693,"TESTTHER3: Age Testosterone First Used", "Age")


#How often
test_med= data_tib_all2  %>% filter(D_111235606==353358909 & !(D_946849196_D_729863969==104430631 &  D_946849196_D_108104748==104430631  &
                                                                    D_946849196_D_717308596==104430631 &  D_946849196_D_746788766==104430631 &  
                                                                    D_946849196_D_158214723==104430631 &  D_946849196_D_658810736==353358909)) %>%  
                        mutate(meds= case_when(D_984514646=="729363341"~"Daily(2+ times)",
                                              D_984514646=="181786871"~"Daily",
                                              D_984514646=="626911538"~"Every few days",
                                              D_984514646=="522395860"~"Once per Week",
                                              D_984514646=="814242010"~"Few times per Month",
                                              D_984514646=="235613392"~"Rarely",
                                             TRUE ~ "Skipped this Question"))
test_med$meds <- factor(test_med$meds,levels=c("Daily(2+ times)","Daily", "Every few days","Once per Week","Few times per Month","Rarely","Skipped this Question"))

dtTESTTHER2_summary <- test_med %>% group_by(meds) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(meds, n, percentage)


dtTESTTHER2_summary %>%  gt::gt() %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("TESTTHER4: How often Testosterone Used")) %>% 
  cols_label(n= md("**N**"), meds = md("**Answer**"), percentage = md("**%**")) %>% 
  # summary_rows(
  #   column = c(n,percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = meds,
    )
  ) %>% opt_row_striping()

#Age last used
boxp_funct_F(D_414663452,"TESTTHER5: Age Testosterone Last Used", "Age")



```

# PRESHOR1-6
```{r PRESHOR, warning=FALSE, echo=FALSE, message=FALSE}

#Taken other types
one_logic_funct2(D_570187182, D_621744463, 353358909, "PRESHOR: Ever taken Other Prescription Medication")




# #What other kind
# cat("PRESHOR2: Other Types of Hormones Taken")
# teso_oth= data_tib_all2 %>%  select(D_557526470) %>% filter(!is.na(D_557526470))
# #list(teso_oth)
# teso_oth

#Age first used other kind
boxp_funct_F(D_492822047,"PRESHOR3: Age Other Testosterone First Used", "Age")


#Currently using other kind
one_logic_funct2(D_466727144, D_570187182, 353358909, "PRESHOR4: Currently Using Other Prescription Medication")


#Age last used other kind
boxp_funct_F(D_307736999,"PRESHOR5: Age Other Testosterone Last Used", "Age")


#Months or years of other kind
hist_funct(D_305195766_D_434243220,"PRESHOR6: Total Months Other Testosterone Used", "Months", "Frequency")
hist_funct(D_305195766_D_970604592,"PRESHOR6: Total Years Other Testosterone Used", "Years", "Frequency")

```


```{r WorkActGrids, include=FALSE}

#warning=FALSE, echo=FALSE, message=FALSE
#Work over last 12 months: sitting, arm movements
data_tib_all2$D_392658845_D_699101535 <- factor(data_tib_all2$D_392658845_D_699101535,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
one_logic_funct2(D_392658845_D_699101535, D_613744428, 353358909, "WORKACTA: Work over last 12 months: Sitting with Arm Movements")




data_tib_all2$D_392658845_D_652561589 <- factor(data_tib_all2$D_392658845_D_652561589,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
one_logic_funct2(D_392658845_D_652561589, D_613744428, 353358909,"WORKACTB: Work over last 12 months: Standing with Walking")



data_tib_all2$D_392658845_D_589522790 <- factor(data_tib_all2$D_392658845_D_589522790,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
one_logic_funct2(D_392658845_D_589522790, D_613744428, 353358909,"WORKACTC: Work over last 12 months: Walking and Carrying Materials")



data_tib_all2$D_392658845_D_239572239 <- factor(data_tib_all2$D_392658845_D_239572239,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
one_logic_funct2(D_392658845_D_239572239, D_613744428, 353358909,"WORKACTD: Work over last 12 months: Walking and Heavy Manual Labor")
```

# SITTINGA-D 
```{r SittingGrids, include=FALSE}
#warning=FALSE, echo=FALSE, message=FALSE

data_tib_all2$D_649352910_D_654385712 <- factor(data_tib_all2$D_649352910_D_654385712,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
simple_funct2(D_649352910_D_654385712, "SITTINGA: Driving or Sitting in a Car, Bus, or Train")




data_tib_all2$D_649352910_D_263483736 <- factor(data_tib_all2$D_649352910_D_263483736,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
simple_funct2(D_649352910_D_263483736, "SittingB: Watching TV or other Video Content")


data_tib_all2$D_649352910_D_806746224 <- factor(data_tib_all2$D_649352910_D_806746224,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
simple_funct2(D_649352910_D_806746224, "SittingC: Browsing or Playing Games")


data_tib_all2$D_649352910_D_396649512 <- factor(data_tib_all2$D_649352910_D_396649512,levels=c(503218834, 464753847, 729681071, 258023209, 638092100, 628177728, 919739344, 755558825, 949555271, 201002865, "Skipped this Question"))
simple_funct2(D_649352910_D_396649512, "SittingD: Other Activity")

``` 

# HOUSE1A-2E 
```{r houre1a2e, include=FALSE}
#warning=FALSE, echo=FALSE, message=FALSE
data_tib_all2$D_733547268_D_980120253 <- factor(data_tib_all2$D_733547268_D_980120253,levels=c(648960871, 239152340, 582006876, 645894551, 996315715, 671267928, 647504893, "Skipped this Question"))
simple_funct2(D_733547268_D_980120253, "HOUSE1A: Frequency of Light Household Chores")


data_tib_all2$D_733547268_D_993029890 <- factor(data_tib_all2$D_733547268_D_993029890,levels=c(648960871, 239152340, 582006876, 645894551, 996315715, 671267928, 647504893, "Skipped this Question"))
simple_funct2(D_733547268_D_993029890, "HOUSE1B: Frequency of Moderate to Vigorous Household Chores")


data_tib_all2$D_733547268_D_980196073 <- factor(data_tib_all2$D_733547268_D_980196073,levels=c(648960871, 239152340, 582006876, 645894551, 996315715, 671267928, 647504893, "Skipped this Question"))
simple_funct2(D_733547268_D_980196073, "HOUSE1C: Frequency of Caring for Pets")


data_tib_all2$D_733547268_D_115422925 <- factor(data_tib_all2$D_733547268_D_115422925,levels=c(648960871, 239152340, 582006876, 645894551, 996315715, 671267928, 647504893, "Skipped this Question"))
simple_funct2(D_733547268_D_115422925, "HOUSE1D: Frequency of Caring for Kids/Adults")


data_tib_all2$D_733547268_D_980120253 <- factor(data_tib_all2$D_733547268_D_980120253,levels=c(648960871, 239152340, 582006876, 645894551, 996315715, 671267928, 647504893, "Skipped this Question"))
simple_funct2(D_733547268_D_151161693, "HOUSE1E: Frequency of Walking while Shopping")


 house2a <- data_tib_all2  %>% filter(D_733547268_D_980120253!=648960871)  
 h2a <- house2a %>%  mutate(time= case_when(D_128705365_D_607323377=="206020811" ~"31-44 min.", 
                                             D_128705365_D_607323377=="248303092" ~"16-30 min.", 
                                             D_128705365_D_607323377=="264163865" ~ "45-59 min.", 
                                             D_128705365_D_607323377=="428999623" ~ "0-15 min.", 
                                             D_128705365_D_607323377=="628177728" ~ "2 hrs", 
                                             D_128705365_D_607323377=="638092100" ~ "1 hr", 
                                             D_128705365_D_607323377=="805918496" ~ "3+ hrs", 
                                             TRUE~ "Skipped this Question")) 


 dt_house2a_summary <- h2a %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage) 


 dt_house2a_summary %>%  gt::gt(rowname_col = "row_lab") %>% 
   fmt_number(columns = "percentage", decimals = 2) %>% 
   tab_header(title = md("HOUSE2A: Time Spent doing Light Household Chores")) %>% 
   cols_label(n= md("**N**"), time = md("**Time Spent**"), percentage = md("**%**")) %>% 
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = time, 
     ) 
   )  




 house2b <- data_tib_all2  %>% filter(D_733547268_D_993029890!=648960871)  
 h2b <- house2b %>%  mutate(time= case_when(D_128705365_D_491484323=="206020811" ~"31-44 min.", 
                                             D_128705365_D_491484323=="248303092" ~"16-30 min.", 
                                             D_128705365_D_491484323=="264163865" ~ "45-59 min.", 
                                             D_128705365_D_491484323=="428999623" ~ "0-15 min.", 
                                             D_128705365_D_491484323=="628177728" ~ "2 hrs", 
                                             D_128705365_D_491484323=="638092100" ~ "1 hr", 
                                             D_128705365_D_491484323=="805918496" ~ "3+ hrs", 
                                             TRUE~ "Skipped this Question")) 


 dt_house2b_summary <- h2b %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage) 


 dt_house2b_summary %>%  gt::gt(rowname_col = "row_lab") %>% 
   fmt_number(columns = "percentage", decimals = 2) %>% 
   tab_header(title = md("HOUSE2B: Time Spent doing Moderate to Vigorous Household Chores")) %>% 
   cols_label(n= md("**N**"), time = md("**Time Spent**"), percentage = md("**%**")) %>% 
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = time, 
     ) 
   )  




 house2c <- data_tib_all2  %>% filter(D_733547268_D_980196073!=648960871)  
 h2c <- house2c %>%  mutate(time= case_when(D_128705365_D_588637585=="206020811" ~"31-44 min.", 
                                             D_128705365_D_588637585=="248303092" ~"16-30 min.", 
                                             D_128705365_D_588637585=="264163865" ~ "45-59 min.", 
                                             D_128705365_D_588637585=="428999623" ~ "0-15 min.", 
                                             D_128705365_D_588637585=="628177728" ~ "2 hrs", 
                                             D_128705365_D_588637585=="638092100" ~ "1 hr", 
                                             D_128705365_D_588637585=="805918496" ~ "3+ hrs", 
                                             TRUE~ "Skipped this Question")) 


 dt_house2c_summary <- h2c %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage) 


 dt_house2c_summary %>%  gt::gt(rowname_col = "row_lab") %>% 
   fmt_number(columns = "percentage", decimals = 2) %>% 
   tab_header(title = md("HOUSE2C: Time Spent Caring for Pets")) %>% 
   cols_label(n= md("**N**"), time = md("**Time Spent**"), percentage = md("**%**")) %>% 
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = time, 
     ) 
   )  




 house2d <- data_tib_all2  %>% filter(D_733547268_D_115422925!=648960871)  
 h2d <- house2d %>%  mutate(time= case_when(D_128705365_D_199039940=="206020811" ~"31-44 min.", 
                                             D_128705365_D_199039940=="248303092" ~"16-30 min.", 
                                             D_128705365_D_199039940=="264163865" ~ "45-59 min.", 
                                             D_128705365_D_199039940=="428999623" ~ "0-15 min.", 
                                             D_128705365_D_199039940=="628177728" ~ "2 hrs", 
                                             D_128705365_D_199039940=="638092100" ~ "1 hr", 
                                             D_128705365_D_199039940=="805918496" ~ "3+ hrs", 
                                             TRUE~ "Skipped this Question")) 


 dt_house2d_summary <- h2d %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage) 


 dt_house2d_summary %>%  gt::gt(rowname_col = "row_lab") %>% 
   fmt_number(columns = "percentage", decimals = 2) %>% 
   tab_header(title = md("HOUSE2D: Time Spent Caring for Kids/Adults")) %>% 
   cols_label(n= md("**N**"), time = md("**Time Spent**"), percentage = md("**%**")) %>% 
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = time, 
     ) 
   )  




 house2e <- data_tib_all2  %>% filter(D_733547268_D_151161693!=648960871)  
 h2e <- house2e %>%  mutate(time= case_when(D_128705365_D_986476579=="206020811" ~"31-44 min.", 
                                             D_128705365_D_986476579=="248303092" ~"16-30 min.", 
                                             D_128705365_D_986476579=="264163865" ~ "45-59 min.", 
                                             D_128705365_D_986476579=="428999623" ~ "0-15 min.", 
                                             D_128705365_D_986476579=="628177728" ~ "2 hrs", 
                                             D_128705365_D_986476579=="638092100" ~ "1 hr", 
                                             D_128705365_D_986476579=="805918496" ~ "3+ hrs", 
                                             TRUE~ "Skipped this Question")) 


 dt_house2e_summary <- h2e %>% group_by(time) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(time, n, percentage) 


 dt_house2e_summary %>%  gt::gt(rowname_col = "row_lab") %>% 
   fmt_number(columns = "percentage", decimals = 2) %>% 
   tab_header(title = md("HOUSE2E: Time Spent Walking while Shopping")) %>% 
   cols_label(n= md("**N**"), time = md("**Time Spent**"), percentage = md("**%**")) %>% 
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = time, 
     ) 
   )  


``` 

# LAWN1, LAWN2A-LAWN4C 
```{r Lawn, include=FALSE}
#warning=FALSE, echo=FALSE, message=FALSE

 chore_type= data_tib_all2 %>%  mutate(chore= case_when(D_204421360_D_797221287==1 ~ "Moderate Chores", 
                                              D_204421360_D_500744195==1 ~ "Vigorous Chores", 
                                              D_204421360_D_383015037==1 ~ "Home Repair", 
                                              D_204421360_D_535003378==1 ~ "None of the Above", 
                                              TRUE~ "Skipped this Question")) 


 dtLAWN1_summary <- chore_type %>% group_by(chore) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(chore, n, percentage) 


 dtLAWN1_summary %>%  gt::gt(rowname_col = "row_lab") %>% 
   fmt_number(columns = "percentage", decimals = 2) %>% 
   tab_header(title = md("LAWN1: Lawn, Garden and Home Repair Activities")) %>% 
   cols_label(n= md("**N**"), chore = md("**Chores**"), percentage = md("**%**")) %>% 
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = chore, 
     ) 
   )  





 #Seasons- moderate 


 dtLAWN2A= data_tib_all2 %>% filter(D_204421360_D_797221287==1) 


 mod_ss= dtLAWN2A %>%  mutate(season= case_when(D_442059084_D_917302906==1 ~ "Winter", 
                                              D_442059084_D_152773041==1 ~ "Spring", 
                                              D_442059084_D_249341444==1 ~ "Summer", 
                                              #D_442059084_D_690018400==1 ~ "Fall", 
                                              TRUE~ "Skipped this Question")) 


 dtLAWN2A_summary <- mod_ss %>% group_by(season) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage) 

 dtLAWN2A_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN2A: Seasons Moderate Chores Done (Can be more than one)")) %>%  
   cols_label(n= md("**N**"), season = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = season, 
     ) 
   )  



 #How often- moderate 
 levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this Question" )
one_logic_funct2(D_992022740,D_204421360_D_797221287,1,"LAWN3A: Frequency of Moderate Outdoor Chores") 
 LAWN3A <- data_tib_all2 %>%  filter(D_204421360_D_797221287==1) 
 LAWN3A_ans= LAWN3A %>%  mutate(answer= case_when(D_992022740==239152340 ~ "Once a month or less", 
                                                         D_992022740==582006876 ~ "2-3 days per month", 
                                                         D_992022740==645894551 ~ "1-2 days per week", 
                                                         D_992022740==996315715 ~ "3-4 days per week", 
                                                         D_992022740==671267928 ~ "5-6 days per week", 
                                                         D_992022740==647504893 ~ "Every day", 
                                                         TRUE ~ "Skipped this Question")) 

 LAWN3A_ans$answer <- factor(LAWN3A_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this Question" )) 

 dtLAWN3A_summary <- LAWN3A_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage) 

 dtLAWN3A_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN3A: Frequency of Moderate Outdoor Chores")) %>%  
   cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = answer, 
     ) 
   )  


 #Time per day- moderate 
 levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this Question" )
one_logic_funct2(D_429531329,D_204421360_D_797221287,1,"LAWN4A: Time Spent on Moderate Outdoor Chores") 
 LAWN4A <- data_tib_all2 %>%  filter(D_204421360_D_797221287==1) 
 LAWN4A_ans= LAWN4A %>%  mutate(answer= case_when(D_429531329==428999623 ~ "15 minutes or less", 
                                                         D_429531329==248303092 ~ "16 to 30 minutes", 
                                                         D_429531329==206020811 ~ "31 to 44 minutes", 
                                                         D_429531329==264163865 ~ "45 to 59 minutes", 
                                                         D_429531329==638092100 ~ "1 hour", 
                                                  D_429531329==628177728 ~ "2 hours", 
                                                  D_429531329==805918496 ~ "3 hours or more", 
                                                         TRUE ~ "Skipped this Question")) 

 LAWN4A_ans$answer <- factor(LAWN4A_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this Question" )) 

 dtLAWN4A_summary <- LAWN4A_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage) 

 dtLAWN4A_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN4A: Time Spent on Moderate Outdoor Chores")) %>%  
   cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = answer, 
     ) 
   )  






 #Seasons- vigorous 


 dtLAWN2B= data_tib_all2 %>%  filter(D_204421360_D_500744195==1) 


 vig_ss= dtLAWN2B %>%  mutate(season= case_when(D_829749579_D_917302906==1 ~ "Winter", 
                                              D_829749579_D_152773041==1 ~ "Spring", 
                                              D_829749579_D_249341444==1 ~ "Summer", 
                                              D_829749579_D_690018400==1 ~ "Fall", 
                                              TRUE~ "Skipped this Question")) 


 dtLAWN2B_summary <- vig_ss %>% group_by(season) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage) 


 dtLAWN2B_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN2B: Seasons Vigorous Chores Done (Can be more than one)")) %>%  
   cols_label(n= md("**N**"), season = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = season, 
     ) 
   )  

 #How often- vigorous 
one_logic_funct2(D_888313306,D_204421360_D_500744195,1,"LAWN3B: Frequency of Vigorous Outdoor Chores") 
 LAWN3B <- data_tib_all2 %>%  filter(D_204421360_D_500744195==1) 
 LAWN3B_ans= LAWN3B %>%  mutate(answer= case_when(D_888313306==239152340 ~ "Once a month or less", 
                                                         D_888313306==582006876 ~ "2-3 days per month", 
                                                         D_888313306==645894551 ~ "1-2 days per week", 
                                                         D_888313306==996315715 ~ "3-4 days per week", 
                                                         D_888313306==671267928 ~ "5-6 days per week", 
                                                         D_888313306==647504893 ~ "Every day", 
                                                         TRUE ~ "Skipped this Question")) 

 LAWN3B_ans$answer <- factor(LAWN3B_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this Question" )) 

 dtLAWN3B_summary <- LAWN3B_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage) 

 dtLAWN3B_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN3B: Frequency of Vigorous Outdoor Chores")) %>%  
   cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = answer, 
     ) 
   )  



 #Time per day- vigorous 
one_logic_funct2(D_644018981,D_204421360_D_500744195,1,"LAWN4B: Time Spent on Vigorous Outdoor Chores") 
 LAWN4B <- data_tib_all2 %>%  filter(D_204421360_D_500744195==1) 
 LAWN4B_ans= LAWN4B %>%  mutate(answer= case_when(D_644018981==428999623 ~ "15 minutes or less", 
                                                         D_644018981==248303092 ~ "16 to 30 minutes", 
                                                         D_644018981==206020811 ~ "31 to 44 minutes", 
                                                         D_644018981==264163865 ~ "45 to 59 minutes", 
                                                         D_644018981==638092100 ~ "1 hour", 
                                                  D_644018981==628177728 ~ "2 hours", 
                                                  D_644018981==805918496 ~ "3 hours or more", 
                                                         TRUE ~ "Skipped this Question")) 

 LAWN4B_ans$answer <- factor(LAWN4B_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this Question" )) 

 dtLAWN4B_summary <- LAWN4B_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage) 

 dtLAWN4B_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN4B: Time Spent on Moderate Outdoor Chores")) %>%  
   cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = answer, 
     ) 
   )  




 #Seasons- home repair    


 dtLAWN2C= data_tib_all2 %>% filter(D_204421360_D_383015037==1) 


 home_ss= dtLAWN2C %>%  mutate(season= case_when(D_618482103_D_917302906==1 ~ "Winter", 
                                              D_618482103_D_152773041==1 ~ "Spring", 
                                              D_618482103_D_249341444==1 ~ "Summer", 
                                              D_618482103_D_690018400==1 ~ "Fall", 
                                              TRUE~ "Skipped this Question")) 


 dtLAWN2C_summary <- home_ss %>% group_by(season) %>% dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(season, n, percentage) 


 dtLAWN2C_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN2C: Seasons Vigorous Chores Done (Can be more than one)")) %>%  
   cols_label(n= md("**N**"), season = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = season, 
     ) 
   )  


 #How often- home repair 
one_logic_funct2(D_352531133,D_204421360_D_383015037,1,"LAWN3B: Frequency of Home Repair") 
 LAWN3C <- data_tib_all2 %>%  filter(D_204421360_D_383015037==1) 
 LAWN3C_ans= LAWN3C %>%  mutate(answer= case_when(D_352531133==239152340 ~ "Once a month or less", 
                                                         D_352531133==582006876 ~ "2-3 days per month", 
                                                         D_352531133==645894551 ~ "1-2 days per week", 
                                                         D_352531133==996315715 ~ "3-4 days per week", 
                                                         D_352531133==671267928 ~ "5-6 days per week", 
                                                         D_352531133==647504893 ~ "Every day", 
                                                         TRUE ~ "Skipped this Question")) 

 LAWN3C_ans$answer <- factor(LAWN3C_ans$answer,levels=c("Once a month or less", "2-3 days per month", "1-2 days per week", "3-4 days per week", "5-6 days per week", "Every day", "Skipped this Question" )) 

 dtLAWN3C_summary <- LAWN3C_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage) 

 dtLAWN3C_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN3C: Frequency of Home Repair")) %>%  
   cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = answer, 
     ) 
   )  



 #Time per day- home repair 
one_logic_funct2(D_267261558,D_204421360_D_383015037,1,"LAWN4B: Time Spent on Home Repair") 
 LAWN4C <- data_tib_all2 %>%  filter(D_204421360_D_383015037==1) 
 LAWN4C_ans= LAWN4C %>%  mutate(answer= case_when(D_267261558==428999623 ~ "15 minutes or less", 
                                                         D_267261558==248303092 ~ "16 to 30 minutes", 
                                                         D_267261558==206020811 ~ "31 to 44 minutes", 
                                                         D_267261558==264163865 ~ "45 to 59 minutes", 
                                                         D_267261558==638092100 ~ "1 hour", 
                                                  D_267261558==628177728 ~ "2 hours", 
                                                  D_267261558==805918496 ~ "3 hours or more", 
                                                         TRUE ~ "Skipped this Question")) 

 LAWN4C_ans$answer <- factor(LAWN4C_ans$answer,levels=c("15 minutes or less", "16 to 30 minutes", "31 to 44 minutes", "45 to 59 minutes", "1 hour", "2 hours", "3 hours or more", "Skipped this Question" )) 

 dtLAWN4C_summary <- LAWN4C_ans %>% group_by(answer) %>%   dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(answer, n, percentage) 

 dtLAWN4C_summary %>%  gt::gt(rowname_col = "row_lab") %>%   
   fmt_number(columns = "percentage", decimals = 2) %>%  
   tab_header(title = md("LAWN4C: Time Spent on Home Repair")) %>%  
   cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>%  
   grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|> 
   tab_options( 
       stub.font.weight = "bold" 
     ) %>% 
   tab_style( 
     style = list( 
       cell_text(weight = "bold") 
     ), 
     locations = cells_body( 
       columns = answer, 
     ) 
   )  



``` 





# SLEEPSCHB 
```{r SLEEPSCHB, warning=FALSE, echo=FALSE, message=FALSE}

data_tib_all2$D_168431681 <- factor(data_tib_all2$D_168431681,levels=c(349122068, 156095877, 162668459, 278139969, 676824724, 512144428,125674414, "Skipped this Question" ))
one_logic_funct2(D_168431681,D_591723682,"353358909","SLEEPSCHB: Days per Week Sleep Determined by Job or School") 

``` 

# SLEEP1A, D, F, I, K, L, M 
```{r SLEEP1, warning=FALSE, echo=FALSE, message=FALSE}

 #Time you go to bed workdays/most days   #DO NOT CHANGE TO AS NUMERIC 
 merge_m2 %>% filter(!is.na(merge_m2$D_636757313)) %>% ggplot(aes(x=D_636757313))+ ylab("Count") +  
   xlab("Time (Military Time)") +geom_bar()+  ggtitle("SLEEP1A: Time You go to Bed") +theme(axis.text.x = element_text(angle = 90)) 


 merge_m2$D_653906464_D_707805344 <- as.numeric(merge_m2$D_653906464_D_707805344) #hours 
 merge_m2$D_653906464_D_850393641 <- as.numeric(merge_m2$D_653906464_D_850393641) #minutes 
 in_minutes= round(((merge_m2$D_653906464_D_707805344*60)+merge_m2$D_653906464_D_850393641), digits=0) 
 hist_funct_D(in_minutes,"SLEEP1D: Length of Time to Fall asleep", "Minutes", "Frequency") 


 #Time you wake up workdays/most days      #DO NOT CHANGE TO AS NUMERIC 
 merge_m2 %>% filter(!is.na(merge_m2$D_580367946)) %>% ggplot(aes(x=D_580367946, fill=D_407056417))+ ylab("Count") +  
   xlab("Time (Military Time)") +geom_bar()+  ggtitle("SLEEP1F: Time you Wake Up") + theme(axis.text.x = element_text(angle = 90))+ 
   scale_fill_discrete(name = "Gender",  labels=c("Female", "Male")) 


 #How long do you lie in bed workdays/most days    
 merge_m2$D_358259099_D_707805344 <- as.numeric(merge_m2$D_358259099_D_707805344) #hours 
 merge_m2$D_358259099_D_850393641 <- as.numeric(merge_m2$D_358259099_D_850393641) #minutes 
 in_mins= round(((merge_m2$D_358259099_D_707805344*60)+merge_m2$D_358259099_D_850393641), digits=0) 
 hist_funct_D(in_mins,"SLEEP1I: Length of Lying in Bed After Waking Up", "Minutes", "Frequency") 


 #Use alarm clock workdays/most days 
simple_funct2(D_392629868, "SLEEP1K: Using an Alarm Clock on Most Days") 



 #Wake up before alarm workdays/most days 
 one_logic_funct2(D_354980163, D_392629868,353358909 , "SLEEP1L: Wake up before Alarm Clock on Workdays") 
 


 #Time in sun workdays/most days 
 merge_m2$D_424807655_D_707805344 <- as.numeric(merge_m2$D_424807655_D_707805344) #hours 
 merge_m2$D_424807655_D_850393641 <-as.numeric(merge_m2$D_424807655_D_850393641) #minutes 
 in_sun_mins= round(((merge_m2$D_424807655_D_707805344*60)+merge_m2$D_424807655_D_850393641), digits=0) 
 hist_funct_D(in_sun_mins,"SLEEP1M: Time in the Sun", "Minutes", "Frequency") 

``` 

# SLEEP2A, D, F, I, K, L, M, N 
```{r SLEEP2, warning=FALSE, echo=FALSE, message=FALSE} 

 #Time you go to bed non-workdays 
 merge_m2$hour_nw <- as.numeric(ifelse(as.numeric(str_sub(merge_m2$D_823919522,1,2))>9, str_sub(merge_m2$D_823919522,1,2), str_sub(merge_m2$D_823919522,2,2))) #clock times, so 0=00, 1=01, ect.
 merge_m2 %>% filter(D_591723682==353358909) %>% ggplot(aes(x=hour_nw))+ ylab("Count") +  xlab("Time (Military Time)") +
    #scale_x_discrete("Time (Military Time)", breaks=c(0:24), labels=c(0:24))+
   geom_bar()+  ggtitle("SLEEP2A: Time you Go to Bed on Non-Workdays") +theme(axis.text.x = element_text(angle = 90)) 


 #Time to fall asleep non-workdays 
   #sum(table(merge_m2$D_532767229_D_707805344)) 
 merge_m2$D_532767229_D_707805344 <- as.numeric(merge_m2$D_532767229_D_707805344) #hours 
 merge_m2$D_532767229_D_850393641 <- as.numeric(merge_m2$D_532767229_D_850393641) #minutes 
 fall_mins= round(((merge_m2$D_532767229_D_707805344*60) + merge_m2$D_532767229_D_850393641), digits=0) 
 hist_funct_D(fall_mins,"SLEEP2D: Time Needed to Fall Asleep on Non-Workdays", "Minutes", "Frequency") 


 #Time you wake up non-workdays 
  merge_m2$hour_nw <- as.numeric(ifelse(as.numeric(str_sub(merge_m2$D_698673038,1,2))>9, str_sub(merge_m2$D_698673038,1,2), str_sub(merge_m2$D_698673038,2,2))) #clock times, so 0=00, 1=01, ect.
 merge_m2 %>% filter(D_591723682==353358909) %>% ggplot(aes(x=hour_nw))+ ylab("Count") +  xlab("Time (Military Time)") +
    #scale_x_discrete("Time (Military Time)", breaks=c(0:24), labels=c(0:24))+
   geom_bar()+  ggtitle("SLEEP2F: Time you Wake Up on Non-Workdays") +theme(axis.text.x = element_text(angle = 90))
 

 #How long do you lie in bed non-workdays 
 merge_m2$D_711365027_D_707805344 <- as.numeric(merge_m2$D_711365027_D_707805344) #hours  
 merge_m2$D_711365027_D_850393641 <-as.numeric(merge_m2$D_711365027_D_850393641) #minutes 
 lieN_mins= round(((merge_m2$D_711365027_D_850393641 +(merge_m2$D_711365027_D_707805344*60))), digits=0) 
 hist_funct_D(lieN_mins,"SLEEPI: Length of Lying in Bed After Waking Up on Non-Workdays", "Minutes", "Frequency") 


 #Use alarm clock non-workdays 
one_logic_funct2(D_874262904, D_591723682,353358909, "SLEEP2K: Using an Alarm Clock on Non-Workdays") 
 

 #Wake up before alarm non-workdays 
one_logic_funct2(D_820694957,  D_874262904,"353358909" , "SLEEP1L: Wake up before Alarm Clock on Most Days") 


 #Choose when you wake up 
one_logic_funct2(D_823541843, D_591723682,353358909, "SLEEP2M: Ability to Choose when you Wake up on Non-Workdays") 


 #Time in sun non-workdays   #try in prod 
 merge_m2$D_825227968_D_707805344 <- as.numeric(merge_m2$D_825227968_D_707805344) #hours 
 merge_m2$D_825227968_D_850393641 <- as.numeric(merge_m2$D_825227968_D_850393641) #minutes  
 in_sunNW_mins= round(((merge_m2$D_825227968_D_707805344*60) + merge_m2$D_825227968_D_850393641), digits=0) 
 hist_funct_D(in_sunNW_mins,"SLEEPN: Time in the Sun on Non-Workdays", "Minutes", "Frequency") 

``` 

# SLHABIT1A-G
```{r SLHABIT1, warning=FALSE, echo=FALSE, message=FALSE}

data_tib_all2$D_421859821_D_220238240 <- factor(data_tib_all2$D_421859821_D_220238240,levels=c(104430631, 525779785, 565036180, 284343405, 270994579, "Skipped this Question" ))
simple_funct2(D_421859821_D_220238240, "SLHABIT1A: Having Trouble Falling Asleep")


#Wake up several times
data_tib_all2$D_421859821_D_151006826 <- factor(data_tib_all2$D_421859821_D_151006826,levels=c(104430631, 525779785, 565036180, 284343405, 270994579, "Skipped this Question" ))
simple_funct2(D_421859821_D_151006826, "SLHABIT1B: Waking up Several Times per Night")


#Wake up early
data_tib_all2$D_421859821_D_965290070 <- factor(data_tib_all2$D_421859821_D_965290070,levels=c(104430631, 525779785, 565036180, 284343405, 270994579, "Skipped this Question" ))
simple_funct2(D_421859821_D_965290070, "SLHABIT1C: Waking up Too early")

#Getting back to sleep
data_tib_all2$D_421859821_D_781115321 <- factor(data_tib_all2$D_421859821_D_781115321,levels=c(104430631, 525779785, 565036180, 284343405, 270994579, "Skipped this Question" ))
simple_funct2(D_421859821_D_781115321, "SLHABIT1D: Trouble Falling Back Asleep")

#sleeping pills
data_tib_all2$D_421859821_D_453071098 <- factor(data_tib_all2$D_421859821_D_453071098,levels=c(104430631, 525779785, 565036180, 284343405, 270994579, "Skipped this Question" ))
simple_funct2(D_421859821_D_453071098, "SLHABIT1E: Prescription Sleep Medication Taken")


#Irritable
data_tib_all2$D_421859821_D_513065503 <- factor(data_tib_all2$D_421859821_D_513065503,levels=c(104430631, 525779785, 565036180, 284343405, 270994579, "Skipped this Question" ))
simple_funct2(D_421859821_D_513065503, "SLHABIT1F: Sleep Problems causing Irritability")


#Tired during the day
data_tib_all2$D_421859821_D_257137378 <- factor(data_tib_all2$D_421859821_D_257137378,levels=c(104430631, 525779785, 565036180, 284343405, 270994579, "Skipped this Question" ))
simple_funct2(D_421859821_D_257137378, "SLHABIT1G: Feeling Tired Throughout the day")

```

# SLHABIT2
```{r SLHABIT2, warning=FALSE, echo=FALSE, message=FALSE}

#Sleep last 4 weeks
data_tib_all2$D_910856756 <- factor(data_tib_all2$D_910856756,levels=c(462478011, 303095574, 838403733, 522143286, 621370621, "Skipped this Question" ))
simple_funct2(D_910856756, "SLHABIT2: Sleep Quality in the Last Four Weeks")



```

# SLHABIT3A-I
```{r SLHABIT3, warning=FALSE, echo=FALSE, message=FALSE}

##Chance of Falling asleep while:
data_tib_all2$D_981441822_D_403155173 <- factor(data_tib_all2$D_981441822_D_403155173,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_403155173, "SLHABIT3A: Chance of Falling Asleep while Sitting and Reading")



#watch tv
data_tib_all2$D_981441822_D_576621769 <- factor(data_tib_all2$D_981441822_D_576621769,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_576621769, "SLHABIT3B: Chance of Falling Asleep while Watching TV")



#sitting inactive
data_tib_all2$D_981441822_D_988508028 <- factor(data_tib_all2$D_981441822_D_988508028,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_988508028, "SLHABIT3C: Chance of Falling Asleep while Sitting Inactive")


#riding passenger
data_tib_all2$D_981441822_D_186488870 <- factor(data_tib_all2$D_981441822_D_186488870,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_186488870, "SLHABIT3D: Chance of Falling Asleep while Sitting as a Passenger in the Car")



#lying in the afternoon
data_tib_all2$D_981441822_D_922388461 <- factor(data_tib_all2$D_981441822_D_922388461,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_922388461, "SLHABIT3E: Chance of Falling Asleep while Lying Resting in the Afternoon")



#sitting talking
data_tib_all2$D_981441822_D_760686611 <- factor(data_tib_all2$D_981441822_D_760686611,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_760686611, "SLHABIT3F: Chance of Falling Asleep while Sitting and Talking")



#siting after lunch w/o alc
data_tib_all2$D_981441822_D_354550061 <- factor(data_tib_all2$D_981441822_D_354550061,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_354550061, "SLHABIT3G: Chance of Falling Asleep while Sitting after Lunch w/o Alcohol")


#traffic light
data_tib_all2$D_981441822_D_179705366 <- factor(data_tib_all2$D_981441822_D_179705366,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_179705366, "SLHABIT3H: Chance of Falling Asleep while Stopped at a Traffic Light")


#dinner table
data_tib_all2$D_981441822_D_955609858 <- factor(data_tib_all2$D_981441822_D_955609858,levels=c(514068832, 774439579, 747099514, 977681388, "Skipped this Question" ))
simple_funct2(D_981441822_D_955609858, "SLHABIT3I: Chance of Falling Asleep while at the Dinner Table")

```

# SLHABIT4
```{r SLHABIT4, warning=FALSE, echo=FALSE, message=FALSE}

#Fallen asleep while driving
simple_funct2(D_471018082, "SLHABIT4: Ever Fallen Asleep while Driving")


```

# SNORING1-5
```{r snoring, warning=FALSE, echo=FALSE, message=FALSE}

#Do you snore
simple_funct2(D_940733450, "SNORING1: Do you Snore?")

#Describe snoring
data_tib_all2$D_406137786 <- factor(data_tib_all2$D_406137786,levels=c(624808470, 137254299, 954318357, 178420302, "Skipped this Question" ))
one_logic_funct2(D_406137786, D_940733450, 353358909, "SNORING2: Describe your Snoring")



#How often
data_tib_all2$D_406137786 <- factor(data_tib_all2$D_406137786,levels=c(718687985, 471294296, 198347104, 632512449, 520089841, 178420302, "Skipped this Question" ))
one_logic_funct2(D_631303960, D_940733450, 353358909, "SNORING3: Frequency of Snoring")



#Bothers others
data_tib_all2$D_876846761 <- factor(data_tib_all2$D_876846761,levels=c(353358909, 104430631, 178420302, "Skipped this Question"))
one_logic_funct2(D_876846761, D_940733450, 353358909, "SNORING4: Snoring Bothers Others")



#Stop breathing
data_tib_all2$D_756521698 <- factor(data_tib_all2$D_756521698,levels=c(648960871, 239152340, 582006876, 645894551, 996315715, 671267928, 647504893, "Skipped this Question"))
one_logic_funct2(D_756521698, D_940733450, 353358909, "SNORING5: Frequency you Stop Breathing while Sleeping")


```

# SLPROB1, 2
```{r SleepProb, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

slp_cond= data_tib_all2 %>%  mutate(cond= case_when(D_479628567_D_370923702==1 ~ "Sleep Apnea",
                                             D_479628567_D_495144424==1 ~ "Insomnia",
                                             D_479628567_D_728393970==1 ~ "Restless Legs",
                                             D_479628567_D_531811052==1 ~ "Narcolepsy",
                                             D_479628567_D_535003378==1 ~ "None of the above",
                                             TRUE ~ "Skipped this Question"))

 
tmp_1<- slp_cond[, grepl("479628567", colnames(slp_cond))]
tmp1 <- tmp_1[, c(1,2,5,3,4)]
sleep_prob1 <- NULL
for (i in 1:5){
  dt <- as.data.frame(tab1(tmp1[,i])$output.table)
  dt$sleep_prob1 <- colnames(tmp1)[i]
  sleep_prob1 <- rbind(sleep_prob1,dt[2,])
  
}
sleep_prob1$sleep_prob1 ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

sleep_prob1$sleep_prob1 <- c("Sleep Apnea","Insomnia","Restless Legs", "Narcolepsy","None of the above")
```
```{r, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# testt2_1 <- sleep_prob1[, c(4,1,2)]
# 
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# testt2_2 <- sleep_prob1[, c(4,1,2)]

colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
slprob1 <- sleep_prob1[, c(4,1,2)]

skipped_mhg1 <- sum(table(slp_cond$cond=="Skipped this Question")[2])
slprob1[as.numeric(dim(slprob1)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(slp_cond)[[1]])*100,2))


dt_slprob1 <- slprob1 %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("SLPROB1: Diagnosed with Conditions")) %>% 
  cols_label(Frequency= md("**N**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_slprob1,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```



```{r SleepProb2, warning=FALSE, echo=FALSE, message=FALSE, include=FALSE}

dtSLPROB2= data_tib_all2 %>% filter(D_479628567_D_370923702==1) 


slp_tmnt= dtSLPROB2 %>%  mutate(tmnt= case_when(D_629010195_D_629010195_D_417201414==1 ~ "CPAP Machine",
                                             D_629010195_D_629010195_D_959572576==1 ~ "Dental Devise",
                                             D_629010195_D_629010195_D_576852249==1 ~ "Throat/Uvula Surgery",
                                             D_629010195_D_629010195_D_807835037==1 ~ "Other",
                                             D_629010195_D_629010195_D_535003378==1 ~ "None of the above",
                                             TRUE ~ "Skipped this Question"))

 
tmp_1<- dtSLPROB2[, grepl("629010195", colnames(dtSLPROB2))]
tmp1 <- tmp_1[, c(1,5,3,4,2)]
sleep_prob1 <- NULL
for (i in 1:5){
  dt <- as.data.frame(tab1(tmp1[,i])$output.table)
  dt$sleep_prob1 <- colnames(tmp1)[i]
  sleep_prob1 <- rbind(sleep_prob1,dt[2,])
  
}
sleep_prob1$sleep_prob1 ### how are their race variables being assigned here?? wrong variable matching. Flattening issue?

sleep_prob1$sleep_prob1 <- c("Sleep Apnea","Insomnia","Restless Legs", "Narcolepsy","None of the above")
```
```{r SleepProb2Table, warning=FALSE, echo=FALSE, message=FALSE}
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA-)",  "Condition")
# testt2_1 <- sleep_prob1[, c(4,1,2)]
# 
# colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
# testt2_2 <- sleep_prob1[, c(4,1,2)]

colnames(sleep_prob1) <- c("Frequency", "Percentage" , "  %(NA+)",  "Condition")
slprob2 <- sleep_prob1[, c(4,1,2)]

skipped_mhg1 <- sum(table(slp_tmnt$tmnt=="Skipped this Question")[2])
slprob2[as.numeric(dim(slprob2)[[1]])+1,] <- c("Skipped this Question", skipped_mhg1, round((skipped_mhg1/dim(dtSLPROB2)[[1]])*100,2))


dt_slprob2 <- slprob2 %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "Percentage", decimals = 2) %>% 
  tab_header(title = md("SLPROB2: Treatments Used for Sleep Apnea")) %>% 
  cols_label(Frequency= md("**N**"), Percentage=md("**Percentge of Participants**"),  Condition = md("**Answer**")) %>% 
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = Condition,
    )
  )
tab_footnote(
  dt_slprob2,
  md("As this is a select all question, participants may select multiple responses."),
  locations = cells_column_labels(columns = Percentage),
  placement = c("left")
)




```





# SHIFTWORK1, 2, 5, 8, 9, 10
```{r ShiftWork, warning=FALSE, echo=FALSE, message=FALSE}

#Ever
levels=c("Yes, in Last 3 months","Yes, Over 3 months Ago","No","Skipped this Question")
simple_funct2(D_674976924, "SHIFTWORK: Worked as a Shift Worker")


#Time started
  merge_m2$hour_nw <- as.numeric(ifelse(as.numeric(str_sub(merge_m2$D_195662769,1,2))>9, str_sub(merge_m2$D_195662769,1,2), str_sub(merge_m2$D_195662769,2,2))) #clock times, so 0=00, 1=01, ect.
 merge_m2 %>% filter(D_674976924!= 104430631) %>% ggplot(aes(x=hour_nw))+ ylab("Count") +  xlab("Time (Military Time)") +
    #scale_x_discrete("Time (Military Time)", breaks=c(0:24), labels=c(0:24))+
   geom_bar()+  ggtitle("SHIFTWORK2: Time Usual Shift Started") +theme(axis.text.x = element_text(angle = 90))


#Time ended
   merge_m2$hour_nw <- as.numeric(ifelse(as.numeric(str_sub(merge_m2$D_214870856,1,2))>9, str_sub(merge_m2$D_214870856,1,2), str_sub(merge_m2$D_214870856,2,2))) #clock times, so 0=00, 1=01, ect.
 merge_m2 %>% filter(D_674976924!= 104430631 & hour_nw<25) %>% #removd outlier, may have misunderstod the question
   ggplot(aes(x=hour_nw))+ ylab("Count") +  xlab("Time (Military Time)") +
    #scale_x_discrete("Time (Military Time)", breaks=c(0:24))+
   geom_bar()+  ggtitle("SHIFTWORK5: Time Usual Shift Ended") +theme(axis.text.x = element_text(angle = 90))



#Flexibility
flexible= data_tib_all2 %>% filter(D_674976924!=104430631) 


shftfl= flexible %>%  mutate(flex= case_when(D_680730257==719954633 ~ "Extremely flexible",
                                             D_680730257==764708931 ~ "Very flexible",
                                             D_680730257==988873962 ~ "Somewhat flexible",
                                             D_680730257==929148006 ~ "A little flexible",
                                             D_680730257==490796638 ~ "Not at all flexible",
                                             TRUE ~ "Skipped this Question"))
shftfl$flex <- factor(shftfl$flex,levels=c("Extremely flexible","Very flexible","Somewhat flexible","A little flexible","Not at all flexible","Skipped this Question"))


dtSLPROB2_flexible <- shftfl %>% group_by(flex) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(flex, n, percentage)


dtSLPROB2_flexible %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SHIFTWORK8: Work Shift Flexibility")) %>% 
  cols_label(n= md("**N**"), flex = md("**Flexibility**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = flex,
    )
  ) 


#Total years
merge_m2$D_392874924 <- round(as.numeric(merge_m2$D_392874924), digits=0)
hist_funct(D_392874924,"SHIFTWOR9: Total Years as a Shift Worker", "Years", "Frequency")


#Age/Year last worked 
hist_funct(D_199254974_D_863007380,"SHIFTWORK10: Age When You were Last a Shift Worker", "Years", "Frequency")

hist_funct(D_199254974_D_120485458,"SHIFTWORK10: Year When You were Last a Shift Worker", "Years", "Frequency")

```






















```{r query3, include=FALSE}

parts3 <-  parts_data %>%  filter(d_976570371=='231311385')

querymod3 <- "SELECT * FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module3_v1_JP` where Connect_ID IS NOT NULL"
mod3_table <- bq_project_query(project, querymod3)
mod3_data <- bq_table_download(mod3_table, bigint = "integer64")
mod3_data$Connect_ID <- as.numeric(mod3_data$Connect_ID)



data_all3= left_join(parts3, mod3_data, by="Connect_ID")


data_tib_all3 <- as_tibble(data_all3)


```

```{r fucntion3, warning=FALSE, include=FALSE}
#Created Functions for this code

#Histogram 
hist_funct <- function(CID,Title, Xlab, Ylab) {
  CID_SYM <- rlang::ensym(CID)
  data_all3 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM)) + #, fill=as.factor(D_407056417)))+
    xlab(Xlab) + ylab(Ylab) +  ggtitle(Title)+
    geom_histogram(color="black")+ scale_y_continuous(breaks=pretty_breaks()) +
    #scale_fill_discrete(name = "Sex", labels=c("Female", "Male"))+
    geom_vline(aes(xintercept=mean(!!CID_SYM, na.rm=T)), colour="#3C989E", linetype="solid")
  
}


#Boxplot
boxp_funct <- function(CID,Title, Xlab) {
  CID_SYM <- rlang::ensym(CID)
  data_all3 %>% mutate(!!CID_SYM:=as.numeric(!!CID_SYM)) %>%
    filter(!is.na(!!CID_SYM)) %>%
    ggplot(aes(x=!!CID_SYM)) + #, fill=as.factor(D_407056417)))+
    xlab(Xlab) + geom_boxplot()+  ggtitle(Title)
    #scale_fill_discrete(name = "Sex", labels=c("Female", "Male"))
}



dict <- list("104430631"="No", "353358909"="Yes", "265550580"="Didn't Drink ", "950039557"="A few times per Year","402048066"="A few times per Month","522395860"="Once per Week",
             "756073829"="A few times per Week","858624942"="Once per day","424768954"="2-3 times per Day","687445652"="4-5 times per Day","333682419"="6+ times per Day", 
             "595249233"="Less Than once per Month ", "637900673"="Once a month","207952166"="2-3 times per Month","198347104"="1-2 times per week","471294296"="3-4 times per Week",
             "594557208"="5-6 times per Week","647504893"="Every Day", "428999623"="0-14 minutes", "248303092"="16-30 min.", "998679771"="31-59 min.","638092100"="1 hr","127455035"="2+ hrs",
             "419415087"="No, not at all", "299561721"="Yes, but rarely","716761013"="Yes, but some days","804785430"="Yes, every day", "151488193"="10 or less",
             "805449318"="11-49","486319890"="50-99","132232896"="100+", "317567178"="In the past month", "484055234"="In the past year", "802197176"="More than a year", "169225725"="Within 5 minutes",
             "967681778"="6-30 min.", "122802180"="Almost All the Time", "950591599"="Most of the Time","167208049"="Half the Time", "793320798"="Sometimes","216450786"="Almost Never", 
             "647504893"="Every Day", "417208949"="Most Days of the Week","797736697"="A Few Days per week","480609810"="One Day per Week","485011582"="A Few Days per Month",
             "667010122"="A Few days per Year","648960871"="Never", "174968750"="Less Than One Hour", "738454194"="1-2 Hours","229540444"="3-5 Hours", 
             "838981994"="6-9 Hours",  "464169461"="10-15 Hours", "683466918"="15+ Hours", "162693263"="Everyday, at least 2 hrs","924926068"="Everday, 0-2 Hours", "417208949"="Most Days", 
             "480609810"="1 day per Week", "485011582"="A Few Days per Month", "865134801"="One Day per Month", 
             "648960871"="Never", "503218834"="0",   "759356722"="1",  "668407984"="2", "448069154"="3",  "485163252"="4", "160036380"="5+", "648665281"="1",   "420091116"="2", "412554346"="3",
             "475454159"="4", "312200270"="5","411022152"="6+", "249485680"="Blistering Sunburn",  "646918928"="Sunburn w/o Blisters", "692155653"="Mild Sunburn, Eventual Tan", 
             "899670578"="A Tan Without Sunburn", "455468743"="No Skin Color Change", "503218834"="None",  "961021302"="1-2", "953684708"="3-4", "922737557"="5-9", "945387130"="10+",
             "178420302"="Unknown", "648960871"="Never",  "235613392"="Rarely",  "132099255"="Sometimes", "211590917"="Often",  "907579123"="Always", "905073380"="All exposed Areas", 
             "223461539"="Some Exposed Areas", "901521065"="Face or Head Only", "445549128"="Less Than 15","995736452"="15-20",  "120045322"="21-35", "190125431"="36-50",  "133730190"="51+",
             "102445389"="1-9 Times", "388196732"="10-49 Times", "649327523"="50-99 Times","587052987"="100-249", "838336013"="250+", "676516297"="Everyday", "511873578"="A few Days per Week",
             "522395860"="Once a Week", "756470750"="A few Days per Month", "402335383"="Less than 12x perYear", "317312221"="Blue",  "858866416"="Green","696181630"="Hazel", "248624772"="Light Brown", 
             "777809207"="Dark Brown", "181769837"="Other", "230748315"="Blond",  "379848047"="Red", "224120697"="Reddish Brown", "270559240"="Medium Brown",  "469115418"="Black", "300633065"="Very Light",
             "834817071"="Light", "385246065"="Medium", "189414295"="Dark", "482157734"="Very dark", "259218831"="No Freckles",  "519761171"="A few", "800179850"="Some", "455684772"="A lot",
             "425604618"="1",  "914302382"="2", "835682347"="3", "562508684"="4", "180306463"="5", "413495952"="6+", "332226274"="1",  "549638643"="2", "939235325"="3", "473673527"="4",
             "290010251"="5","355205294"="6+", "968093023"="1",   "545630587"="2","526602834"="3", "905402667"="4", "900343645"="5","554549266"="6+", "437269318"="Recreation", "838317013"="As Medicine",
             "585672584"="Both", "807835037"="Other", "746038746"="Prefer Not to Answer", "111520945"="Not At All", "548628123"="A Little Bit", "597477164"="A Lot")





#GT table for questions asked to all (no skip logic)
simple_funct3 <- function(CID, Title){  
  CID_SYM <- rlang::ensym(CID)
  dt_select <- data_tib_all3 %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% group_by(!!CID_SYM) %>% summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% mutate(answer=recode(!!CID_SYM, !!!dict)) %>% 
    replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)
  
  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>% 
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) %>% opt_row_striping()
}

#GT table with one filter/skip logic
one_logic_funct3 <- function(CID, CID_prev, Prev_Answer, Title){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- data_all3 %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% group_by(!!CID_SYM) %>% summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% 
    replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)
  
  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>% 
  # summary_rows(
  #   column = c(n, percentage),
  #   fns= list(
  #     Sum= ~sum(.)
  #   ), decimals=0) %>%
    grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}
```



# SKINSUN
```{r skinsun, warning=FALSE, echo=FALSE, message=FALSE}

#SKINSUN   #Adjust to Age Chart Filter
data_all3$D_863593410 <- factor(data_all3$D_863593410,levels=c(249485680,646918928,692155653,899670578,455468743, "Skipped this Question"))
simple_funct3(D_863593410, "SKINSUN: Skin Reaction of Being in the Sun for an Hour Without Sunscreen")
```
# BLISTERING
```{r blister, warning=FALSE, echo=FALSE, message=FALSE}

#BLISTERING
data_all3$D_525152373 <- factor(data_all3$D_525152373,levels=c(503218834,961021302,953684708,922737557,945387130,178420302, "Skipped this Question"))
simple_funct3(D_525152373, "BLISTERING: Number of Blistering Sunburns over Lifetime")
```
# TANOUT12, TANOUTADU
```{r tanout, warning=FALSE, echo=FALSE, message=FALSE}

#TANOUT12
data_all3$D_146319128 <- factor(data_all3$D_146319128,levels=c(648960871,235613392,132099255,211590917, "Skipped this Question"))
simple_funct3(D_146319128, "TANOUT12: Frequency of Sunbathing to Get a Tan in the past Year")



#TANOUTADU
data_all3$D_910501158 <- factor(data_all3$D_910501158,levels=c(648960871,235613392,132099255,211590917, "Skipped this Question"))
simple_funct3(D_910501158, "TANOUTADU: Frequency of Sunbathing to Get a Tan During Your Adult Life")
```
# SUNCREEN1-4
```{r sunscreen, warning=FALSE, echo=FALSE, message=FALSE}


#SUNCREEN1
data_all3$D_345457702 <- factor(data_all3$D_345457702,levels=c(648960871,235613392,132099255,211590917, "Skipped this Question"))
simple_funct3(D_345457702, "SUNCREEN1: Frequency of Applying Sunscreen When Out in the Sun for an Hour")



#SUNCREEN2
sscreen= data_tib_all3 %>% filter(D_345457702==235613392 | D_345457702==235613392 | D_345457702==235613392) 
sscreen2 <- sscreen %>%  mutate(oth_age= case_when(D_711858159==905073380~"All sun exposed areas",
                                              D_711858159==223461539~"Some sun exposed areas",
                                              D_711858159==901521065~"Face/Head only",
                                              TRUE ~ "Skipped this Question"))
sscreen2$oth_age <- factor(sscreen2$oth_age,levels=c("All sun exposed areas","Some sun exposed areas","Face/Head only", "Skipped this Question"))

dt_sscreen2 <- sscreen2 %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_sscreen2 %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SUNCREEN2: Body Parts Sunscreen Applied To")) %>% 
  cols_label(n= md("**N**"), oth_age = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) 


#SUNCREEN3
sscreen3 <- sscreen %>%  mutate(oth_age= case_when(D_467751479==648960871~"Never",
                                              D_467751479==235613392~"Rarely",
                                              D_467751479==132099255~"Sometimes",
                                               D_467751479==211590917~"Often",
                                              D_467751479==907579123~"Always",
                                              TRUE ~ "Skipped this Question"))
sscreen3$oth_age <- factor(sscreen3$oth_age,levels=c("Never","Rarely","Sometimes", "Often","Always","Skipped this Question"))

dt_sscreen3 <- sscreen3 %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_sscreen3 %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SUNCREEN3: Frequency of Re-applying Sunscreen When Out in the Sun")) %>% 
  cols_label(n= md("**N**"), oth_age = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) 


#SUNSCREEN4
sscreen4 <- sscreen %>%  mutate(oth_age= case_when(D_858858333==445549128~"Less than 15",
                                              D_858858333==995736452~"15 to 20",
                                              D_858858333==120045322~"21 to 35",
                                              D_858858333==190125431~"36 to 50",
                                              D_858858333==133730190~"Higher than 50",
                                              D_858858333==178420302~"Unknown",
                                              TRUE ~ "Skipped this Question"))
sscreen4$oth_age <- factor(sscreen4$oth_age,levels=c("Less than 15","15 to 20","21 to 35", "36 to 50","Unknown","Higher than 50","Skipped this Question"))

dt_sscreen4 <- sscreen4 %>% dplyr::group_by(oth_age) %>%  dplyr::summarize(n=n(), percentage=100*n/nrow(.))  %>% dplyr::ungroup() %>%  dplyr::select(oth_age, n, percentage) 

dt_sscreen4 %>%  gt::gt(rowname_col = "row_lab") %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md("SUNSCREEN4: Highest SPF Used Most Often")) %>% 
  cols_label(n= md("**N**"), oth_age = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(stub.font.weight = "bold") %>%
  tab_style(style = list(cell_text(weight = "bold")),
            locations = cells_body(columns = oth_age,)) 



```



# COVERSKIN
```{r coverskin, warning=FALSE, echo=FALSE, message=FALSE}
simple_funct3(D_795761911, "COVERSKIN: Frequency of Wearing Clothes/Hats to Cover Skin in the Sun")
```
















```{r query4, include=FALSE}

parts4 <-  parts_data %>%  filter(d_663265240=='231311385')

querymod4 <- "SELECT Connect_ID, D_694113343, D_374639590, D_828801156, D_995620555, D_995620555, D_980007418
FROM `nih-nci-dceg-connect-prod-6d04.FlatConnect.module4_v1_JP` where Connect_ID IS NOT NULL"
mod4_table <- bq_project_query(project, querymod4)
mod4_data <- bq_table_download(mod4_table, bigint = "integer64")
mod4_data$Connect_ID <- as.numeric(mod4_data$Connect_ID)

data_all4= left_join(parts4, mod4_data, by="Connect_ID") 


data_tib_all4 <- as_tibble(data_all4)


library(naniar)
library(UpSetR)
library(tidyverse)



Mod4 <- as_tibble(data_tib_all4)






dict <- list("104430631"="No", "353358909"="Yes","759356722"="One","185036360"="More Than One","684900118"="I Do Not Commute to Work")





#GT table for questions asked to all (no skip logic)
simple_funct4 <- function(CID, Title){  
  CID_SYM <- rlang::ensym(CID)
  dt_select <- Mod4 %>%  select(Connect_ID, !!CID_SYM)
  gt_yn <- dt_select  %>% group_by(!!CID_SYM) %>% summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% 
    replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)
  
  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}

#GT table with one filter/skip logic
one_logic_funct4 <- function(CID, CID_prev, Prev_Answer, Title){  
  CID_SYM <- rlang::ensym(CID)
  CID_SYM_P <- rlang::ensym(CID_prev)
  dt_select <- Mod4 %>%  filter(!!CID_SYM_P == Prev_Answer) %>%  select(Connect_ID, !!CID_SYM) 
  gt_yn <- dt_select  %>% group_by(!!CID_SYM) %>% summarize(n=n(), percentage=100*n/nrow(.)) %>% ungroup() %>% dplyr::mutate(answer=recode(!!CID_SYM, !!!dict)) %>% 
    replace_na(list(answer="Skipped this Question")) %>%  select(answer, n, percentage)
  
  gt_yn %>%  gt::gt(rowname_col = "row_lab")  %>%  
  fmt_number(columns = "percentage", decimals = 2) %>% 
  tab_header(title = md(Title)) %>% 
  cols_label(n= md("**N**"), answer = md("**Answer**"), percentage = md("**%**")) %>% 
  grand_summary_rows(columns=c(n, percentage),fns = ~sum(.,na.rm = T))|>
  tab_options(
      stub.font.weight = "bold"
    ) %>%
  tab_style(
    style = list(
      cell_text(weight = "bold")
    ),
    locations = cells_body(
      columns = answer,
    )
  ) 
}

```





# WORK2019
```{r work19, warning=FALSE, echo=FALSE, message=FALSE}

simple_funct4(D_694113343, "WORK2019: Work for Pay in 2019")


```

# WORKRES
```{r workres, warning=FALSE, echo=FALSE, message=FALSE}

one_logic_funct4(D_374639590,D_694113343,353358909, "WORKRES: Daily Work Tasks Include Driving")

```


# NUMWORK
```{r numwork, warning=FALSE, echo=FALSE, message=FALSE}

data_all4$D_828801156 <- factor(data_all4$D_828801156,levels=c(759356722,185036360, 684900118, "Skipped this Question"))
one_logic_funct4(D_828801156, D_374639590,104430631, "NUMWORK: Number of Workplaces Commuted to")


```

# PREWORK, RREWORKRES
```{r prework, warning=FALSE, echo=FALSE, message=FALSE}

simple_funct4(D_995620555, "PREWORK: Commute From Home to Job in the Last 20 Years")




one_logic_funct4(D_980007418,D_995620555,353358909, "PREWORKRES: Longest Held Occupation Include Driving")



```
